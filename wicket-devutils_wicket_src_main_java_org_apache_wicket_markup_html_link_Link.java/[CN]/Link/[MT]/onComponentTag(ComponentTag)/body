{
  super.onComponentTag(tag);
  if (popupSettings != null) {
    RequestCycle.get().setUrlForNewWindowEncoding();
  }
  CharSequence url=getURL();
  url=appendAnchor(tag,url);
  if (!isLinkEnabled()) {
    disableLink(tag);
  }
 else {
    if (tag.getName().equalsIgnoreCase("a") || tag.getName().equalsIgnoreCase("link") || tag.getName().equalsIgnoreCase("area")) {
      tag.put("href",Strings.replaceAll(url,"&","&amp;"));
      if (popupSettings != null) {
        tag.put("onclick",popupSettings.getPopupJavaScript());
      }
    }
 else     if (tag.getName().equalsIgnoreCase("script") || tag.getName().equalsIgnoreCase("style")) {
      tag.put("src",Strings.replaceAll(url,"&","&amp;"));
    }
 else {
      if (popupSettings != null) {
        popupSettings.setTarget("'" + url + "'");
        String popupScript=popupSettings.getPopupJavaScript();
        tag.put("onclick",popupScript);
      }
 else {
        tag.put("onclick","var win = this.ownerDocument.defaultView || this.ownerDocument.parentWindow; " + "if (win == window) { window.location.href='" + Strings.replaceAll(url,"&","&amp;") + "'; } ;return false");
      }
    }
    final CharSequence onClickJavaScript=getOnClickScript(url);
    if (onClickJavaScript != null) {
      tag.put("onclick",onClickJavaScript);
    }
    if (popupSettings != null) {
      IPageMap popupPageMap=popupSettings.getPageMap(this);
      if (popupPageMap != null && popupPageMap.getName() != null) {
        tag.put("target",popupPageMap.getName());
      }
    }
  }
}
