{
  IMarkupFilter filter=new WicketTagIdentifier(markup,xmlParser);
  filter=new TagTypeHandler(filter);
  filter=new HtmlHandler(filter);
  filter=new WicketRemoveTagHandler(filter);
  filter=new WicketLinkTagHandler(filter);
  filter=new WicketNamespaceHandler(filter,markup);
  final MarkupResourceStream resource=markup.getResource();
  if (resource != null) {
    final ContainerInfo containerInfo=resource.getContainerInfo();
    if (containerInfo != null) {
      if (WicketMessageTagHandler.enable) {
        filter=new WicketMessageTagHandler(filter,containerInfo);
      }
      filter=new BodyOnLoadHandler(filter);
      if (Page.class.isAssignableFrom(containerInfo.getContainerClass())) {
        filter=new HtmlHeaderSectionHandler(this.markup,filter);
      }
      filter=new HeadForceTagIdHandler(filter,containerInfo.getContainerClass());
    }
  }
  return filter;
}
