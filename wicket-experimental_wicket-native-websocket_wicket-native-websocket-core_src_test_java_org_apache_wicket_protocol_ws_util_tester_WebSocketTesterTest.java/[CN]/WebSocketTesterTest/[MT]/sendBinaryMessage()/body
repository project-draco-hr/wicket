{
  final byte[] expectedMessage="some message".getBytes();
  final int offset=1;
  final int length=2;
  WebSocketTestPage page=new WebSocketTestPage(expectedMessage,offset,length);
  tester.startPage(page);
  WebSocketTester webSocketTester=new WebSocketTester(page){
    @Override protected void onOutMessage(    byte[] message,    int off,    int len){
      String msg=new String(expectedMessage);
      byte[] pushedMessage=Strings.capitalize(msg).getBytes();
      assertArrayEquals(pushedMessage,message);
      assertEquals(offset + 1,off);
      assertEquals(length - 1,len);
    }
  }
;
  webSocketTester.sendMessage(expectedMessage,offset,length);
  webSocketTester.destroy();
}
