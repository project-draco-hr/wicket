{
  Map<String,BufferedHttpServletResponse> responsesPerSession=bufferedResponses.get(sessionId);
  if (responsesPerSession == null) {
    responsesPerSession=Collections.synchronizedMap(new MostRecentlyUsedMap<String,BufferedHttpServletResponse>(4));
    Map<String,BufferedHttpServletResponse> previousValue=bufferedResponses.putIfAbsent(sessionId,responsesPerSession);
    if (previousValue != null) {
      responsesPerSession=previousValue;
    }
  }
  responsesPerSession.put(bufferId,renderedResponse);
}
