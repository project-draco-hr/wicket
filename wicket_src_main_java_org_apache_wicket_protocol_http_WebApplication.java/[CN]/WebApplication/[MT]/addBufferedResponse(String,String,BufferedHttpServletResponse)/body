{
  Map<String,BufferedHttpServletResponse> responsesPerSession=bufferedResponses.get(sessionId);
  if (responsesPerSession == null) {
    responsesPerSession=Collections.synchronizedMap(new MostRecentlyUsedMap<String,BufferedHttpServletResponse>(4));
    Map<String,BufferedHttpServletResponse> previousValue=bufferedResponses.putIfAbsent(sessionId,responsesPerSession);
    if (previousValue != null) {
      responsesPerSession=previousValue;
    }
  }
  String bufferKey=bufferId.startsWith("/") ? bufferId.substring(1) : bufferId;
  responsesPerSession.put(bufferKey,renderedResponse);
}
