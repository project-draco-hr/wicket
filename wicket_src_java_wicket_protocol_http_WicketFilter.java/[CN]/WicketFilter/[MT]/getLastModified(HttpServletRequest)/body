{
  final String pathInfo=servletRequest.getRequestURI();
  int rootPathLength=getRootPath(servletRequest).length();
  if (pathInfo.length() > rootPathLength && pathInfo.substring(rootPathLength).startsWith(RESOURCES_PATH_PREFIX)) {
    final String resourceReferenceKey=pathInfo.substring(rootPathLength + RESOURCES_PATH_PREFIX.length());
    Resource resource=webApplication.getSharedResources().get(resourceReferenceKey);
    if ((resource != null) && resource.isCacheable()) {
      try {
        Application.set(webApplication);
        final WebRequest webRequest=webApplication.newWebRequest(servletRequest);
        resource.setParameters(webRequest.getParameterMap());
        IResourceStream stream=resource.getResourceStream();
        Time time=stream.lastModifiedTime();
        try {
          stream.close();
        }
 catch (        IOException e) {
        }
        return time != null ? time.getMilliseconds() : -1;
      }
 catch (      AbortException e) {
        return -1;
      }
 finally {
        resource.setParameters(null);
        Application.unset();
      }
    }
  }
  return -1;
}
