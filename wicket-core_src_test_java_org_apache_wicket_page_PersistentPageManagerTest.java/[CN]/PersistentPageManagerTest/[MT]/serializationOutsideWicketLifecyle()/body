{
  IPageManager pageManager=newPersistentPageManager("test_app");
  TestPage toSerializePage=new TestPage();
  pageManager.touchPage(toSerializePage);
  pageManager.commitRequest();
  Serializable sessionEntry=pageManager.getContext().getSessionAttribute(null);
  pageManager.destroy();
  byte[] serializedSessionEntry=WicketObjects.objectToByteArray(sessionEntry);
  assertNotNull("Wicket needs to be able to serialize the session entry",serializedSessionEntry);
  ObjectInputStream in=new ObjectInputStream(new ByteArrayInputStream(serializedSessionEntry));
  if (Application.exists()) {
    System.err.println("==================DEBUG  ==========" + Application.get().getName());
  }
  assertNull("Worker thread should be unaware of Wicket application",in.readObject());
  Serializable loadedSessionEntry=(Serializable)in.readObject();
  assertNotNull("Wicket needs to be able to deserialize the session entry regardless the application availability",loadedSessionEntry);
  IPageManager newPageManager=newPersistentPageManager("test_app");
  newPageManager.getContext().setSessionAttribute(null,loadedSessionEntry);
  TestPage deserializedPage=(TestPage)newPageManager.getPage(toSerializePage.getPageId());
  assertNotNull(deserializedPage);
  assertEquals(toSerializePage.instanceID,deserializedPage.instanceID);
  newPageManager.destroy();
}
