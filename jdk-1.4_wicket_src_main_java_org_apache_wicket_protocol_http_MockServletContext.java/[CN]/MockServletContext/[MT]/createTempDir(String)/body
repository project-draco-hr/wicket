{
  String tempDir=System.getProperty("java.io.tmpdir");
  if (tempDir == null || tempDir.trim().length() == 0) {
    throw new RuntimeException("Could not create a temporary directory. System's [[java.io.tmpdir]] property is not " + "properly set. Current value is [[" + tempDir + "]]. Set via [[java -Djava.io.tmpdir=/var/tmp]]");
  }
  if (!tempDir.endsWith(File.separator)) {
    tempDir+=File.separator;
  }
  tempDir+=name;
  File dir=new File(tempDir);
  int counter=0;
  while (dir.exists()) {
    dir=new File(dir.getAbsolutePath() + counter);
    counter++;
    if (counter > 100) {
      throw new RuntimeException("Could not create temporary directory [[" + dir.getAbsolutePath() + "]] after attempting 100 tries");
    }
  }
  if (!dir.mkdirs()) {
    throw new RuntimeException("Could not create path for tempdir [[" + dir.getAbsolutePath() + "]]");
  }
  dir.deleteOnExit();
  return dir;
}
