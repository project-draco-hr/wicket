{
  IncrementingListener incrementingListener=new IncrementingListener();
  Application.get().getRequestCycleListeners().add(incrementingListener);
  RequestCycle cycle=newRequestCycle(false);
  incrementingListener.assertValues(0,0,0,0);
  assertValues(0,0,0);
  cycle.processRequestAndDetach();
  incrementingListener.assertValues(1,1,0,1);
  assertValues(0,1,1);
  cycle=newRequestCycle(false);
  cycle.getListeners().add(incrementingListener);
  cycle.processRequestAndDetach();
  incrementingListener.assertValues(3,3,0,3);
  assertValues(0,2,2);
  cycle=newRequestCycle(true);
  cycle.getListeners().add(incrementingListener);
  cycle.processRequestAndDetach();
  incrementingListener.assertValues(5,5,2,5);
  assertValues(1,2,3);
}
