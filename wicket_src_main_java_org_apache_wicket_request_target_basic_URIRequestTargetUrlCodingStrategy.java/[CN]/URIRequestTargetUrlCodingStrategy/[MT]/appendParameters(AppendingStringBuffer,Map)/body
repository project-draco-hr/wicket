{
  if (parameters.get(URI) != null) {
    url.append("/").append(parameters.get(URI));
  }
  if (!url.endsWith("/")) {
    url.append("/");
  }
  if (parameters != null && parameters.size() > 0) {
    final Iterator entries;
    if (UnitTestSettings.getSortUrlParameters()) {
      entries=new TreeMap(parameters).entrySet().iterator();
    }
 else {
      entries=parameters.entrySet().iterator();
    }
    WebRequestEncoder encoder=new WebRequestEncoder(url);
    while (entries.hasNext()) {
      Map.Entry entry=(Entry)entries.next();
      if (entry.getKey().equals(URI)) {
        continue;
      }
      if (entry.getValue() != null) {
        encoder.addValue(entry.getKey().toString(),entry.getValue());
      }
    }
  }
}
