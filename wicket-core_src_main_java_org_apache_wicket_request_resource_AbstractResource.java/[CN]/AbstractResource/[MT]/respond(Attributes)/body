{
  ResourceResponse data=newResourceResponse(attributes);
  if (this instanceof IStaticCacheableResource) {
    final IStaticCacheableResource cacheable=(IStaticCacheableResource)this;
    if (cacheable.isCacheEnabled()) {
      getCachingStrategy().decorateResponse(data,cacheable);
    }
  }
  setResponseHeaders(data,attributes);
  if (!data.dataNeedsToBeWritten(attributes) || data.getErrorCode() != null) {
    return;
  }
  if (data.getWriteCallback() == null) {
    throw new IllegalStateException("ResourceResponse#setWriteCallback() must be set.");
  }
  data.getWriteCallback().writeData(attributes);
}
