{
  SessionPageKey curentKey=new SessionPageKey(sessionId,id,versionNumber,ajaxVersionNumber,null);
  Object value=storePageMap.get(curentKey);
  if (value instanceof Page) {
    if (storePageMap.put(curentKey,SERIALIZING) == value) {
      byte[] bytes=serializePage((Page)value);
      if (bytes != null) {
        storePageMap.put(curentKey,bytes);
      }
 else {
        storePageMap.remove(curentKey);
      }
      return bytes;
    }
 else {
      value=SERIALIZING;
    }
  }
  while (value == SERIALIZING) {
    try {
      Thread.sleep(50);
    }
 catch (    InterruptedException ex) {
      throw new RuntimeException(ex);
    }
    value=storePageMap.get(curentKey);
  }
  return value instanceof byte[] ? (byte[])value : null;
}
