{
  while (!stop) {
    SessionPageKey key=null;
    try {
      Object data=null;
synchronized (storePageMap) {
        if (stop)         return;
        while (storePageMap.size() == 0) {
          storePageMap.wait();
        }
        key=(SessionPageKey)storePageMap.get(0);
        data=key.getObject();
        if (data instanceof Page) {
          key.setObject(SERIALIZING);
        }
      }
      byte[] pageBytes=null;
      if (data instanceof Page) {
        pageBytes=serializePage(key,(Page)data);
synchronized (key) {
          key.setObject(pageBytes);
          key.notifyAll();
        }
      }
 else       if (data instanceof byte[]) {
        pageBytes=(byte[])data;
      }
      if (pageBytes != null) {
        savePage(key,pageBytes);
      }
      if (storePageMap.remove(0) != key) {
        System.err.println("Remove 0 is not the same!!");
      }
    }
 catch (    Exception e) {
      log.error("Error in page save thread",e);
      storePageMap.remove(key);
    }
  }
}
