{
  File sessionDir=new File(getWorkDir(),sessionId);
  sessionDir.mkdirs();
  File pageFile=getPageFile(page.getNumericId(),page.getCurrentVersionNumber(),sessionDir);
  FileOutputStream fos=null;
  long t1=System.currentTimeMillis();
  long t2=0;
  int length=0;
  try {
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    try {
      new ObjectOutputStream(out).writeObject(page);
    }
  finally {
      out.close();
    }
    byte[] bytes=out.toByteArray();
    t2=System.currentTimeMillis();
    fos=new FileOutputStream(pageFile);
    ByteBuffer bb=ByteBuffer.wrap(bytes);
    fos.getChannel().write(bb);
    length=bytes.length;
  }
 catch (  Exception e) {
    try {
      Objects.checkSerializable(page);
    }
 catch (    Exception e1) {
      log.error("Error saving page " + page.getClass() + "["+ page.getId()+ ","+ page.getCurrentVersionNumber()+ "] for the sessionid "+ sessionId+ ": "+ e1.getMessage(),e1);
    }
  }
 finally {
    try {
      if (fos != null) {
        fos.close();
      }
    }
 catch (    IOException ex) {
    }
  }
  if (log.isDebugEnabled()) {
    long t3=System.currentTimeMillis();
    log.debug("storing page " + page.getClass() + "["+ page.getNumericId()+ ","+ page.getCurrentVersionNumber()+ "] size: "+ length+ " for session "+ sessionId+ " took "+ (t2 - t1)+ " miliseconds to serialize and "+ (t3 - t2)+ " miliseconds to save");
  }
}
