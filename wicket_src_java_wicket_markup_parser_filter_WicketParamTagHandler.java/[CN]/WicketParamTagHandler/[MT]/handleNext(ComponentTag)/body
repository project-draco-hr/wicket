{
  if (tag.isClose()) {
    return tag;
  }
  if (tag.getId() == null) {
    componentTag=null;
    return tag;
  }
  if (!(tag instanceof WicketTag) || !((WicketTag)tag).isParamTag()) {
    componentTag=tag;
    return tag;
  }
  final CharSequence rawMarkup=xmlParser.getInputSubsequence(lastTag.getPos() + lastTag.getLength(),tag.getPos());
  if (rawMarkup.length() > 0) {
    String text=rawMarkup.toString();
    text=text.replaceAll("[\\r\\n]+","").trim();
    if (text.length() > 0) {
      throw new MarkupException("There must not be any text between a component tag and " + "it's related param tag. Only spaces and line breaks are allowed.");
    }
  }
  lastTag.getAdditionalAttributes().putAll(tag.getAttributes());
  if (stripWicketTag == true) {
    tag=(ComponentTag)getParent().nextTag();
  }
 else {
    log.warn("Be careful. Not stripping <wicket:param> from output may cause subtle errors.");
  }
  return tag;
}
