{
  if (ignoreTheRest == true) {
    return tag;
  }
  if (HEAD.equalsIgnoreCase(tag.getName())) {
    if (tag.getNamespace() == null) {
      if (tag.isOpen()) {
        foundHead=true;
        if (tag.getId() == null) {
          tag.setId(HEADER_ID);
          tag.setAutoComponentTag(true);
          tag.setModified(true);
        }
      }
 else       if (tag.isClose()) {
        foundClosingHead=true;
      }
      return tag;
    }
 else {
      foundHead=true;
      foundClosingHead=true;
    }
  }
 else   if (BODY.equalsIgnoreCase(tag.getName()) && (tag.getNamespace() == null)) {
    if (foundHead && !foundClosingHead) {
      throw new MarkupException(new MarkupStream(markup),"Invalid page markup. Tag <BODY> found inside <HEAD>");
    }
    if (foundHead == false) {
      insertHeadTag();
    }
    ignoreTheRest=true;
    return tag;
  }
  return tag;
}
