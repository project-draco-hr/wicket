{
  String anyClassInJarFile="/java/lang/String.class";
  URL realURL=getClass().getResource(anyClassInJarFile);
  final AtomicInteger connectCounter=new AtomicInteger(0);
  final AtomicInteger streamCounter=new AtomicInteger(0);
  URL url=new URL(null,"test://anything",new CountingURLStreamHandler(realURL,connectCounter,streamCounter));
  UrlResourceStream countingStream=new UrlResourceStream(url);
  assertEquals(0,connectCounter.get());
  assertEquals(0,streamCounter.get());
  countingStream.length();
  assertEquals(1,connectCounter.get());
  assertEquals(0,streamCounter.get());
  countingStream.getInputStream();
  assertEquals(1,connectCounter.get());
  assertEquals(1,streamCounter.get());
  countingStream.getContentType();
  assertEquals(1,connectCounter.get());
  assertEquals(1,streamCounter.get());
  countingStream.getInputStream();
  assertEquals(1,connectCounter.get());
  assertEquals(2,streamCounter.get());
  countingStream.close();
  assertEquals(1,connectCounter.get());
  assertEquals(2,streamCounter.get());
  countingStream.length();
  assertEquals(2,connectCounter.get());
  assertEquals(2,streamCounter.get());
  countingStream.getInputStream();
  assertEquals(2,connectCounter.get());
  assertEquals(3,streamCounter.get());
}
