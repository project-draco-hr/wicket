{
  int headIndex=responseBuffer.indexOf("<head>");
  int bodyIndex=responseBuffer.indexOf("</body>");
  long timeTaken=System.currentTimeMillis() - RequestCycle.get().getStartTime();
  if (headIndex != -1 && bodyIndex != -1) {
    Map map=new HashMap(4);
    map.put("clienttime","' + (new Date().getTime() - clientTimeVariable)/1000 +  's");
    map.put("servertime",((double)timeTaken) / 1000 + "s");
    String defaultValue="Server parsetime: " + ((double)timeTaken) / 1000 + "s, Client parsetime: ' + (new Date().getTime() - clientTimeVariable)/1000 +  's";
    String txt=Application.get().getMarkupSettings().getLocalizer().getString("ServerAndClientTimeFilter.statustext",null,Model.valueOf(map),Session.get().getLocale(),Session.get().getStyle(),defaultValue);
    StringBuffer endScript=new StringBuffer("\n<script>\nwindow.defaultStatus='");
    endScript.append(txt);
    endScript.append("';\n</script>\n");
    responseBuffer.insert(bodyIndex - 1,endScript);
    StringBuffer beginScript=new StringBuffer("\n<script>\nvar clientTimeVariable = new Date().getTime();\n</script>\n");
    responseBuffer.insert(headIndex + 6,beginScript);
  }
  log.info(timeTaken + "ms server time taken for request " + RequestCycle.get().getRequest().getURL()+ " response size: "+ responseBuffer.length());
  return responseBuffer;
}
