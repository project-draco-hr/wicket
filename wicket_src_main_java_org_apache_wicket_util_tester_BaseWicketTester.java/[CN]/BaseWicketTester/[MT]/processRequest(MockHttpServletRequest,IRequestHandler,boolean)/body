{
  if (forcedRequest != null) {
    request=forcedRequest;
  }
  forcedHandler=forcedRequestHandler;
  if (!redirect && getRequest().getHeader("Wicket-Ajax") == null) {
    lastRenderedPage=null;
  }
  try {
    if (!redirect) {
      session.cleanupFeedbackMessages();
    }
    if (getLastResponse() != null) {
      for (      Cookie cookie : getLastResponse().getCookies()) {
        request.addCookie(cookie);
      }
    }
    applyRequest();
    requestCycle.scheduleRequestHandlerAfterCurrent(null);
    boolean requestProcessed;
    if (exposeExceptions == true) {
      requestProcessed=requestCycle.processRequestAndDetachWithoutExceptionHandling();
    }
 else {
      requestProcessed=requestCycle.processRequestAndDetach();
    }
    if (requestProcessed == false) {
      return false;
    }
    recordRequestResponse();
    setupNextRequestCycle();
    if (followRedirects && lastResponse.isRedirect()) {
      if (redirectCount++ >= 100) {
        throw new IllegalStateException("Possible infinite redirect detected. Bailing out.");
      }
      Url newUrl=Url.parse(lastResponse.getRedirectLocation(),Charset.forName(request.getCharacterEncoding()));
      if (newUrl.isAbsolute()) {
        throw new WicketRuntimeException("Can not follow absolute redirect URL.");
      }
      Url mergedURL=new Url(lastRequest.getUrl().getSegments(),newUrl.getQueryParameters());
      mergedURL.concatSegments(newUrl.getSegments());
      request.setUrl(mergedURL);
      processRequest(null,null,true);
      --redirectCount;
    }
    return true;
  }
  finally {
    redirectCount=0;
  }
}
