{
  if (this.webApplication == null) {
    IWebApplicationFactory factory=getApplicationFactory();
    this.webApplication=factory.createApplication(this);
    log.info("WicketServlet loaded application " + this.webApplication.getName() + " via "+ factory.getClass().getName()+ " factory");
  }
  this.webApplication.setWicketServlet(this);
  String contextKey="wicket:" + getServletConfig().getServletName();
  getServletContext().setAttribute(contextKey,this.webApplication);
  try {
    Application.set(webApplication);
    this.webApplication.internalInit();
    this.webApplication.init();
    this.webApplication.initializeComponents();
    this.webApplication.logStarted();
  }
  finally {
    Application.unset();
  }
}
