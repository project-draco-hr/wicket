{
  final MockPageWithLinkAndComponent page=new MockPageWithLinkAndComponent();
  page.add(new WebComponent(MockPageWithLinkAndComponent.COMPONENT_ID).setOutputMarkupId(true));
  page.add(new AjaxLink<Void>(MockPageWithLinkAndComponent.LINK_ID){
    private static final long serialVersionUID=1L;
    @Override public void onClick(    AjaxRequestTarget target){
      try {
        Constructor<? extends Component> con=componentClass.getConstructor(new Class[]{String.class});
        Component comp=con.newInstance(new Object[]{MockPageWithLinkAndComponent.COMPONENT_ID});
        page.replace(comp);
        comp.setOutputMarkupId(true);
        target.addComponent(comp);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
);
  tester.startPage(new ITestPageSource(){
    private static final long serialVersionUID=1L;
    public Page getTestPage(){
      return page;
    }
  }
);
  tester.debugComponentTrees();
  tester.clickLink(MockPageWithLinkAndComponent.LINK_ID);
  String document=tester.getLastResponseAsString();
  Pattern pat=Pattern.compile(".*<header-contribution>(.*?)</header-contribution>.*",Pattern.DOTALL);
  Matcher mat=pat.matcher(document);
  String headerContribution=null;
  if (mat.matches()) {
    headerContribution=mat.group(1);
  }
  if (expectedFile == null) {
    assertNull("There was a header contribution on the response: <" + headerContribution + ">",headerContribution);
  }
 else {
    DiffUtil.validatePage(headerContribution,getClass(),expectedFile,true);
  }
}
