{
  if (urlPrefix == null) {
    final AppendingStringBuffer buffer=new AppendingStringBuffer();
    final WebRequest request=((WebRequestCycle)requestCycle).getWebRequest();
    if (request != null) {
      String contextPath=Application.get().getApplicationSettings().getContextPath();
      if (contextPath == null) {
        contextPath=((WebRequestCycle)RequestCycle.get()).getWebRequest().getContextPath();
        if (contextPath == null) {
          contextPath="";
        }
      }
      if (!contextPath.equals("/")) {
        buffer.append(contextPath);
      }
      String path=request.getServletPath();
      if (path != null && !path.equals("")) {
        if (!buffer.endsWith("/") && !path.startsWith("/"))         buffer.append("/");
        buffer.append(path);
      }
    }
    urlPrefix=buffer;
  }
  return urlPrefix;
}
