{
  if (urlPrefix == null) {
    final AppendingStringBuffer buffer=new AppendingStringBuffer();
    final WebRequest request=((WebRequestCycle)requestCycle).getWebRequest();
    if (request != null) {
      String contextPath=Application.get().getApplicationSettings().getContextPath();
      if (contextPath == null) {
        contextPath=((WebRequestCycle)RequestCycle.get()).getWebRequest().getContextPath();
        if (contextPath == null) {
          contextPath="";
        }
      }
      if (!contextPath.equals("/")) {
        buffer.append(contextPath);
      }
      String path=request.getServletPath();
      if (path == null || "".equals(path)) {
        if (buffer.length() > 0 && !buffer.endsWith("/")) {
          buffer.append("/");
        }
      }
 else {
        buffer.append(path);
      }
    }
    urlPrefix=buffer;
  }
  return urlPrefix;
}
