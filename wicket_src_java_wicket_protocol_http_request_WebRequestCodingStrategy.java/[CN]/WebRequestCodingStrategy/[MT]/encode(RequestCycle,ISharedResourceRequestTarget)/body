{
  final CharSequence prefix=urlPrefix(requestCycle);
  final String sharedResourceKey=requestTarget.getResourceKey();
  if ((sharedResourceKey == null) || (sharedResourceKey.trim().length() == 0)) {
    return prefix;
  }
 else {
    final AppendingStringBuffer buffer=new AppendingStringBuffer(sharedResourceKey.length() + prefix.length() + 11);
    buffer.append(prefix);
    if ((buffer.length() > 0) && buffer.charAt(buffer.length() - 1) == '/') {
      buffer.append("resources/");
    }
 else {
      buffer.append("/resources/");
    }
    buffer.append(sharedResourceKey);
    Map map=requestTarget.getRequestParameters().getParameters();
    if (map != null && map.size() > 0) {
      buffer.append('?');
      Iterator it=map.entrySet().iterator();
      while (it.hasNext()) {
        Map.Entry entry=(Entry)it.next();
        buffer.append(entry.getKey());
        buffer.append('=');
        buffer.append(entry.getValue());
        buffer.append('&');
      }
      buffer.setLength(buffer.length() - 1);
    }
    return requestCycle.getOriginalResponse().encodeURL(buffer);
  }
}
