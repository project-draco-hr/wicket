{
  if (beanName != null) {
    WebApplication application=(WebApplication)ac.getBean(beanName);
    if (application == null) {
      throw new IllegalArgumentException("Unable to find WebApplication bean with name [" + beanName + "]");
    }
    return application;
  }
 else {
    Map<?,?> beans=BeanFactoryUtils.beansOfTypeIncludingAncestors(ac,WebApplication.class,false,false);
    if (beans.size() == 0) {
      throw new IllegalStateException("bean of type [" + WebApplication.class.getName() + "] not found");
    }
    if (beans.size() > 1) {
      throw new IllegalStateException("more then one bean of type [" + WebApplication.class.getName() + "] found, must have only one");
    }
    return (WebApplication)beans.values().iterator().next();
  }
}
