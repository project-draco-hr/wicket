{
  List touchedPages=(List)Session.touchedPages.get();
  Session.touchedPages.set(null);
  if (touchedPages != null && touchedPages.size() > 0) {
    log.warn("There where still touched pages in the request detach phase, session update wasn't called: " + touchedPages);
  }
  List dirtyObjects=(List)Session.dirtyObjects.get();
  Session.dirtyObjects.set(null);
  if (dirtyObjects != null && dirtyObjects.size() > 0) {
    log.warn("There where still dirty objects in the request detach phase, session update wasn't called: " + dirtyObjects);
  }
  if (pageMapsUsedInRequest != null) {
synchronized (pageMapsUsedInRequest) {
      Thread t=Thread.currentThread();
      Iterator it=pageMapsUsedInRequest.entrySet().iterator();
      while (it.hasNext()) {
        Entry entry=(Entry)it.next();
        if (entry.getValue() == t) {
          it.remove();
        }
      }
      pageMapsUsedInRequest.notifyAll();
    }
  }
}
