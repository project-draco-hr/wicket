{
  if (tag instanceof ComponentWicketTag) {
    final ComponentWicketTag wicketTag=(ComponentWicketTag)tag;
    if (wicketTag.isComponentTag()) {
      final Component component=createComponent(container,wicketTag);
      if (component != null) {
        nestedComponents.put(component,null);
        try {
          container.add(component);
          component.render();
        }
  finally {
          nestedComponents.remove(component);
        }
        return true;
      }
    }
  }
  if ((tag.getId() != null) && nestedComponents.containsKey(container)) {
    MarkupContainer parent=container.getParent();
    while ((parent != null) && nestedComponents.containsKey(parent)) {
      parent=parent.getParent();
    }
    if (parent != null) {
      final Component component=parent.get(tag.getId());
      if (component != null) {
        component.render();
        return true;
      }
    }
  }
  return false;
}
