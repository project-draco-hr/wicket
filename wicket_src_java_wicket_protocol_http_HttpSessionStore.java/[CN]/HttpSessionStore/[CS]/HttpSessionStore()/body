{
  Application app=Application.get();
  if (!(app instanceof WebApplication)) {
    throw new IllegalStateException(getClass().getName() + " can only operate in the context of web applications");
  }
  this.application=(WebApplication)app;
}
