{
  if (getLocalizer() == null) {
    if (component != null) {
      setLocalizer(component.getLocalizer());
    }
 else {
      throw new IllegalStateException("No localizer has been set");
    }
  }
  String s=localizer.getString(getResourceKey(),component,getNestedModel());
  Object[] parameters=getParameters();
  if (parameters != null) {
    Object[] realParams=new Object[parameters.length];
    for (int i=0; i < parameters.length; i++) {
      if (parameters[i] instanceof IModel) {
        realParams[i]=((IModel)parameters[i]).getObject(component);
      }
 else       if (model != null && parameters[i] instanceof String) {
        realParams[i]=OgnlVariableInterpolator.interpolate((String)parameters[i],model.getObject(component));
      }
 else {
        realParams[i]=parameters[i];
      }
    }
    Locale workingLocale=locale;
    if (component != null) {
      workingLocale=component.getLocale();
    }
    final MessageFormat format=new MessageFormat(s,workingLocale);
    s=format.format(realParams);
  }
  return s;
}
