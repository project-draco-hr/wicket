{
  initFlags();
  final Response originalResponse=newResponse();
  final IRequestCycle requestCycle=newRequestCycle(originalResponse);
  final RequestHandlerStack stack=newStack(requestCycle);
  final IRequestHandler handler3=new IRequestHandler(){
    public void respond(    IRequestCycle requestCycle){
      testFlag3=false;
    }
    public void detach(    IRequestCycle requestCycle){
      detachedFlag3=true;
    }
  }
;
  final IRequestHandler handler2=new IRequestHandler(){
    public void respond(    IRequestCycle requestCycle){
      testFlag2=false;
      stack.replaceAll(handler3);
      testFlag2=true;
    }
    public void detach(    IRequestCycle requestCycle){
      detachedFlag2=true;
    }
  }
;
  final IRequestHandler handler1=new IRequestHandler(){
    public void respond(    IRequestCycle requestCycle){
      testFlag1=false;
      Response resp=newResponse();
      requestCycle.setResponse(resp);
      stack.execute(handler2);
      assertEquals(requestCycle.getResponse(),resp);
      testFlag1=true;
    }
    public void detach(    IRequestCycle requestCycle){
      detachedFlag1=true;
    }
  }
;
  stack.execute(handler1);
  assertEquals(requestCycle.getResponse(),originalResponse);
  stack.detach();
  assertFalse(testFlag1);
  assertFalse(testFlag2);
  assertFalse(testFlag3);
  assertTrue(detachedFlag1);
  assertTrue(detachedFlag2);
  assertTrue(detachedFlag3);
}
