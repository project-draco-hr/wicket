{
  if (tag instanceof WicketTag) {
    final WicketTag wicketTag=(WicketTag)tag;
    if (wicketTag.isComponentTag()) {
      final Component component=createComponent(container,wicketTag);
      if (component != null) {
        if (component instanceof Border) {
          nestedComponents.put(((Border)component).getBodyContainer(),container);
        }
 else {
          nestedComponents.put(component,container);
        }
        nestedComponents.remove(component);
        return component;
      }
    }
  }
  if ((tag.getId() != null) && nestedComponents.containsKey(container)) {
    MarkupContainer parent=nestedComponents.get(container);
    while (parent != null) {
      Component component=parent.get(tag.getId());
      if (component != null) {
        return component;
      }
      parent=parent.getParent();
      if (nestedComponents.containsKey(parent)) {
        parent=nestedComponents.get(parent);
      }
    }
  }
  return null;
}
