{
  if (!isStarted) {
    final Runnable runnable=new Runnable(){
      public void run(){
        startTime.fromNow().sleep();
        final Logger log=getLog();
        while (!stop) {
          final Time startOfPeriod=Time.now();
          if (log.isDebugEnabled()) {
            log.debug("Run the job: " + code.toString());
          }
          try {
            code.run(getLog());
          }
 catch (          Exception e) {
            log.error("Unhandled exception thrown by user code in task " + name,e);
          }
          if (log.isDebugEnabled()) {
            log.debug("Finished with job: " + code.toString());
          }
          startOfPeriod.add(frequency).fromNow().sleep();
        }
      }
    }
;
    this.thread=new Thread(runnable,name + " Task");
    this.thread.setDaemon(isDaemon);
    this.thread.start();
    isStarted=true;
  }
 else {
    throw new IllegalStateException("Attempt to start task that has already been started");
  }
}
