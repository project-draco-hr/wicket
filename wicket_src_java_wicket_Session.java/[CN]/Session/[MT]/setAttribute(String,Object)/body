{
  Object oldValue=getAttribute(name);
  if (oldValue == null) {
    fireAttributeAdded(name,value);
  }
 else {
    fireAttributeReplaced(name,value,oldValue);
  }
  getSessionStore().setAttribute(name,value);
  if (log.isDebugEnabled()) {
    String valueTypeName=(value != null ? value.getClass().getName() : "null");
    long t1=System.currentTimeMillis();
    byte[] serialized;
    try {
      final ByteArrayOutputStream out=new ByteArrayOutputStream();
      new ObjectOutputStream(out).writeObject(value);
      serialized=out.toByteArray();
    }
 catch (    Exception e) {
      throw new WicketRuntimeException("Internal error cloning object. May be your model object does not implement Serializable. Class=" + valueTypeName,e);
    }
    long t2=System.currentTimeMillis();
    log.debug("Attribute " + name + "{ "+ valueTypeName+ "} serialized in "+ (t2 - t1)+ " miliseconds, size: "+ Bytes.bytes(serialized.length));
  }
}
