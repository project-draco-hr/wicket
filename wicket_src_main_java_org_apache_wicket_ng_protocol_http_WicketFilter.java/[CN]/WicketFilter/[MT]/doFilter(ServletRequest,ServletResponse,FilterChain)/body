{
  try {
    HttpServletRequest httpServletRequest=(HttpServletRequest)request;
    HttpServletResponse httpServletResponse=(HttpServletResponse)response;
    String filterPath=getFilterPath(httpServletRequest);
    webApplication.set();
    if (checkForTrailingSlash(httpServletRequest,httpServletResponse,filterPath)) {
      ServletWebRequest req=new ServletWebRequest(httpServletRequest,filterPath);
      ServletWebResponse resp=new ServletWebResponse(httpServletResponse);
      RequestCycle requestCycle=webApplication.createRequestCycle(req,resp);
      if (!requestCycle.processRequestAndDetach()) {
        chain.doFilter(request,response);
      }
    }
  }
  finally {
    ThreadContext.detach();
  }
}
