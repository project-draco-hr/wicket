{
  String path=request.getServletPath();
  if (servletMode) {
    path=request.getPathInfo();
    if (path == null) {
      path="";
    }
  }
  filterPath=getFilterPath(request);
  if (path.length() > 0) {
    path=path.substring(1);
  }
  if (!path.startsWith(filterPath)) {
    if (filterPath.equals(path + "/")) {
      path+="/";
    }
  }
  if (path.startsWith(filterPath)) {
    path=path.substring(filterPath.length());
  }
  return path;
}
