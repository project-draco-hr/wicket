{
  if (includeYUILibraries()) {
    YuiLib.load(response);
  }
  renderHeadInit(response);
  Map<String,Object> variables=new HashMap<String,Object>();
  String widgetId=getEscapedComponentMarkupId();
  variables.put("componentId",getComponentMarkupId());
  variables.put("widgetId",widgetId);
  variables.put("datePattern",getDatePattern());
  variables.put("fireChangeEvent",notifyComponentOnDateSelected());
  variables.put("alignWithIcon",alignWithIcon());
  variables.put("hideOnSelect",hideOnSelect());
  variables.put("showOnFieldClick",showOnFieldClick());
  String script=getAdditionalJavaScript();
  if (script != null) {
    variables.put("additionalJavascript",Strings.replaceAll(script,"${calendar}","YAHOO.wicket." + widgetId + "DpJs"));
  }
  Map<String,Object> p=new LinkedHashMap<String,Object>();
  configure(p,response,variables);
  if (!p.containsKey("navigator") && enableMonthYearSelection()) {
    p.put("navigator",Boolean.TRUE);
  }
  if (enableMonthYearSelection() && p.containsKey("pages") && Objects.longValue(p.get("pages")) > 1) {
    throw new IllegalStateException("You cannot use a CalendarGroup with month/year selection!");
  }
  StringBuilder calendarInit=new StringBuilder();
  appendMapping(p,calendarInit);
  variables.put("calendarInit",calendarInit.toString());
  TextTemplate datePickerJs=new PackageTextTemplate(DatePicker.class,"DatePicker.js");
  datePickerJs.interpolate(variables);
  response.renderOnDomReadyJavaScript(datePickerJs.asString());
  if (AjaxRequestTarget.get() != null) {
    String escapedComponentMarkupId=getEscapedComponentMarkupId();
    String javascript="var e = Wicket.$('" + escapedComponentMarkupId + "Dp"+ "'); if (e != null && typeof(e.parentNode) != 'undefined' && "+ "typeof(e.parentNode.parentNode != 'undefined')) {"+ "e.parentNode.parentNode.removeChild(e.parentNode);"+ "YAHOO.wicket."+ escapedComponentMarkupId+ "DpJs.destroy(); delete YAHOO.wicket."+ escapedComponentMarkupId+ "DpJs;}";
    response.renderJavaScript(javascript,null);
  }
}
