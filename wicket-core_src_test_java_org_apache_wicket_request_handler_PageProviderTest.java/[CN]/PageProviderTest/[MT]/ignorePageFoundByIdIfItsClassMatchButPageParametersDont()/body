{
  TestMapperContext mapperContext=new TestMapperContext();
  PageParameters initialParameters=new PageParameters();
  initialParameters.add("name1","value1");
  Page page=new TestPage(initialParameters);
  mapperContext.getPageManager().touchPage(page);
  mapperContext.getPageManager().commitRequest();
  mapperContext.cleanSessionCache();
  PageParameters newParameters=new PageParameters();
  newParameters.add("name2","value2");
  PageProvider provider=new PageProvider(page.getPageId(),TestPage.class,newParameters,0);
  assertFalse(provider.hasPageInstance());
  assertEquals(TestPage.class,provider.getPageInstance().getClass());
  assertTrue(provider.isPageInstanceFresh());
}
