{
  List<TagTester> testers=new ArrayList<TagTester>();
  if ((Strings.isEmpty(markup) == false) && (Strings.isEmpty(attribute) == false) && (Strings.isEmpty(value) == false)) {
    try {
      markup=AJAX_COMPONENT_CDATA_OPEN.matcher(markup).replaceAll("<component>");
      markup=AJAX_COMPONENT_CDATA_CLOSE.matcher(markup).replaceAll("</component>");
      XmlPullParser parser=new XmlPullParser();
      parser.parse(markup);
      XmlTag elm=null;
      XmlTag openTag=null;
      XmlTag closeTag=null;
      int level=0;
      while ((elm=parser.nextTag()) != null) {
        XmlTag xmlTag=elm;
        if (openTag == null) {
          IValueMap attributeMap=xmlTag.getAttributes();
          for (          Map.Entry<String,Object> entry : attributeMap.entrySet()) {
            if (entry.getKey().equals(attribute) && value.equals(entry.getValue())) {
              if (xmlTag.isOpen()) {
                openTag=xmlTag;
              }
 else               if (xmlTag.isOpenClose()) {
                openTag=xmlTag;
                closeTag=xmlTag;
              }
            }
          }
        }
 else {
          if (xmlTag.isOpen() && xmlTag.getName().equals(openTag.getName())) {
            level++;
          }
          if (xmlTag.isClose()) {
            if (xmlTag.getName().equals(openTag.getName())) {
              if (level == 0) {
                closeTag=xmlTag;
                closeTag.setOpenTag(openTag);
              }
 else {
                level--;
              }
            }
          }
        }
        if ((openTag != null) && (closeTag != null) && (level == 0)) {
          TagTester tester=new TagTester(parser,openTag,closeTag);
          testers.add(tester);
          openTag=null;
          closeTag=null;
        }
        if (stopAfterFirst && (closeTag != null)) {
          break;
        }
      }
    }
 catch (    Exception e) {
      throw new WicketRuntimeException(e);
    }
  }
  return testers;
}
