{
  Application application=ThreadContext.getApplication();
  if (application == null) {
    return resourceReference.getLastModified();
  }
  Map<ResourceReference,Time> cache;
  if (application.usesDevelopmentConfig()) {
    RequestCycle requestCycle=ThreadContext.getRequestCycle();
    cache=requestCycle.getMetaData(TIMESTAMP_KEY);
    if (cache == null) {
      cache=Generics.newHashMap();
      requestCycle.setMetaData(TIMESTAMP_KEY,cache);
    }
  }
 else {
    cache=application.getMetaData(TIMESTAMP_KEY);
    if (cache == null) {
      cache=Generics.newHashMap();
      application.setMetaData(TIMESTAMP_KEY,cache);
    }
  }
  if (cache.containsKey(resourceReference)) {
    return cache.get(resourceReference);
  }
  Time lastModified=resourceReference.getLastModified();
  cache.put(resourceReference,lastModified);
  return lastModified;
}
