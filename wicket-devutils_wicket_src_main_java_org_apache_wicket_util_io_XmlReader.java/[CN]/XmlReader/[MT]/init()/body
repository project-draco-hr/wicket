{
  if (!inputStream.markSupported()) {
    throw new IOException("The InputStream must support mark/reset");
  }
  final int readAheadSize=80;
  inputStream.mark(readAheadSize);
  if (getXmlDeclaration(inputStream,readAheadSize)) {
    encoding=determineEncoding(xmlDeclarationString);
  }
 else {
    inputStream.reset();
  }
  if (encoding == null) {
    reader=new BufferedReader(new InputStreamReader(inputStream));
  }
 else {
    reader=new BufferedReader(new InputStreamReader(inputStream,encoding));
  }
}
