{
  String sessionId=request.getSession(true).getId();
  Map sessionMap=(Map)bufferedResponses.get(sessionId);
  if (sessionMap == null) {
    sessionMap=new HashMap(4);
    final Time now=Time.now();
    sessionMap.put("last-time-used",now);
synchronized (bufferedResponses) {
      for (Iterator i=bufferedResponses.entrySet().iterator(); i.hasNext(); ) {
        Map.Entry entry=(Entry)i.next();
        final Time lastTimeUsed=(Time)((Map)entry.getValue()).get("last-time-used");
        if (now.subtract(lastTimeUsed).greaterThan(Duration.minutes(5))) {
          i.remove();
        }
      }
      bufferedResponses.put(sessionId,sessionMap);
    }
  }
  sessionMap.put(requestUri,renderedResponse);
}
