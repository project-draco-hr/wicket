{
  IKey key=getRegistryKey();
  try {
    connectionRegistry.setConnection(getApplication(),getSessionId(),key,connection);
    connectionFilters.doFilter(servletRequest);
    broadcastMessage(new ConnectedMessage(getApplication(),getSessionId(),key));
  }
 catch (  ConnectionRejectedException e) {
    broadcastMessage(new AbortedMessage(getApplication(),getSessionId(),key));
    connectionRegistry.removeConnection(getApplication(),getSessionId(),key);
    connection.close(e.getCode(),e.getReason());
  }
}
