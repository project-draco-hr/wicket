{
  PageParameters params=new PageParameters();
  params.putAll(urlParameters);
  String urlPath=urlFragment;
  if (urlPath.startsWith("/")) {
    urlPath=urlPath.substring(1);
  }
  if (urlPath.length() > 0) {
    String[] pathParts=urlPath.split("/");
    if (pathParts.length > parameterNames.length) {
      String msg=String.format("Found more URL path parts then expected, these will be ignored. Url: '%s', mountpath: '%s', urlPath: '%s', expected %d parameters was %d",getRequestUrl(),getMountPath(),urlPath,parameterNames.length,pathParts.length);
      if (ignoreUndeclaredParameters) {
        logger.info(msg);
      }
 else {
        throw new IllegalArgumentException(msg);
      }
    }
    int actualParameterCount=Math.min(pathParts.length,parameterNames.length);
    for (int i=0; i < actualParameterCount; i++) {
      params.put(parameterNames[i],urlDecodePathComponent(pathParts[i]));
    }
  }
  return params.toValueMap();
}
