{
  MarkupContainer parent=getParent();
  MarkupContainer parentWithAssociatedMarkup=findParentWithAssociatedMarkup();
  MarkupStream markupStream=parentWithAssociatedMarkup.getAssociatedMarkupStream();
  String componentPath=parent.getPageRelativePath();
  String parentWithAssociatedMarkupPath=parentWithAssociatedMarkup.getPageRelativePath();
  String relativePath=componentPath.substring(parentWithAssociatedMarkupPath.length());
  if (relativePath.startsWith(":")) {
    relativePath=relativePath.substring(1);
  }
  int index=markupStream.findComponentIndex(relativePath,getId());
  if (index == -1) {
    throw new WicketRuntimeException("Unable to determine markup for component: " + this.toString());
  }
  markupStream.setCurrentIndex(index);
  return markupStream;
}
