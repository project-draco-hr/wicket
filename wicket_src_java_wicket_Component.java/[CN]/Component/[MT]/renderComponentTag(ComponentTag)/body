{
  final ApplicationSettings settings=getApplication().getSettings();
  if (!(tag instanceof WicketTag) || !settings.getStripWicketTags()) {
    if ((attributeModifiers != null) && (tag.getType() != XmlTag.CLOSE) && (getFlag(FLAG_IGNORE_ATTRIBUTE_MODIFIER) == false)) {
      tag=tag.mutable();
      if (attributeModifiers instanceof AttributeModifier) {
        ((AttributeModifier)attributeModifiers).replaceAttibuteValue(this,tag);
      }
 else       if (attributeModifiers instanceof Object[]) {
        Object[] array=(Object[])attributeModifiers;
        for (int i=0; i < array.length; i++) {
          ((AttributeModifier)array[i]).replaceAttibuteValue(this,tag);
        }
      }
    }
    if (ajaxHandlers != null) {
      for (Iterator i=ajaxHandlers.iterator(); i.hasNext(); ) {
        AjaxHandler handler=(AjaxHandler)i.next();
        handler.onComponentTag(tag);
      }
    }
    getResponse().write(tag.toString(settings.getStripWicketTags(),this.findMarkupStream().getWicketNamespace()));
  }
}
