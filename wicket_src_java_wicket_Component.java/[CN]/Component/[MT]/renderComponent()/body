{
  if (this instanceof Page) {
    ((Page)this).renderPage();
  }
 else {
    MarkupContainer parent=getParent();
    MarkupStream originalMarkupStream=parent.getMarkupStream();
    MarkupStream markupStream=new MarkupFragmentFinder().find(this);
    try {
      parent.setMarkupStream(markupStream);
      if (this instanceof MarkupContainer) {
        MarkupContainer<V> container=(MarkupContainer<V>)this;
        container.visitChildren(IFeedback.class,new IVisitor<Component<?>>(){
          public Object component(          Component<?> component){
            ((IFeedback)component).updateFeedback();
            component.internalAttach();
            return IVisitor.CONTINUE_TRAVERSAL;
          }
        }
);
      }
      if (this instanceof IFeedback) {
        ((IFeedback)this).updateFeedback();
      }
      internalAttach();
      onBeforeRender();
      render(markupStream);
    }
  finally {
      parent.setMarkupStream(originalMarkupStream);
      onAfterRender();
    }
  }
}
