{
  if (parent == null) {
    if (!(this instanceof Page)) {
      throw new WicketRuntimeException("component without a parent is not allowed.");
    }
  }
  this.parent=parent;
  setId(id);
  getApplication().notifyComponentInstantiationListeners(this);
  if (id.startsWith(AUTO_COMPONENT_PREFIX)) {
    parent.autoAdd(this);
  }
 else {
    try {
      MarkupStream markupStream=MarkupFragmentFinder.find(this);
      ComponentTag tag=markupStream.getTag();
      if (tag.hasAttributes()) {
        markupAttributes=new CopyOnWriteValueMap(tag.getAttributes());
      }
    }
 catch (    RuntimeException re) {
      throw new WicketRuntimeException("Couldn't find the markup of the component " + id + " in parent "+ parent.getPageRelativePath());
    }
    parent.add(this);
  }
  if (model instanceof IInhertanceAware) {
    this.model=((IInhertanceAware)model).wrapOnInhertance(this);
  }
 else {
    this.model=model;
  }
}
