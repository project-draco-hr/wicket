{
  if (pageMapName != null && getPopupSettings() != null) {
    throw new IllegalStateException("You cannot specify popup settings and a page map");
  }
  if (getPopupSettings() != null) {
    return urlFor(PageMap.forName("popup" + (popupNumber++)),pageClass,parameters);
  }
 else {
    return urlFor(getPageMap(),pageClass,parameters);
  }
}
