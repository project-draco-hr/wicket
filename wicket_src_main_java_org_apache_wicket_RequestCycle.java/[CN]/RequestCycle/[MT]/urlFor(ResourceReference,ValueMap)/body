{
  ObsoleteRequestParameters requestParameters=new ObsoleteRequestParameters();
  requestParameters.setResourceKey(resourceReference.getSharedResourceKey());
  String name=resourceReference.getName();
  if (getApplication().getResourceSettings().getAddLastModifiedTimeToResourceReferenceUrl() && !Strings.isEmpty(name) && !name.endsWith("/")) {
    Time time=resourceReference.lastModifiedTime();
    if (time != null) {
      if (parameters == null) {
        parameters=new ValueMap();
        parameters.put("w:lm",new Long(time.getMilliseconds() / 1000));
      }
    }
  }
  requestParameters.setParameters(parameters);
  return encodeUrlFor(new SharedResourceRequestTarget(requestParameters));
}
