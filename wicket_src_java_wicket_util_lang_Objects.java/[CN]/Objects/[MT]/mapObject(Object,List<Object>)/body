{
  addedObjects.add(object);
  try {
    List<Field> fields=getFields(object.getClass());
    MiniMap<Field,Object> values=new MiniMap<Field,Object>(fields.size());
    for (    Field field : fields) {
      field.setAccessible(true);
      Object value=field.get(object);
      Object analyzed=analyzeObject(value,addedObjects);
      if (recursive == analyzed)       continue;
      if (!Modifier.isFinal(field.getModifiers()) || analyzed instanceof ArrayInstanceHolder || analyzed instanceof ObjectInstanceHashmapHolder) {
        values.put(field,analyzed);
      }
    }
    return values;
  }
 catch (  Exception e) {
    throw new WicketRuntimeException("Internal error cloning model: " + object,e);
  }
}
