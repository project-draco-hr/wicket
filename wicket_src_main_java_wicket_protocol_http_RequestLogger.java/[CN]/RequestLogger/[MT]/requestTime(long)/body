{
  RequestData rd=(RequestData)currentRequest.get();
  if (rd != null) {
    Session session=Session.get();
    String sessionId=session.getId();
    rd.setSessionId(sessionId);
    Object sessionInfo=getSessionInfo(session);
    rd.setSessionInfo(sessionInfo);
    long sizeInBytes=-1;
    if (Application.get().getRequestLoggerSettings().getRecordSessionSize()) {
      sizeInBytes=session.getSizeInBytes();
    }
    rd.setSessionSize(sizeInBytes);
    rd.setTimeTaken(timeTaken);
    requests.add(0,rd);
    currentRequest.set(null);
    if (sessionId != null) {
      SessionData sd=(SessionData)liveSessions.get(sessionId);
      if (sd == null) {
        sessionCreated(sessionId);
        sd=(SessionData)liveSessions.get(sessionId);
      }
      if (sd != null) {
        sd.setSessionInfo(sessionInfo);
        sd.setSessionSize(sizeInBytes);
        sd.addTimeTaken(timeTaken);
      }
    }
  }
}
