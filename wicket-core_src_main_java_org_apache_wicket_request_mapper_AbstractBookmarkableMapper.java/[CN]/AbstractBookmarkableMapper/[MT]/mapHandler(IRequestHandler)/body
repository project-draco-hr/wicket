{
  while (requestHandler instanceof IRequestHandlerDelegate) {
    requestHandler=((IRequestHandlerDelegate)requestHandler).getDelegateHandler();
  }
  if (requestHandler instanceof BookmarkablePageRequestHandler) {
    BookmarkablePageRequestHandler handler=(BookmarkablePageRequestHandler)requestHandler;
    if (!checkPageClass(handler.getPageClass())) {
      return null;
    }
    PageInfo info=new PageInfo();
    UrlInfo urlInfo=new UrlInfo(new PageComponentInfo(info,null),handler.getPageClass(),handler.getPageParameters());
    return buildUrl(urlInfo);
  }
 else   if (requestHandler instanceof RenderPageRequestHandler) {
    RenderPageRequestHandler handler=(RenderPageRequestHandler)requestHandler;
    if (!checkPageClass(handler.getPageClass())) {
      return null;
    }
    if (handler.getPageProvider().isNewPageInstance()) {
      PageInfo info=new PageInfo();
      UrlInfo urlInfo=new UrlInfo(new PageComponentInfo(info,null),handler.getPageClass(),handler.getPageParameters());
      return buildUrl(urlInfo);
    }
    IRequestablePage page=handler.getPage();
    if (!pageMustHaveBeenCreatedBookmarkable() || page.wasCreatedBookmarkable()) {
      PageInfo info=null;
      if (!page.isPageStateless()) {
        info=new PageInfo(page.getPageId());
      }
      PageComponentInfo pageComponentInfo=info != null ? new PageComponentInfo(info,null) : null;
      UrlInfo urlInfo=new UrlInfo(pageComponentInfo,page.getClass(),handler.getPageParameters());
      return buildUrl(urlInfo);
    }
 else {
      return null;
    }
  }
 else   if (requestHandler instanceof BookmarkableListenerInterfaceRequestHandler) {
    BookmarkableListenerInterfaceRequestHandler handler=(BookmarkableListenerInterfaceRequestHandler)requestHandler;
    IRequestablePage page=handler.getPage();
    if (!checkPageClass(page.getClass())) {
      return null;
    }
    Integer renderCount=null;
    if (handler.getListenerInterface().isIncludeRenderCount()) {
      renderCount=page.getRenderCount();
    }
    PageInfo pageInfo=new PageInfo(page.getPageId());
    ComponentInfo componentInfo=new ComponentInfo(renderCount,requestListenerInterfaceToString(handler.getListenerInterface()),handler.getComponent().getPageRelativePath(),handler.getBehaviorIndex());
    UrlInfo urlInfo=new UrlInfo(new PageComponentInfo(pageInfo,componentInfo),page.getClass(),handler.getPageParameters());
    return buildUrl(urlInfo);
  }
  return null;
}
