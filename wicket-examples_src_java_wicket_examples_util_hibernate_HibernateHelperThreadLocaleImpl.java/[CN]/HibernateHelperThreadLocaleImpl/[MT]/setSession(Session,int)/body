{
  Session sess=(Session)hibernateHolder.get();
  if (sess != null) {
    if (actionForCurrentSession == HibernateHelper.ACTION_CLOSE) {
      try {
        sess.close();
      }
 catch (      HibernateException ex) {
        log.error(ex);
      }
    }
 else     if (actionForCurrentSession == HibernateHelper.ACTION_DISCONNECT) {
      try {
        sess.disconnect();
      }
 catch (      HibernateException ex) {
        log.error(ex);
      }
    }
 else {
      throw new WicketRuntimeException("Invalid action " + actionForCurrentSession);
    }
  }
  hibernateHolder.set(session);
}
