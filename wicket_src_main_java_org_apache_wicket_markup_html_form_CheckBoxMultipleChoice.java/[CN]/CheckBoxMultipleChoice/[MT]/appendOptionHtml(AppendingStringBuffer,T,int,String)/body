{
  Object displayValue=getChoiceRenderer().getDisplayValue(choice);
  Class<?> objectClass=displayValue == null ? null : displayValue.getClass();
  String label="";
  if (objectClass != null && objectClass != String.class) {
    IConverter converter=getConverter(objectClass);
    label=converter.convertToString(displayValue,getLocale());
  }
 else   if (displayValue != null) {
    label=displayValue.toString();
  }
  if (label != null) {
    buffer.append(getPrefix());
    String id=getChoiceRenderer().getIdValue(choice,index);
    final String idAttr=getMarkupId() + "-" + getInputName()+ "_"+ id;
    buffer.append("<input name=\"");
    buffer.append(getInputName());
    buffer.append("\"");
    buffer.append(" type=\"checkbox\"");
    if (isSelected(choice,index,selected)) {
      buffer.append(" checked=\"checked\"");
    }
    if (isDisabled(choice,index,selected)) {
      buffer.append(" disabled=\"disabled\"");
    }
    buffer.append(" value=\"");
    buffer.append(id);
    buffer.append("\" id=\"");
    buffer.append(idAttr);
    buffer.append("\"/>");
    String display=label;
    if (localizeDisplayValues()) {
      display=getLocalizer().getString(label,this,label);
    }
    final CharSequence escaped=(getEscapeModelStrings() ? Strings.escapeMarkup(display,false,true) : display);
    buffer.append("<label for=\"");
    buffer.append(idAttr);
    buffer.append("\">").append(escaped).append("</label>");
    buffer.append(getSuffix());
  }
}
