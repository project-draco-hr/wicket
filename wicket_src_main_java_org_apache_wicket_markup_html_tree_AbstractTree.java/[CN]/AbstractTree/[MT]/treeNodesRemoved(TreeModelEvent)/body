{
  if (dirtyAll) {
    return;
  }
  TreeNode parentNode=(TreeNode)removalEvent.getTreePath().getLastPathComponent();
  TreeItem parentItem=nodeToItemMap.get(parentNode);
  if (parentItem != null && isNodeVisible(parentNode)) {
    if (parentNode.getChildCount() == 0) {
      invalidateNode(parentNode,true);
    }
    if (isNodeExpanded(parentNode)) {
      for (      Object deletedNode : removalEvent.getChildren()) {
        TreeItem itemToDelete=nodeToItemMap.get(deletedNode);
        if (itemToDelete != null) {
          markTheLastButOneChildDirty(parentItem,itemToDelete);
          visitItemChildren(itemToDelete,new IItemCallback(){
            public void visitItem(            TreeItem item){
              removeItem(item);
              getTreeState().selectNode(item.getModelObject(),false);
            }
          }
);
          parentItem.getChildren().remove(itemToDelete);
          removeItem(itemToDelete);
          getTreeState().selectNode(itemToDelete.getModelObject(),false);
        }
      }
    }
  }
}
