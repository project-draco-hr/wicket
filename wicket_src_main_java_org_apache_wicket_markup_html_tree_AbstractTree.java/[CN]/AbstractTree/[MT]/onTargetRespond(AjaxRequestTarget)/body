{
  checkModel();
  if (dirtyAll) {
    addComponent(target,this);
  }
 else {
    if (deleteIds.length() != 0) {
      String js=getElementsDeleteJavascript();
      target.prependJavascript(js);
    }
    while (dirtyItemsCreateDOM.isEmpty() == false) {
      for (Iterator<TreeItem> i=dirtyItemsCreateDOM.iterator(); i.hasNext(); ) {
        TreeItem item=i.next();
        TreeItem parent=item.getParentItem();
        int index=parent.getChildren().indexOf(item);
        TreeItem previous;
        if (index == 0) {
          previous=parent;
        }
 else {
          previous=parent.getChildren().get(index - 1);
          while (previous.getChildren() != null && previous.getChildren().size() > 0) {
            previous=previous.getChildren().get(previous.getChildren().size() - 1);
          }
        }
        if (dirtyItemsCreateDOM.contains(previous) == false) {
          target.prependJavascript("Wicket.Tree.createElement(\"" + item.getMarkupId() + "\","+ "\""+ previous.getMarkupId()+ "\")");
          i.remove();
        }
 else {
        }
      }
    }
    for (    TreeItem item : dirtyItems) {
      if (item.getChildren() == null) {
        buildItemChildren(item);
        item.setRenderChildren(true);
      }
      addComponent(target,item);
    }
    updated();
  }
}
