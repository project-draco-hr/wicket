{
  final IAjaxCallDecorator decorator=getAjaxCallDecorator();
  String indicatorId=findIndicatorId();
  CharSequence success=(onSuccessScript == null) ? "" : onSuccessScript;
  CharSequence failure=(onFailureScript == null) ? "" : onFailureScript;
  if (decorator != null) {
    success=decorator.decorateOnSuccessScript(success);
  }
  if (!Strings.isEmpty(indicatorId)) {
    String hide=";wicketHide('" + indicatorId + "');";
    success=success + hide;
    failure=failure + hide;
  }
  if (decorator != null) {
    failure=decorator.decorateOnFailureScript(failure);
  }
  AppendingStringBuffer buff=new AppendingStringBuffer(256);
  buff.append("var ").append(IAjaxCallDecorator.WICKET_CALL_RESULT_VAR).append("=");
  buff.append(partialCall).append(", function() { ").append(success);
  buff.append("}, function() { ").append(failure).append("});");
  CharSequence call=buff;
  if (!Strings.isEmpty(indicatorId)) {
    call=new AppendingStringBuffer("wicketShow('").append(indicatorId).append("');").append(call);
  }
  if (decorator != null) {
    call=decorator.decorateScript(call);
  }
  return call;
}
