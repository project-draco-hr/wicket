{
  Class containerClass=clazz;
  if (clazz == null) {
    containerClass=containerInfo.getContainerClass();
  }
 else {
    if (!clazz.isAssignableFrom(containerInfo.getContainerClass())) {
      throw new WicketRuntimeException("Parameter clazz must be instance of container");
    }
  }
  final CharSequence key=markupKey(containerInfo,clazz);
  Markup markup=(Markup)markupCache.get(key);
  if (markup == null) {
synchronized (markupCache) {
      markup=(Markup)markupCache.get(key);
      if (markup == null) {
        IResourceStream resourceStream=container.newMarkupResourceStream(containerClass,containerInfo);
        if (resourceStream != null) {
          final MarkupResourceStream markupResource=new MarkupResourceStream(resourceStream,containerInfo,containerClass);
          markup=loadMarkupAndWatchForChanges(container,key,markupResource);
        }
 else {
          markup=Markup.NO_MARKUP;
          markupCache.put(key,markup);
        }
      }
    }
  }
  return markup;
}
