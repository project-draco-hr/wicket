{
  ClassLoader cl=Thread.currentThread().getContextClassLoader();
  if (cl == null) {
    cl=GroovyPageFactory.class.getClassLoader();
  }
  final GroovyWarClassLoader groovyCl=new GroovyWarClassLoader(cl);
  Class clazz=null;
  try {
    final InputStream in=url.getUrl().openStream();
    if (in != null) {
      clazz=groovyCl.parseClass(in);
      if (clazz != null) {
        if (false == classname.equals(clazz.getName())) {
          log.warn("Though it is possible, the Groovy file name and " + "the java class name defined in that file SHOULD " + "match and follow the java rules");
        }
        classname=clazz.getName();
      }
    }
 else {
      log.warn("Groovy file not found: " + url.getAbsolutePath());
    }
  }
 catch (  CompilationFailedException e) {
    throw new RenderException("Error parsing groovy file: " + url.getAbsolutePath(),e);
  }
catch (  IOException e) {
    throw new RenderException("Error reading groovy file: " + url.getAbsolutePath(),e);
  }
catch (  Throwable e) {
    throw new RenderException("Error while reading groovy file: " + url.getAbsolutePath(),e);
  }
 finally {
    this.removeConstructor(classname);
    if (clazz == null) {
      classCache.remove(classname);
    }
 else {
      classCache.put(classname,clazz);
    }
  }
  return clazz;
}
