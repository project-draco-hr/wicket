{
  RequestData rd=getCurrentRequest();
  if (rd != null) {
    Session session=Session.get();
    String sessionId=session.getId();
    rd.setSessionId(sessionId);
    Object sessionInfo=getSessionInfo(session);
    rd.setSessionInfo(sessionInfo);
    long sizeInBytes=session.getSizeInBytes();
    rd.setSessionSize(sizeInBytes);
    rd.setTimeTaken(timeTaken);
    requests.add(0,rd);
    currentRequest.set(null);
    if (sessionId != null) {
      SessionData sd=liveSessions.get(sessionId);
      if (sd == null) {
        sessionCreated(sessionId);
        sd=liveSessions.get(sessionId);
      }
      if (sd != null) {
        sd.setSessionInfo(sessionInfo);
        sd.setSessionSize(sizeInBytes);
        sd.addTimeTaken(timeTaken);
      }
    }
  }
}
