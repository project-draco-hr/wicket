{
  if (getLocalizer() == null) {
    if (component != null) {
      setLocalizer(component.getLocalizer());
    }
 else {
      throw new IllegalStateException("No localizer has been set");
    }
  }
  String value=localizer.getString(getResourceKey(),component,model,defaultValue);
  if (value == null) {
    value=defaultValue;
  }
  if (value != null) {
    Object[] parameters=getParameters();
    if (parameters != null) {
      Object[] realParams=new Object[parameters.length];
      for (int i=0; i < parameters.length; i++) {
        if (parameters[i] instanceof IModel) {
          realParams[i]=((IModel)parameters[i]).getObject();
        }
 else         if (model != null && parameters[i] instanceof String) {
          realParams[i]=PropertyVariableInterpolator.interpolate((String)parameters[i],model.getObject());
        }
 else {
          realParams[i]=parameters[i];
        }
      }
      final MessageFormat format=new MessageFormat(value,component != null ? component.getLocale() : locale);
      value=format.format(realParams);
    }
  }
  return value;
}
