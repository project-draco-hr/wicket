{
  final StringBuffer options=new StringBuffer();
  final Object selected=getModelObject();
  final List list=getValues();
  if (selected == null && isRenderNullOption()) {
    final String chooseOne=getLocalizer().getString(getName() + ".null",this,DEFAULT_NULL_OPTION_VALUE);
    options.append("\n<option selected value=\"").append(NULL_VALUE).append("\">").append(chooseOne).append("</option>");
  }
  for (int i=0; i < list.size(); i++) {
    final Object value=list.get(i);
    if (value != null) {
      options.append("\n<option " + (isSelected(value) ? "selected " : "") + "value=\"");
      options.append((list instanceof IIdList) ? ((IIdList)list).getIdValue(i) : Integer.toString(i));
      options.append("\">");
      final String label=(list instanceof IIdList) ? ((IIdList)list).getDisplayValue(i) : value.toString();
      options.append(getLocalizer().getString(getName() + "." + label,this,label));
      options.append("</option>");
    }
 else {
      throw new IllegalArgumentException("Dropdown choice contains null value in values collection at index " + i);
    }
  }
  options.append("\n");
  replaceBody(cycle,markupStream,openTag,options.toString());
  if (list instanceof IIdList) {
    ((IIdList)list).detach(cycle);
  }
}
