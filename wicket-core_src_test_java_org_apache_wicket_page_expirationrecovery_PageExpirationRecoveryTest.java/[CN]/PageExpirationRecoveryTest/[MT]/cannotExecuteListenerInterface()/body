{
  PageSettings pageSettings=tester.getApplication().getPageSettings();
  pageSettings.setRecreateBookmarkablePagesAfterExpiry(true);
  pageSettings.setCallListenerInterfaceAfterExpiry(false);
  ExpirationRecoveryPage page=tester.startPage(ExpirationRecoveryPage.class,parameters);
  assertEquals(parameters,page.getPageParameters());
  tester.getSession().invalidateNow();
  assertFalse(page.linkClicked.get());
  tester.clickLink("link",false);
  page=(ExpirationRecoveryPage)tester.getLastRenderedPage();
  assertEquals("PageParameters should be preserved",parameters,page.getPageParameters());
  assertFalse("Link should not be clicked!",page.linkClicked.get());
  tester.getSession().invalidateNow();
  assertFalse(page.ajaxLinkClicked.get());
  tester.clickLink("alink",true);
  page=(ExpirationRecoveryPage)tester.getLastRenderedPage();
  assertFalse("AjaxLink should not be clicked!",page.ajaxLinkClicked.get());
  assertEquals("PageParameters should be preserved",parameters,page.getPageParameters());
  tester.getSession().invalidateNow();
  assertFalse(page.submitLinkSubmitted.get());
  tester.clickLink("f:sl",false);
  page=(ExpirationRecoveryPage)tester.getLastRenderedPage();
  assertFalse("SubmitLink should not be submitted!",page.submitLinkSubmitted.get());
  assertEquals("PageParameters should be preserved",parameters,page.getPageParameters());
  tester.getSession().invalidateNow();
  assertFalse(page.ajaxSubmitLinkSubmitted.get());
  tester.clickLink("f:asl",true);
  page=(ExpirationRecoveryPage)tester.getLastRenderedPage();
  assertFalse("AjaxSubmitLink should not be submitted",page.ajaxSubmitLinkSubmitted.get());
  assertEquals("PageParameters should be preserved",parameters,page.getPageParameters());
  tester.getSession().invalidateNow();
  assertFalse(page.formSubmitted.get());
  String textOldValue=page.textModel.getObject();
  FormTester formTester=tester.newFormTester("f");
  formTester.setValue("text","newValue");
  formTester.submit();
  page=(ExpirationRecoveryPage)tester.getLastRenderedPage();
  assertFalse("Form should not be submitted",page.formSubmitted.get());
  assertEquals("TextField's value should not be modified",textOldValue,page.textModel.getObject());
  assertEquals("PageParameters should be preserved",parameters,page.getPageParameters());
}
