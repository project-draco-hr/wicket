{
  Charset charset=null;
  if (request != null) {
    String charsetName=request.getCharacterEncoding();
    if (charsetName != null) {
      charset=Charset.forName(charsetName);
    }
  }
  if (charset == null) {
    charset=getDefaultCharset();
  }
  return charset;
}
