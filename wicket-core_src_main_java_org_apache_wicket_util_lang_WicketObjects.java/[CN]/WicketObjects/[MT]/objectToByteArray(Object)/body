{
  try {
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    ObjectOutputStream oos=null;
    try {
      oos=objectStreamFactory.newObjectOutputStream(out);
      if (Application.exists()) {
        oos.writeObject(Application.get().getApplicationKey());
      }
 else {
        oos.writeObject(null);
      }
      oos.writeObject(object);
    }
  finally {
      try {
        IOUtils.close(oos);
      }
  finally {
        out.close();
      }
    }
    return out.toByteArray();
  }
 catch (  Exception e) {
    log.error("Error serializing object " + object.getClass() + " [object="+ object+ "]",e);
  }
  return null;
}
