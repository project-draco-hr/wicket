{
  if (!(requestTarget instanceof IBookmarkablePageRequestTarget)) {
    throw new IllegalArgumentException("This encoder can only be used with " + "instances of " + IBookmarkablePageRequestTarget.class.getName());
  }
  final AppendingStringBuffer url=new AppendingStringBuffer(40);
  url.append(getMountPath());
  final IBookmarkablePageRequestTarget target=(IBookmarkablePageRequestTarget)requestTarget;
  PageParameters pageParameters=target.getPageParameters();
  if (target instanceof BookmarkableListenerInterfaceRequestTarget) {
    BookmarkableListenerInterfaceRequestTarget interfaceRequestTarget=(BookmarkableListenerInterfaceRequestTarget)target;
    final AppendingStringBuffer value=new AppendingStringBuffer(32);
    value.append(Component.PATH_SEPARATOR);
    value.append(interfaceRequestTarget.getComponentPath());
    value.append(Component.PATH_SEPARATOR);
    value.append(Component.PATH_SEPARATOR);
    value.append(interfaceRequestTarget.getInterfaceName());
    if (pageParameters == null) {
      pageParameters=new PageParameters();
    }
    pageParameters.put(AbstractWebRequestCodingStrategy.INTERFACE_PARAMETER_NAME,value);
  }
  String pagemap=pageMapName != null ? pageMapName : target.getPageMapName();
  if (pagemap != null) {
    if (pageParameters == null) {
      pageParameters=new PageParameters();
    }
    pageParameters.put(AbstractWebRequestCodingStrategy.PAGEMAP,pagemap);
  }
  appendParameters(url,pageParameters);
  return url;
}
