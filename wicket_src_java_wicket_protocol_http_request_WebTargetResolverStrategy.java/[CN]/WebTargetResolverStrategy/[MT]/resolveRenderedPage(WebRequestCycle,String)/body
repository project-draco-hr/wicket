{
  final WebRequest webRequest=webRequestCycle.getWebRequest();
  final String pageMapName=webRequest.getParameter("pagemap");
  final String versionNumberString=webRequest.getParameter("version");
  final int versionNumber=Strings.isEmpty(versionNumberString) ? 0 : Integer.parseInt(versionNumberString);
  final Session session=webRequestCycle.getSession();
  final Page page=session.getPage(pageMapName,componentPath,versionNumber);
  if (page != null) {
    webRequestCycle.setUpdateCluster(true);
    String componentPart=Strings.afterFirstPathComponent(componentPath,':');
    if (!Strings.isEmpty(componentPart)) {
    }
    final Component component=page.get(componentPart);
    if (!component.isVisible()) {
      throw new WicketRuntimeException("Calling listener methods on components that are not visible is not allowed");
    }
    return new PageRequestTarget(page);
  }
 else {
    return new ExpiredPageClassRequestTarget();
  }
}
