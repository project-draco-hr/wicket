{
  String id=component.getMarkupId();
  final Response originalResponse=response;
  tempResponse.reset();
  RequestCycle.get().setResponse(tempResponse);
  Page page=component.getPage();
  if (page != null) {
    page.startComponentRender(component);
  }
  boolean old=component.getRenderBodyOnly();
  component.setRenderBodyOnly(true);
  component.doRender();
  component.setRenderBodyOnly(old);
  if (page != null) {
    page.endComponentRender(component);
  }
  RequestCycle.get().setResponse(originalResponse);
  response.write("<component id=\"" + id + "\" ");
  if (tempResponse.isContentsEncoded()) {
    response.write(" encoding=\"");
    response.write(tempResponse.getEncodingName());
    response.write("\" ");
  }
  response.write("><![CDATA[");
  response.write(tempResponse.getContents());
  response.write("]]></component>");
  tempResponse.reset();
}
