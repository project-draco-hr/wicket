{
  if (component.getRenderBodyOnly() == true) {
    throw new IllegalStateException("Ajax render cannot be called on component that has setRenderBodyOnly enabled. Component: " + component.toString());
  }
  final Response originalResponse=response;
  encodingResponse.reset();
  RequestCycle.get().setResponse(encodingResponse);
  final Page page=component.getPage();
  final boolean versioned=(page != null) ? page.isVersioned() : false;
  if (page != null) {
    page.setVersioned(false);
    page.startComponentRender(component);
  }
  component.renderComponent();
  if (page != null) {
    page.endComponentRender(component);
    page.setVersioned(versioned);
  }
  RequestCycle.get().setResponse(originalResponse);
  response.write("<component id=\"" + markupId + "\" ");
  if (encodingResponse.isContentsEncoded()) {
    response.write(" encoding=\"");
    response.write(getEncodingName());
    response.write("\" ");
  }
  response.write("><![CDATA[");
  response.write(encodingResponse.getContents());
  response.write("]]></component>");
  encodingResponse.reset();
}
