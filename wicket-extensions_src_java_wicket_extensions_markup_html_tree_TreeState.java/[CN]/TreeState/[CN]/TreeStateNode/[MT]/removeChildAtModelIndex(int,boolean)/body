{
  TreeStateNode childNode=getChildAtModelIndex(modelIndex);
  if (childNode != null) {
    int row=childNode.getRow();
    int index=getIndex(childNode);
    childNode.collapse(false);
    remove(index);
    adjustChildIndexs(index,-1);
    childCount--;
    if (isChildVisible) {
      resetChildrenRowsFrom(row,index,modelIndex);
    }
  }
 else {
    int maxCounter=getChildCount();
    TreeStateNode aChild;
    for (int counter=0; counter < maxCounter; counter++) {
      aChild=(TreeStateNode)getChildAt(counter);
      if (aChild.childIndex >= modelIndex) {
        if (isChildVisible) {
          adjustRowBy(-1,counter);
          adjustRowCountBy(-1);
        }
        for (; counter < maxCounter; counter++) {
          ((TreeStateNode)getChildAt(counter)).childIndex--;
        }
        childCount--;
        return;
      }
    }
    if (isChildVisible) {
      adjustRowBy(-1,maxCounter);
      adjustRowCountBy(-1);
    }
    childCount--;
  }
}
