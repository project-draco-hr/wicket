{
  XmlTag xmlTag=(XmlTag)getParent().nextTag();
  if (xmlTag == null) {
    return xmlTag;
  }
  ComponentTag tag;
  if (componentNameAttribute.equalsIgnoreCase(xmlTag.getNamespace()) || (applyDefaultComponentName && ComponentTag.DEFAULT_COMPONENT_NAME_ATTRIBUTE.equalsIgnoreCase(xmlTag.getNamespace()))) {
    tag=new ComponentWicketTag(xmlTag);
    tag.setComponentId(tag.getName());
  }
 else {
    tag=new ComponentTag(xmlTag);
  }
  final String id=xmlTag.getAttributes().getString("id");
  if ((id != null) && id.startsWith(componentNameAttribute + "-")) {
    tag.setComponentId(id.substring(componentNameAttribute.length() + 1).trim());
    if (this.stripWicketFromComponentTag) {
      tag.put("id",tag.getComponentId());
    }
  }
 else   if ((id != null) && applyDefaultComponentName && id.startsWith(ComponentTag.DEFAULT_COMPONENT_NAME_ATTRIBUTE)) {
    tag.setComponentId(id.substring(ComponentTag.DEFAULT_COMPONENT_NAME_ATTRIBUTE.length() + 1).trim());
    if (this.stripWicketFromComponentTag) {
      tag.put("id",tag.getComponentId());
    }
  }
 else   if (tag.getAttributes().containsKey(componentNameAttribute)) {
    tag.setComponentId(tag.getAttributes().getString(componentNameAttribute));
  }
 else   if (applyDefaultComponentName && tag.getAttributes().containsKey(ComponentTag.DEFAULT_COMPONENT_NAME_ATTRIBUTE)) {
    tag.setComponentId(tag.getAttributes().getString(ComponentTag.DEFAULT_COMPONENT_NAME_ATTRIBUTE));
  }
  return tag;
}
