{
  bytearray=new ByteArrayOutputStream();
  try {
    int BUFFER=2048;
    BufferedInputStream origin=null;
    ZipOutputStream out=new ZipOutputStream(bytearray);
    byte data[]=new byte[BUFFER];
    String files[]=dir.list();
    if (files == null)     throw new IllegalArgumentException("Not a directory: " + dir);
    for (int i=0; i < files.length; i++) {
      log.debug("Adding: " + files[i]);
      FileInputStream fi=new FileInputStream(new File(dir,files[i]));
      origin=new BufferedInputStream(fi,BUFFER);
      ZipEntry entry=new ZipEntry(files[i]);
      out.putNextEntry(entry);
      int count;
      while ((count=origin.read(data,0,BUFFER)) != -1) {
        out.write(data,0,count);
      }
      origin.close();
    }
    out.close();
  }
 catch (  Exception e) {
    throw new WicketRuntimeException(e);
  }
}
