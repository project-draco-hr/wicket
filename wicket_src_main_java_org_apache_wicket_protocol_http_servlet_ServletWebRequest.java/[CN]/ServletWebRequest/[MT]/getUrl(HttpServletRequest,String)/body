{
  if (filterPrefix.length() > 0 && !filterPrefix.endsWith("/")) {
    filterPrefix+="/";
  }
  StringBuilder url=new StringBuilder();
  String uri=request.getRequestURI();
  url.append(Strings.stripJSessionId(uri.substring(request.getContextPath().length() + filterPrefix.length() + 1)));
  String query=request.getQueryString();
  if (!Strings.isEmpty(query)) {
    url.append("?");
    url.append(query);
  }
  return Url.parse(Strings.stripJSessionId(url.toString()));
}
