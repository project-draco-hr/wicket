{
  if (!isAjax()) {
    return Url.parse(getBaseUrl(httpServletRequest,filterPrefix).toString(),getCharset());
  }
 else {
    String base=null;
    base=getHeader(HEADER_AJAX_BASE_URL);
    if (base == null) {
      base=getRequestParameters().getParameterValue(PARAM_AJAX_BASE_URL).toString(null);
    }
    Checks.notNull(base,"Current ajax request is missing the base url header or parameter");
    return Url.parse(base,getCharset());
  }
}
