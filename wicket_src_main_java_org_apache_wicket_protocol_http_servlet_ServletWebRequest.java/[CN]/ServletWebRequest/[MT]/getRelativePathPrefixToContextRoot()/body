{
  if (relativePathPrefixToContextRoot != null) {
    return relativePathPrefixToContextRoot;
  }
  if (RequestContext.get().isPortletRequest()) {
    return relativePathPrefixToContextRoot=getHttpServletRequest().getContextPath() + "/";
  }
  String tmp=getRelativePathPrefixToWicketHandler();
  PrependingStringBuffer prepender=new PrependingStringBuffer(tmp);
  String path=WicketURLDecoder.PATH_INSTANCE.decode(getPath());
  if (path == null || path.length() == 0) {
    path="";
  }
  String wicketPath="";
  String servletPath=getServletPath();
  if (servletPath.endsWith(path)) {
    int len=servletPath.length() - path.length() - 1;
    if (len < 0) {
      len=0;
    }
    wicketPath=servletPath.substring(0,len);
  }
 else {
    wicketPath=servletPath;
  }
  for (int i=0; i < wicketPath.length(); i++) {
    if (wicketPath.charAt(i) == '/') {
      prepender.prepend("../");
    }
  }
  return relativePathPrefixToContextRoot=prepender.toString();
}
