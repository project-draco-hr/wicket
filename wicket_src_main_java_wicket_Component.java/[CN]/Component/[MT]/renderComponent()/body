{
  if (this instanceof Page) {
    ((Page)this).renderPage();
  }
 else {
    MarkupContainer parent=getParent();
    if (parent == null) {
      throw new WicketRuntimeException("Expected the Component to have a parent container: " + getId());
    }
    MarkupStream markupStream=new MarkupStream(getMarkupFragment());
    parent.setMarkupStream(markupStream);
    try {
      if (this instanceof MarkupContainer) {
        MarkupContainer<T> container=(MarkupContainer<T>)this;
        container.visitChildren(IFeedback.class,new IVisitor(){
          public Object component(          Component component){
            ((IFeedback)component).updateFeedback();
            component.internalAttach();
            AnnotationUtils.invokeOnAttachListeners(component);
            return IVisitor.CONTINUE_TRAVERSAL;
          }
        }
);
      }
      if (this instanceof IFeedback) {
        ((IFeedback)this).updateFeedback();
      }
      internalAttach();
      setRenderAllowed(isActionAuthorized(RENDER));
      if (this instanceof MarkupContainer) {
        MarkupContainer container=(MarkupContainer)this;
        container.visitChildren(new IVisitor(){
          public Object component(          final Component component){
            final boolean renderAllowed=component.isActionAuthorized(RENDER);
            component.setRenderAllowed(renderAllowed);
            return IVisitor.CONTINUE_TRAVERSAL;
          }
        }
);
      }
      onBeforeRender();
      AnnotationUtils.invokeOnBeforeRenderListeners(this);
      render(markupStream);
    }
  finally {
      onAfterRender();
      AnnotationUtils.invokeOnAfterRenderListeners(this);
    }
  }
}
