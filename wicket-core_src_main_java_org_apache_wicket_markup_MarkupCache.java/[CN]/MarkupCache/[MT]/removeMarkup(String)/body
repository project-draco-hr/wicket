{
  Args.notNull(cacheKey,"cacheKey");
  if (log.isDebugEnabled()) {
    log.debug("Remove from cache: cacheKey=" + cacheKey);
  }
  String locationString=markupKeyCache.get(cacheKey);
  IMarkupFragment markup=(locationString != null ? markupCache.get(locationString) : null);
  if (markup != null) {
    markupCache.remove(locationString);
    int count=1;
    while (count > 0) {
      count=0;
      Iterator<String> iter=markupCache.getKeys().iterator();
      while (iter.hasNext()) {
        String key=iter.next();
        if (isBaseMarkupCached(key)) {
          if (log.isDebugEnabled()) {
            log.debug("Remove from cache: cacheKey=" + key);
          }
          iter.remove();
          count++;
        }
      }
    }
    IModificationWatcher watcher=application.getResourceSettings().getResourceWatcher(false);
    if (watcher != null) {
      Iterator<IModifiable> iter=watcher.getEntries().iterator();
      while (iter.hasNext()) {
        IModifiable modifiable=iter.next();
        if (modifiable instanceof MarkupResourceStream) {
          if (isMarkupCached((MarkupResourceStream)modifiable)) {
            iter.remove();
          }
        }
      }
    }
  }
  return markup;
}
