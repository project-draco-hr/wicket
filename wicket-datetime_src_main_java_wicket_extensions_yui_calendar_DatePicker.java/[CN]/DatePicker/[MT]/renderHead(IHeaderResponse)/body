{
  response.renderJavascriptReference(new CompressedResourceReference(YuiLib.class,"yahoo-min.js"));
  response.renderJavascriptReference(new CompressedResourceReference(YuiLib.class,"event-min.js"));
  response.renderJavascriptReference(new CompressedResourceReference(YuiLib.class,"dom-min.js"));
  response.renderJavascriptReference(new CompressedResourceReference(DatePicker.class,"calendar-min.js"));
  response.renderCSSReference(new CompressedResourceReference(DatePicker.class,"assets/calendar.css"));
  String markupId=getCalendarMarkupId();
  String javascriptId=getCalendarJavascriptId();
  String javascriptWidgetId="YAHOO.wicket." + getCalendarJavascriptId();
  StringBuffer buffer=new StringBuffer();
  buffer.append("YAHOO.namespace(\"wicket\");\nfunction init");
  buffer.append(javascriptId);
  buffer.append("() {\n");
  buffer.append("  ");
  buffer.append(javascriptWidgetId);
  buffer.append(" = new YAHOO.widget.Calendar(\"");
  buffer.append(javascriptId);
  buffer.append("\",\"");
  buffer.append(markupId);
  Properties p=new Properties();
  configureWidgetProperties(p);
  buffer.append("\", { ");
  for (Iterator i=p.entrySet().iterator(); i.hasNext(); ) {
    Entry entry=(Entry)i.next();
    buffer.append(entry.getKey());
    Object value=entry.getValue();
    if (value instanceof CharSequence) {
      buffer.append(":\"");
      buffer.append(value);
      buffer.append("\"");
    }
 else {
      buffer.append(":");
      buffer.append(value);
    }
    if (i.hasNext()) {
      buffer.append(",");
    }
  }
  buffer.append(" });\n");
  buffer.append("  YAHOO.util.Event.addListener(\"");
  String iconId=getIconId();
  buffer.append(iconId);
  buffer.append("\", \"click\", ");
  buffer.append(javascriptWidgetId);
  buffer.append(".show, ");
  buffer.append(javascriptWidgetId);
  buffer.append(", true);\n");
  buffer.append("  function selectHandler(type, args, cal) {\n");
  buffer.append("    var selDateArray = args[0][0];\n");
  buffer.append("    var yr = selDateArray[0];\n");
  buffer.append("    var month = selDateArray[1];\n");
  buffer.append("    var dt = selDateArray[2];\n");
  buffer.append("    var val = '");
  String datePattern=((IDatePatternProvider)component).getDatePattern();
  buffer.append(datePattern);
  buffer.append("'.replace(/d+/, dt).replace(/M+/, month)");
  buffer.append(".replace(/y+/, yr);\n    YAHOO.util.Dom.get(\"");
  buffer.append(component.getMarkupId());
  buffer.append("\").value = val;\n");
  buffer.append("    cal.hide();\n  }\n");
  buffer.append("  ");
  buffer.append(javascriptWidgetId);
  buffer.append(".selectEvent.subscribe(selectHandler, ");
  buffer.append(javascriptWidgetId);
  buffer.append(");\n");
  appendToInit(markupId,javascriptId,javascriptWidgetId,buffer);
  buffer.append("  ");
  buffer.append(javascriptWidgetId);
  buffer.append(".render();\n");
  buffer.append("}\n");
  buffer.append("YAHOO.util.Event.addListener(window, \"load\", init");
  buffer.append(javascriptId);
  buffer.append(");");
  buffer.insert(0,JavascriptUtils.SCRIPT_OPEN_TAG);
  buffer.append(JavascriptUtils.SCRIPT_CLOSE_TAG);
  response.renderString(buffer);
}
