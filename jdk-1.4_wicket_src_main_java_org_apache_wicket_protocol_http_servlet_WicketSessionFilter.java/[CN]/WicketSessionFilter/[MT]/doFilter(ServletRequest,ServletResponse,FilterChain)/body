{
  WebApplication webApplication=(WebApplication)filterConfig.getServletContext().getAttribute(WebApplication.SERVLET_CONTEXT_APPLICATION_KEY);
  if (webApplication != null) {
    Application.set(webApplication);
  }
  HttpServletRequest httpServletRequest=((HttpServletRequest)request);
  HttpSession httpSession=httpServletRequest.getSession(false);
  if (httpSession != null) {
    Session session=(Session)httpSession.getAttribute(sessionKey);
    if (session != null) {
      Session.set(session);
      if (log.isDebugEnabled()) {
        log.debug("session " + session + " set as current for "+ httpServletRequest.getContextPath()+ ","+ httpServletRequest.getServerName());
      }
    }
 else {
      if (log.isDebugEnabled()) {
        log.debug("could not set Wicket session: key " + sessionKey + " not found in http session for "+ httpServletRequest.getContextPath()+ ","+ httpServletRequest.getServerName());
      }
    }
  }
 else {
    if (log.isDebugEnabled()) {
      log.debug("could not set Wicket session: no http session was created yet for " + httpServletRequest.getContextPath() + ","+ httpServletRequest.getServerName());
    }
  }
  chain.doFilter(request,response);
  Session.unset();
  if (webApplication != null) {
    Application.unset();
  }
}
