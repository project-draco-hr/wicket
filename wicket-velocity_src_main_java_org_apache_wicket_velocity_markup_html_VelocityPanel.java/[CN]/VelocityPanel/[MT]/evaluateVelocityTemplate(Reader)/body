{
  if (evaluatedTemplate == null) {
    final Map map=(Map)getDefaultModelObject();
    final VelocityContext ctx=new VelocityContext(map);
    StringWriter writer=new StringWriter();
    final String logTag=getId();
    try {
      Velocity.evaluate(ctx,writer,logTag,templateReader);
      evaluatedTemplate=writer.toString();
      if (escapeHtml()) {
        evaluatedTemplate=Strings.escapeMarkup(evaluatedTemplate).toString();
      }
      return evaluatedTemplate;
    }
 catch (    IOException e) {
      onException(e);
    }
catch (    ParseErrorException e) {
      onException(e);
    }
catch (    MethodInvocationException e) {
      onException(e);
    }
catch (    ResourceNotFoundException e) {
      onException(e);
    }
    return null;
  }
  return evaluatedTemplate;
}
