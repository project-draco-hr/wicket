{
  WebApplication webApplication=(WebApplication)application;
  ServletContext servletContext=webApplication.getServletContext();
  MetricRegistry metricRegistry=(MetricRegistry)servletContext.getAttribute(METRICS_SERVLET_REGISTRY);
  WicketMetricsSettings metricsSettings=(WicketMetricsSettings)servletContext.getAttribute(WICKET_METRICS_SETTINGS);
  if (metricRegistry == null) {
    metricRegistry=new MetricRegistry();
    metricsSettings=new WicketMetricsSettings();
    servletContext.setAttribute(METRICS_SERVLET_REGISTRY,metricRegistry);
    servletContext.setAttribute(WICKET_METRICS_SETTINGS,metricsSettings);
  }
  application.setMetaData(WicketMetrics.METRIC_REGISTRY,metricRegistry);
  application.setMetaData(WicketMetrics.METRIC_SETTINGS,metricsSettings);
}
