{
  if (path != null) {
    TreeStateNode node;
    node=getMapping(path);
    if (node != null) {
      if (onlyIfVisible && !node.isVisible()) {
        return null;
      }
      return node;
    }
    if (onlyIfVisible) {
      return null;
    }
    ArrayListStack paths;
    if (tempStacks.size() == 0) {
      paths=new ArrayListStack();
    }
 else {
      paths=(ArrayListStack)tempStacks.pop();
    }
    try {
      paths.push(path);
      path=path.getParentPath();
      node=null;
      while (path != null) {
        node=getMapping(path);
        if (node != null) {
          while (node != null && paths.size() > 0) {
            path=(TreePath)paths.pop();
            node=node.createChildFor(path.getLastPathComponent());
          }
          return node;
        }
        paths.push(path);
        path=path.getParentPath();
      }
    }
  finally {
      paths.clear();
      tempStacks.push(paths);
    }
    return null;
  }
  return null;
}
