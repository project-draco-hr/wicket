{
  final IResourceSettings resourceSettings=Application.get().getResourceSettings();
  boolean addedToPage=false;
  if (component != null) {
    if ((component instanceof Page) || null != component.findParent(Page.class)) {
      addedToPage=true;
    }
    if (!addedToPage) {
      logger.warn("Tried to retrieve a localized string for a component that has not yet been added to the page. " + "This can sometimes lead to an invalid or no localized resource returned. " + "Make sure you are not calling Component#getString() inside your Component's constructor. "+ "Offending component: {}",component);
    }
  }
  String cacheKey=null;
  String string=null;
  if ((cache != null) && addedToPage) {
    cacheKey=getCacheKey(key,component);
  }
  if ((cacheKey != null) && cache.containsKey(cacheKey)) {
    string=getFromCache(cacheKey);
  }
 else {
    Iterator<IStringResourceLoader> iter=resourceSettings.getStringResourceLoaders().iterator();
    while (iter.hasNext()) {
      IStringResourceLoader loader=iter.next();
      string=loader.loadStringResource(component,key);
      if (string != null) {
        break;
      }
    }
    if (cacheKey != null) {
      putIntoCache(cacheKey,string);
    }
  }
  if ((string == null) && (defaultValue != null)) {
    if (resourceSettings.getUseDefaultOnMissingResource()) {
      string=defaultValue;
    }
  }
  if (string != null) {
    return substitutePropertyExpressions(component,string,model);
  }
  if (resourceSettings.getThrowExceptionOnMissingResource()) {
    AppendingStringBuffer message=new AppendingStringBuffer("Unable to find resource: " + key);
    if (component != null) {
      message.append(" for component: ");
      message.append(component.getPageRelativePath());
      message.append(" [class=").append(component.getClass().getName()).append("]");
    }
    throw new MissingResourceException(message.toString(),(component != null ? component.getClass().getName() : ""),key);
  }
  return "[Warning: String resource for '" + key + "' not found]";
}
