{
  int i=0;
  byte b;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  int size=0;
  while (i < HEADER_SEPARATOR.length) {
    try {
      b=readByte();
    }
 catch (    IOException e) {
      throw new MalformedStreamException("Stream ended unexpectedly");
    }
    if (++size > HEADER_PART_SIZE_MAX) {
      throw new MalformedStreamException("Header section has more than " + HEADER_PART_SIZE_MAX + " bytes (maybe it is not properly terminated)");
    }
    if (b == HEADER_SEPARATOR[i]) {
      i++;
    }
 else {
      i=0;
    }
    baos.write(b);
  }
  String headers=null;
  if (headerEncoding != null) {
    try {
      headers=baos.toString(headerEncoding);
    }
 catch (    UnsupportedEncodingException e) {
      headers=baos.toString();
    }
  }
 else {
    headers=baos.toString();
  }
  return headers;
}
