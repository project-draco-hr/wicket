{
  s.defaultWriteObject();
  IPageStore store=getPageStore();
  if (sessionId != null && store instanceof IClusteredPageStore == false) {
    Object page=lastPage;
    if (store instanceof ISerializationAwarePageStore) {
      page=((ISerializationAwarePageStore)store).prepareForSerialization(sessionId,page);
    }
    try {
      s.writeObject(page);
    }
 catch (    Exception e) {
      throw new WicketRuntimeException("Failed to serialize " + page.toString(),e);
    }
  }
}
