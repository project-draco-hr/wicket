{
  IMarkupFragment markup=chooseMarkup();
  if (markup == null) {
    throw new MarkupException("chooseMarkup() returned null. No markup to search for fragment markup with id: " + markupId);
  }
  IMarkupFragment childMarkup=markup.find(markupId);
  if (childMarkup == null) {
    MarkupContainer markupProvider=getMarkupProvider();
    if (markupProvider.hasAssociatedMarkup()) {
      markup=markupProvider.getAssociatedMarkup();
      if (markup != null) {
        childMarkup=markup.find(markupId);
      }
    }
  }
  if (childMarkup == null) {
    throw new MarkupNotFoundException("No Markup found for Fragment " + markupId + " in providing markup container "+ markupProvider.toString());
  }
  if (child == null) {
    return childMarkup;
  }
  return childMarkup.find(child.getId());
}
