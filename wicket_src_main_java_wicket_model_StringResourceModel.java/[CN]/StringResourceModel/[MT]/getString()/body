{
  if (getLocalizer() == null) {
    if (component != null) {
      setLocalizer(component.getLocalizer());
    }
 else {
      throw new IllegalStateException("No localizer has been set");
    }
  }
  String s=localizer.getString(getResourceKey(),component,model);
  if (s == null) {
    s=defaultValue;
  }
  if (s != null) {
    Object[] parameters=getParameters();
    if (parameters != null) {
      Object[] realParams=new Object[parameters.length];
      for (int i=0; i < parameters.length; i++) {
        if (parameters[i] instanceof IModel) {
          realParams[i]=((IModel)parameters[i]).getObject();
        }
 else         if (model != null && parameters[i] instanceof String) {
          realParams[i]=PropertyVariableInterpolator.interpolate((String)parameters[i],model.getObject());
        }
 else {
          realParams[i]=parameters[i];
        }
      }
      final MessageFormat format=new MessageFormat(s,component != null ? component.getLocale() : locale);
      s=format.format(realParams);
    }
  }
  return s;
}
