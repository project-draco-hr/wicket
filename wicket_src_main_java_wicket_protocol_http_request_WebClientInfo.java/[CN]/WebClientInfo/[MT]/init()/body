{
  String userAgent=getUserAgent().toLowerCase();
  boolean browserOpera=userAgent.indexOf("opera") != -1;
  boolean browserSafari=userAgent.indexOf("safari") != -1;
  boolean browserKonqueror=userAgent.indexOf("konqueror") != -1;
  boolean deceptiveUserAgent=browserOpera || browserSafari || browserKonqueror;
  boolean browserMozilla=!deceptiveUserAgent && userAgent.indexOf("gecko") != -1;
  boolean browserFireFox=userAgent.indexOf("firefox") != -1;
  boolean browserInternetExplorer=!deceptiveUserAgent && userAgent.indexOf("msie") != -1;
  int majorVersion=-1, minorVersion=-1;
  if (browserOpera) {
    properties.setProperty(ClientProperties.BROWSER_OPERA,Boolean.TRUE);
  }
 else   if (browserKonqueror) {
    properties.setProperty(ClientProperties.BROWSER_KONQUEROR,Boolean.TRUE);
  }
 else   if (browserSafari) {
    properties.setProperty(ClientProperties.BROWSER_SAFARI,Boolean.TRUE);
  }
 else   if (browserMozilla) {
    properties.setProperty(ClientProperties.BROWSER_MOZILLA,Boolean.TRUE);
    if (browserFireFox) {
      properties.setProperty(ClientProperties.BROWSER_MOZILLA_FIREFOX,Boolean.TRUE);
    }
  }
 else   if (browserInternetExplorer) {
    properties.setProperty(ClientProperties.BROWSER_INTERNET_EXPLORER,Boolean.TRUE);
    if (userAgent.indexOf("msie 6.") != -1) {
      majorVersion=6;
    }
 else     if (userAgent.indexOf("msie 7.") != -1) {
      majorVersion=7;
    }
  }
  if (majorVersion != -1) {
    properties.setProperty(ClientProperties.BROWSER_VERSION_MAJOR,Integer.toString(majorVersion));
  }
  if (minorVersion != -1) {
    properties.setProperty(ClientProperties.BROWSER_VERSION_MINOR,Integer.toString(minorVersion));
  }
  if (browserInternetExplorer) {
    properties.setProperty(ClientProperties.PROPRIETARY_IE_CSS_EXPRESSIONS_SUPPORTED,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_CSS_POSITIONING_ONE_SIDE_ONLY,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_IE_REPAINT,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_IE_SELECT_Z_INDEX,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_IE_TEXTAREA_NEWLINE_OBLITERATION,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_IE_SELECT_PERCENT_WIDTH,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_IE_SELECT_LIST_DOM_UPDATE,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_IE_TABLE_PERCENT_WIDTH_SCROLLBAR_ERROR,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_CSS_BACKGROUND_ATTACHMENT_USE_FIXED,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_CSS_BORDER_COLLAPSE_INSIDE,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_CSS_BORDER_COLLAPSE_FOR_0_PADDING,Boolean.TRUE);
    if (majorVersion < 7) {
      properties.setProperty(ClientProperties.PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED,Boolean.TRUE);
    }
  }
  if (browserMozilla) {
    properties.setProperty(ClientProperties.QUIRK_MOZILLA_TEXT_INPUT_REPAINT,Boolean.TRUE);
    properties.setProperty(ClientProperties.QUIRK_MOZILLA_PERFORMANCE_LARGE_DOM_REMOVE,Boolean.TRUE);
  }
  if (log.isDebugEnabled()) {
    log.debug("determined user agent: " + properties);
  }
}
