{
  final IResourceSettings settings=application.getResourceSettings();
  Class clazz=(component != null ? component.getClass() : null);
  String id=createCacheId(clazz,locale,style,key);
  String string=getCachedValue(id);
  if (string == null) {
    final List searchStack;
    final String path;
    if (component != null) {
      searchStack=getComponentStack(component);
      path=Strings.replaceAll(component.getPageRelativePath(),":",".");
    }
 else {
      searchStack=new ArrayList(0);
      searchStack.add(Application.get().getClass());
      path=null;
    }
    string=getString(key,path,searchStack,locale,style);
  }
  if (string != null) {
    return substitutePropertyExpressions(component,string,model);
  }
  if (settings.getUseDefaultOnMissingResource() && (defaultValue != null)) {
    return defaultValue;
  }
  if (settings.getThrowExceptionOnMissingResource()) {
    throw new MissingResourceException("Unable to find resource: " + key,(clazz != null ? getClass().getName() : ""),key);
  }
 else {
    return "[Warning: String resource for '" + key + "' not found]";
  }
}
