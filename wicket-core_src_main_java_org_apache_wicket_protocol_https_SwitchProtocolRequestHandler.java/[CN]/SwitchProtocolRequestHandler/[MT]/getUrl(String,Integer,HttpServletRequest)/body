{
  StringBuilder result=new StringBuilder();
  result.append(protocol);
  result.append("://");
  result.append(request.getServerName());
  if (port != null) {
    result.append(":");
    result.append(port);
  }
  result.append(request.getRequestURI());
  if (request.getQueryString() != null) {
    result.append("?");
    result.append(request.getQueryString());
  }
  return result.toString();
}
