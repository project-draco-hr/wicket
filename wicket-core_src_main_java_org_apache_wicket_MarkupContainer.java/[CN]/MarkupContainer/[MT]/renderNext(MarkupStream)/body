{
  final MarkupElement element=markupStream.get();
  if ((element instanceof ComponentTag) && !markupStream.atCloseTag()) {
    final ComponentTag tag=(ComponentTag)element;
    final String id=tag.getId();
    Component component=get(id);
    if (component == null) {
      component=ComponentResolvers.resolve(this,markupStream,tag,null);
      if ((component != null) && (component.getParent() == null)) {
        autoAdd(component,markupStream);
      }
 else       if (component != null) {
        component.setMarkup(markupStream.getMarkupFragment());
      }
    }
    if (component != null) {
      component.render();
    }
 else     if (tag.getFlag(ComponentTag.RENDER_RAW)) {
      getResponse().write(element.toCharSequence());
      return true;
    }
 else {
      if (tag instanceof WicketTag) {
        if (((WicketTag)tag).isChildTag()) {
          markupStream.throwMarkupException("Found " + tag.toString() + " but no <wicket:extend>");
        }
 else {
          markupStream.throwMarkupException("Failed to handle: " + tag.toString() + ". It might be that no resolver has been registered to handle this special tag. "+ " But it also be that you declared wicket:id="+ id+ " in your markup, but that you either did not add the "+ "component to your page at all, or that the hierarchy does not match.");
        }
      }
      List<String> names=findSimilarComponents(id);
      StringBuffer msg=new StringBuffer(500);
      msg.append("Unable to find component with id '");
      msg.append(id);
      msg.append("' in ");
      msg.append(this.toString());
      msg.append("\n\tExpected: '");
      msg.append(getPageRelativePath());
      msg.append(".");
      msg.append(id);
      msg.append("'.\n\tFound with similar names: '");
      msg.append(Strings.join("', ",names));
      msg.append("'");
      log.error(msg.toString());
      markupStream.throwMarkupException(msg.toString());
    }
  }
 else {
    getResponse().write(element.toCharSequence());
    return true;
  }
  return false;
}
