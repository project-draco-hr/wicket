{
  HttpServletRequest req=((ServletWebRequest)getRequest()).getHttpServletRequest();
  StringBuffer buildUrl=new StringBuffer(url.length());
  String scheme=req.getScheme();
  int port=req.getServerPort();
  buildUrl.append(scheme);
  buildUrl.append("://");
  buildUrl.append(req.getServerName());
  if ((scheme.equals("http") && port != 80) || (scheme.equals("https") && port != 443)) {
    buildUrl.append(':');
    buildUrl.append(req.getServerPort());
  }
  buildUrl.append(req.getContextPath()).append('/').append(url);
  return importAbsoluteUrl(buildUrl);
}
