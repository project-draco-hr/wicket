{
  final Page page=getPage();
  final HeaderContainer headerContainer=(HeaderContainer)page.get(HtmlHeaderSectionHandler.HEADER_ID);
  fragment.visitChildren(MarkupFragment.class,new MarkupFragment.IVisitor(){
    private boolean foundBody=false;
    /** 
 * @see wicket.markup.MarkupFragment.IVisitor#visit(wicket.markup.MarkupElement,wicket.markup.MarkupFragment)
 */
    public Object visit(    final MarkupElement element,    final MarkupFragment parent){
      final MarkupFragment frag=(MarkupFragment)element;
      final ComponentTag tag=frag.getTag();
      if (tag.isWicketHeadTag()) {
        if (foundBody == true) {
          throwMarkupException(fragment,tag,"<wicket:head> must be before the <body>, <wicket:panel> ... tag");
        }
        WicketHeadContainer header=newWicketHeaderContainer(frag);
        header.setEnable(headerContainer.okToRender(header));
        header.render(new MarkupStream(frag));
        return CONTINUE_TRAVERSAL_BUT_DONT_GO_DEEPER;
      }
 else       if (tag.isBodyTag()) {
        foundBody=true;
        if (page instanceof WebPage) {
          addBodyModifier(BodyContainer.ONLOAD,tag);
          addBodyModifier(BodyContainer.ONUNLOAD,tag);
        }
      }
 else       if (tag.isMajorWicketComponentTag()) {
        foundBody=true;
      }
      return CONTINUE_TRAVERSAL;
    }
  }
);
}
