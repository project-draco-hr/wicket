{
  ICrypt urlCrypt=Application.get().newCrypt();
  if (urlCrypt != null) {
    final int pos=url.indexOf('?');
    if (pos > 0) {
      String urlPrefix=url.substring(0,pos);
      String queryString=url.substring(pos + 1);
      if (!queryString.startsWith("x=")) {
        queryString=shortenUrl(queryString);
        final String encryptedQueryString=urlCrypt.encrypt(queryString);
        final String encryptedUrl=urlPrefix + "?x=" + escapeUrl(encryptedQueryString);
        return encryptedUrl;
      }
    }
  }
  return url;
}
