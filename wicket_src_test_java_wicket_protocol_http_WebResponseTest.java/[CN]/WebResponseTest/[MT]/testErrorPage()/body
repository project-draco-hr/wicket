{
  WicketTester tester=new WicketTester();
  tester.startPage(TestPage.class);
  AjaxLink link=(AjaxLink)tester.getComponentFromLastRenderedPage("link");
  tester.createRequestCycle();
  String callbackUrl=((AjaxEventBehavior)link.getBehaviors().get(0)).getCallbackUrl().toString();
  tester.setupRequestAndResponse();
  ((MockHttpServletRequest)tester.getServletRequest()).addHeader("Wicket-Ajax","Yes");
  tester.getServletRequest().setURL(callbackUrl);
  WebRequestCycle cycle=tester.createRequestCycle();
  cycle.request();
  assertNull(((MockHttpServletResponse)tester.getWicketResponse().getHttpServletResponse()).getRedirectLocation());
  String ajaxLocation=((MockHttpServletResponse)tester.getWicketResponse().getHttpServletResponse()).getHeader("Ajax-Location");
  log.debug(ajaxLocation);
  assertNotNull(ajaxLocation);
  tester.destroy();
}
