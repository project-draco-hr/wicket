{
  return new ResourceState(){
    private byte[] imageData;
    private final String contentType="image/" + format;
    @Override public Time lastModifiedTime(){
      if (lastModifiedTime == null) {
        lastModifiedTime=DynamicImageResource.this.lastModifiedTime;
        if (lastModifiedTime == null) {
          lastModifiedTime=Time.now();
        }
      }
      return lastModifiedTime;
    }
    @Override public byte[] getData(){
      if (imageData == null) {
        imageData=getImageData();
      }
      return imageData;
    }
    @Override public String getContentType(){
      return contentType;
    }
  }
;
}
