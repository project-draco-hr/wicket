{
  form.visitFormComponents(new FormComponent.IVisitor(){
    public void formComponent(    final FormComponent formComponent){
      formComponent.validate();
      if (!formComponent.isValid()) {
        formComponent.invalid();
      }
 else {
        formComponent.valid();
      }
    }
  }
);
  ModelChange record=new ModelChange(form);
  boolean wasVersioned=form.isVersioned();
  form.setVersioned(false);
  try {
    form.updateFormComponentModels();
    form.validator.validate(form);
  }
  finally {
    if (form.hasError()) {
      record.undo();
    }
    form.setVersioned(wasVersioned);
  }
}
