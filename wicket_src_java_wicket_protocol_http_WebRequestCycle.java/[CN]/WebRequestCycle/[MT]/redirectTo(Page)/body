{
  String redirectUrl=page.urlFor(page,IRedirectListener.class);
  ApplicationSettings settings=application.getSettings();
  if (settings.getRenderStrategy() == ApplicationSettings.REDIRECT_TO_BUFFER && application instanceof WebApplication) {
    try {
      Response currentResponse=getResponse();
      BufferedResponse redirectResponse=new BufferedResponse(redirectUrl);
      setResponse(redirectResponse);
      if (getInvokePage() == getResponsePage()) {
        setInvokePage(null);
      }
      page.doRender();
      setResponse(currentResponse);
      ((WebApplication)application).addRedirect(getWebRequest().getHttpServletRequest(),redirectUrl,redirectResponse);
    }
 catch (    RuntimeException ex) {
      onRuntimeException(page,ex);
    }
  }
 else {
    page.internalEndRequest();
  }
  response.redirect(redirectUrl);
}
