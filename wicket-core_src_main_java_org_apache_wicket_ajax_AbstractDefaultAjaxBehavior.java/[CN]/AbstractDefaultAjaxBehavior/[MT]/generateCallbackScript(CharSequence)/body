{
  final CharSequence onSuccessScript=getSuccessScript();
  final CharSequence onFailureScript=getFailureScript();
  final CharSequence precondition=getPreconditionScript();
  final IAjaxCallDecorator decorator=getAjaxCallDecorator();
  String indicatorId=findIndicatorId();
  CharSequence success=(onSuccessScript == null) ? "" : onSuccessScript;
  CharSequence failure=(onFailureScript == null) ? "" : onFailureScript;
  if (decorator != null) {
    success=decorator.decorateOnSuccessScript(getComponent(),success);
  }
  if (!Strings.isEmpty(indicatorId)) {
    String hide="; Wicket.DOM.hideIncrementally('" + indicatorId + "');";
    success=success + hide;
    failure=failure + hide;
  }
  if (decorator != null) {
    failure=decorator.decorateOnFailureScript(getComponent(),failure);
  }
  AppendingStringBuffer buff=new AppendingStringBuffer(256);
  buff.append("var ").append(IAjaxCallDecorator.WICKET_CALL_RESULT_VAR).append("=");
  buff.append(partialCall);
  buff.append(", Wicket.bind(function() { ").append(success).append("}, this)");
  buff.append(", Wicket.bind(function() { ").append(failure).append("}, this)");
  if (precondition != null) {
    buff.append(", Wicket.bind(function() {");
    buff.append(precondition);
    buff.append("}, this)");
  }
  AjaxChannel channel=getChannel();
  if (channel != null) {
    if (precondition == null) {
      buff.append(", null");
    }
    buff.append(", '");
    buff.append(channel.getChannelName());
    buff.append("'");
  }
  buff.append(");");
  CharSequence call=buff;
  if (!Strings.isEmpty(indicatorId)) {
    final AppendingStringBuffer indicatorWithPrecondition=new AppendingStringBuffer("if (");
    if (precondition != null) {
      indicatorWithPrecondition.append("Wicket.bind(function(){").append(precondition).append("}, this)()");
    }
 else {
      indicatorWithPrecondition.append("true");
    }
    indicatorWithPrecondition.append(") { Wicket.DOM.showIncrementally('").append(indicatorId).append("');}").append(call);
    call=indicatorWithPrecondition;
  }
  if (decorator != null) {
    call=decorator.decorateScript(getComponent(),call);
  }
  return call;
}
