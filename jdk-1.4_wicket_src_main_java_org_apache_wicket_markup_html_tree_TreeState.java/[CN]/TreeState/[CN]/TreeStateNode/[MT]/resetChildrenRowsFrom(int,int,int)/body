{
  int lastRow=newRow;
  int lastModelIndex=modelIndex;
  TreeStateNode node;
  int maxCounter=getChildCount();
  for (int counter=childIndex; counter < maxCounter; counter++) {
    node=(TreeStateNode)getChildAt(counter);
    lastRow+=(node.childIndex - lastModelIndex);
    lastModelIndex=node.childIndex + 1;
    if (node.isExpanded) {
      lastRow=node.setRowAndChildren(lastRow);
    }
 else {
      node.row=lastRow++;
    }
  }
  lastRow+=childCount - lastModelIndex;
  node=(TreeStateNode)getParent();
  if (node != null) {
    node.resetChildrenRowsFrom(lastRow,node.getIndex(this) + 1,this.childIndex + 1);
  }
 else {
    rowCount=lastRow;
  }
}
