{
  try {
    parameters.set(null);
    final RequestCycle cycle=RequestCycle.get();
    IResourceStream resourceStream=init();
    final Response response=cycle.getResponse();
    response.setContentType(resourceStream.getContentType());
    response.setContentLength((int)resourceStream.length());
    if (isCacheable()) {
      response.setLastModifiedTime(resourceStream.lastModifiedTime());
    }
 else {
      response.setLastModifiedTime(Time.valueOf(-1));
    }
    configureResponse(response);
    respond(resourceStream,response);
  }
  finally {
    parameters.set(null);
  }
}
