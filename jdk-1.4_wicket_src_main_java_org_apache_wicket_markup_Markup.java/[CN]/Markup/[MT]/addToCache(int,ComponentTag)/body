{
  if ((tag.isOpen() || tag.isOpenClose()) && tag.getAttributes().containsKey(getMarkupResourceData().getWicketId())) {
    if (this.componentMap == null) {
      this.componentMap=new HashMap();
    }
    final boolean fragment=(tag instanceof WicketTag && ((WicketTag)tag).isFragementTag());
    final String key;
    if (tag.getPath() != null && !fragment) {
      key=tag.getPath() + ":" + tag.getId();
    }
 else {
      key=tag.getId();
    }
    this.componentMap.put(key,new Integer(index));
  }
}
