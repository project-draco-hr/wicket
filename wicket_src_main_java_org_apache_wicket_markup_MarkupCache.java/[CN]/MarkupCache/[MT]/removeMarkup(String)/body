{
  Args.notNull(cacheKey,"cacheKey");
  if (log.isDebugEnabled()) {
    log.debug("Remove from cache: cacheKey=" + cacheKey);
  }
  CharSequence locationString=markupKeyCache.get(cacheKey);
  IMarkupFragment markup=markupCache.get(locationString);
  if (markup != null) {
    markupCache.remove(locationString);
    int count;
    do {
      count=0;
      Iterator<CharSequence> iter=markupCache.getKeys().iterator();
      while (iter.hasNext()) {
        CharSequence key=iter.next();
        if (isBaseMarkupCached(key)) {
          if (log.isDebugEnabled()) {
            log.debug("Remove from cache: cacheKey=" + key);
          }
          iter.remove();
          count++;
        }
      }
    }
 while (count > 0);
    IModificationWatcher watcher=application.getResourceSettings().getResourceWatcher(true);
    if (watcher != null) {
      Iterator<IModifiable> iter=watcher.getEntries().iterator();
      while (iter.hasNext()) {
        IModifiable modifiable=iter.next();
        if (modifiable instanceof MarkupResourceStream) {
          if (isMarkupCached((MarkupResourceStream)modifiable)) {
            iter.remove();
          }
        }
      }
    }
  }
  return markup;
}
