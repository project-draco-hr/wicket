{
  Object storedMarkupId=getMarkupIdImpl();
  if (storedMarkupId instanceof String) {
    return (String)storedMarkupId;
  }
  if (storedMarkupId == null && createIfDoesNotExist == false) {
    return null;
  }
  final int generatedMarkupId=storedMarkupId instanceof Integer ? ((Integer)storedMarkupId).intValue() : Session.get().nextSequenceValue();
  if (storedMarkupId == null) {
    setMarkupIdImpl(new Integer(generatedMarkupId));
  }
  String markupIdPrefix="id";
  if (!Application.get().getConfigurationType().equals(Application.DEPLOYMENT)) {
    markupIdPrefix=getId();
  }
  String markupIdPostfix=Integer.toHexString(generatedMarkupId).toLowerCase();
  markupIdPostfix=RequestContext.get().encodeMarkupId(markupIdPostfix);
  String markupId=markupIdPrefix + markupIdPostfix;
  char c=markupId.charAt(0);
  if (!Character.isLetter(c)) {
    markupId="id" + markupId;
  }
  markupId=Strings.replaceAll(markupId,"_","__").toString();
  markupId=markupId.replace('.','_');
  markupId=markupId.replace('-','_');
  return markupId;
}
