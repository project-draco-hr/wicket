{
  String markup;
  StringBuilder sb=new StringBuilder();
  int previousStart=0;
  int start=text.indexOf("{% ");
  while (start > 0) {
    int end=text.indexOf("{% end",start);
    end=text.indexOf("%}",end + 5) + 2;
    sb.append(text.substring(previousStart,start));
    String block=text.substring(start,end);
    if (block.startsWith("{% highlight")) {
      sb.append(handleCodeBlock(block));
    }
    if (block.startsWith("{% alert")) {
      sb.append(handleAlert(block));
    }
    sb.append("\n");
    previousStart=end;
    start=text.indexOf("{% ",end);
  }
  if (previousStart < text.length())   sb.append(text.substring(previousStart));
  markup=sb.toString();
  return markup;
}
