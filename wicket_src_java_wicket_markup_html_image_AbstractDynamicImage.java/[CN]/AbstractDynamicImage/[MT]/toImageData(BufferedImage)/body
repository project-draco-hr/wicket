{
  try {
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    final ImageWriter writer=(ImageWriter)ImageIO.getImageWritersByFormatName(format).next();
    writer.setOutput(ImageIO.createImageOutputStream(out));
    writer.write(image);
    return out.toByteArray();
  }
 catch (  IOException e) {
    throw new WicketRuntimeException("Unable to convert dynamic image to stream",e);
  }
}
