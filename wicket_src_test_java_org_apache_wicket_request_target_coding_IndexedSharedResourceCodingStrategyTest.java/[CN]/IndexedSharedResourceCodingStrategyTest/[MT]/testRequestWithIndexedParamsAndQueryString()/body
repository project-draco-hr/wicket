{
  final WebRequestCycle cycle=tester.setupRequestAndResponse();
  final PageParameters params=new PageParameters();
  params.add("0","param0");
  params.add("1","param1");
  params.put("test",new String[]{"testval1","testval2"});
  params.add("foo","fooval");
  final String url=cycle.urlFor(new ResourceReference(RESOURCE_NAME),params.toValueMap()).toString();
  assertEquals("test/param0/param1?test=testval1&test=testval2&foo=fooval",url);
  tester.getServletRequest().setURL(URL_PREFIX + url);
  tester.processRequestCycle(cycle);
  assertEquals(4,resource.params.size());
  assertEquals("fooval",resource.params.getString("foo"));
  final String[] arr=resource.params.getStringArray("test");
  assertEquals(2,arr.length);
  assertEquals("testval1",arr[0]);
  assertEquals("testval2",arr[1]);
  assertEquals("param0",resource.params.getString("0"));
  assertEquals("param1",resource.params.getString("1"));
}
