{
  final IRequestablePage page=getPage();
  if (getComponent().getPage() == page) {
    boolean isAjax=((WebRequest)requestCycle.getRequest()).isAjax();
    if (isAjax == false && listenerInterface.isRenderPageAfterInvocation()) {
      RedirectPolicy policy=getPage().isPageStateless() ? RedirectPolicy.NEVER_REDIRECT : RedirectPolicy.AUTO_REDIRECT;
      requestCycle.scheduleRequestHandlerAfterCurrent(new RenderPageRequestHandler(new PageProvider(getPage()),policy));
    }
    if (isAjax & page instanceof IManageablePage) {
      page.setFreezePageId(true);
    }
    try {
      invokeListener();
    }
  finally {
      if (isAjax && page instanceof IManageablePage) {
        page.setFreezePageId(false);
      }
    }
  }
 else {
    throw new WicketRuntimeException("Component " + getComponent() + " has been removed from page.");
  }
}
