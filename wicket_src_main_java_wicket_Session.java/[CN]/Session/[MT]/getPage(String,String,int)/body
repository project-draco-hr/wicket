{
  if (log.isDebugEnabled()) {
    log.debug("Getting page [path = " + path + ", versionNumber = "+ versionNumber+ "]");
  }
  PageMap pageMap=pageMapForName(pageMapName,Objects.equal(PageMap.DEFAULT_NAME,pageMapName));
  if (pageMap != null) {
synchronized (pageMapsUsedInRequest) {
      long startTime=System.currentTimeMillis();
      if (pageMapsUsedInRequest == null) {
        pageMapsUsedInRequest=new HashMap<PageMap,Thread>(3);
      }
      Thread t=pageMapsUsedInRequest.get(pageMap);
      while (t != null && t != Thread.currentThread()) {
        try {
          pageMapsUsedInRequest.wait(20000);
        }
 catch (        InterruptedException ex) {
          throw new WicketRuntimeException(ex);
        }
        t=pageMapsUsedInRequest.get(pageMap);
        if (t != null && t != Thread.currentThread() && (startTime + 20000) < System.currentTimeMillis()) {
          throw new WicketRuntimeException("After 20s the Pagemap " + pageMapName + " is still locked by: "+ t+ ", giving up trying to get the page for path: "+ path);
        }
      }
      pageMapsUsedInRequest.put(pageMap,Thread.currentThread());
      final String id=Strings.firstPathComponent(path,Component.PATH_SEPARATOR);
      Page page=pageMap.get(Integer.parseInt(id),versionNumber);
      if (page == null) {
        pageMapsUsedInRequest.remove(pageMap);
        pageMapsUsedInRequest.notifyAll();
      }
      return page;
    }
  }
  return null;
}
