{
  if (type == null) {
    try {
      convertedInput=convertValue(getInputAsArray());
    }
 catch (    ConversionException e) {
      ValidationError error=new ValidationError();
      if (e.getResourceKey() != null) {
        error.addMessageKey(e.getResourceKey());
      }
      if (e.getTargetType() != null) {
        error.addMessageKey("ConversionError." + Classes.simpleName(e.getTargetType()));
      }
      error.addMessageKey("ConversionError");
      final Locale locale=e.getLocale();
      if (locale != null) {
        error.setVar("locale",locale);
      }
      error.setVar("exception",e);
      Format format=e.getFormat();
      if (format instanceof SimpleDateFormat) {
        error.setVar("format",((SimpleDateFormat)format).toLocalizedPattern());
      }
      error((IValidationError)error);
    }
  }
 else   if (!Strings.isEmpty(getInput())) {
    final IConverter converter=getConverter(type);
    try {
      convertedInput=(T)converter.convertToObject(getInput(),getLocale());
    }
 catch (    ConversionException e) {
      ValidationError error=new ValidationError();
      if (e.getResourceKey() != null) {
        error.addMessageKey(e.getResourceKey());
      }
      error.addMessageKey("TypeValidator." + Classes.simpleName(type));
      error.addMessageKey("TypeValidator");
      error.setVar("type",Classes.simpleName(type));
      final Locale locale=e.getLocale();
      if (locale != null) {
        error.setVar("locale",locale);
      }
      error.setVar("exception",e);
      Format format=e.getFormat();
      if (format instanceof SimpleDateFormat) {
        error.setVar("format",((SimpleDateFormat)format).toLocalizedPattern());
      }
      error((IValidationError)error);
    }
  }
}
