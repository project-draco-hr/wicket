{
  if (type == null) {
    try {
      convertedInput=convertValue(getInputAsArray());
    }
 catch (    ConversionException e) {
      Map args=new HashMap();
      final Locale locale=e.getLocale();
      if (locale != null) {
        args.put("locale",locale);
      }
      args.put("exception",e);
      Format format=e.getFormat();
      if (format instanceof SimpleDateFormat) {
        args.put("format",((SimpleDateFormat)format).toLocalizedPattern());
      }
      String[] resourceKeys=null;
      if (e.getTargetType() != null) {
        String typedResourceKey="ConversionError." + Classes.simpleName(e.getTargetType());
        resourceKeys=new String[]{typedResourceKey,"ConversionError"};
      }
 else {
        resourceKeys=new String[]{"ConversionError"};
      }
      error(Arrays.asList(resourceKeys),args);
    }
  }
 else   if (!Strings.isEmpty(getInput())) {
    final IConverter converter=getConverter();
    try {
      convertedInput=converter.convert(getInput(),type);
    }
 catch (    ConversionException e) {
      Map args=new HashMap();
      args.put("type",Classes.simpleName(type));
      final Locale locale=e.getLocale();
      if (locale != null) {
        args.put("locale",locale);
      }
      args.put("exception",e);
      Format format=e.getFormat();
      if (format instanceof SimpleDateFormat) {
        args.put("format",((SimpleDateFormat)format).toLocalizedPattern());
      }
      if (e.getResourceKey() == null) {
        final String typedResourceKey="TypeValidator." + Classes.simpleName(type);
        String[] resourceKeys=new String[]{typedResourceKey,"TypeValidator"};
        error(Arrays.asList(resourceKeys),args);
      }
 else {
        error(Collections.singletonList(e.getResourceKey()),args);
      }
    }
  }
}
