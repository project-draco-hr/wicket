{
  this.request=request;
  parameterMap=this.request.getParameterMap();
  parameterMap.remove("x");
  String decodedParamReplacement=Strings.replaceAll(encodedParamReplacement,"&amp;","&").toString();
  decodedParamReplacement=WicketURLDecoder.QUERY_INSTANCE.decode(decodedParamReplacement);
  ValueMap params=new ValueMap();
  RequestUtils.decodeParameters(decodedParamReplacement,params);
  parameterMap.putAll(params);
  int pos1=url.indexOf("?x=");
  if (pos1 == -1) {
    throw new WicketRuntimeException("Programming error: we should come here");
  }
  int pos2=url.indexOf("&");
  AppendingStringBuffer urlBuf=new AppendingStringBuffer(url.length() + encodedParamReplacement.length());
  urlBuf.append(url.subSequence(0,pos1 + 1));
  urlBuf.append(encodedParamReplacement);
  if (pos2 != -1) {
    urlBuf.append(url.substring(pos2));
  }
  this.url=urlBuf.toString();
}
