{
  Boolean insideModal=form.visitParents(ModalWindow.class,new IVisitor<Component,Boolean>(){
    public void component(    final Component object,    final IVisit<Boolean> visit){
      visit.stop(true);
    }
  }
);
  if ((insideModal != null) && insideModal) {
    return form;
  }
 else {
    return form.getRootForm();
  }
}
