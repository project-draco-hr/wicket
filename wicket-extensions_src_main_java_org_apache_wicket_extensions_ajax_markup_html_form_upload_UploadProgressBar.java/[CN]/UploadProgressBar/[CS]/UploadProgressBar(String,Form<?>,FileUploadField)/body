{
  super(id);
  setOutputMarkupId(true);
  form.setOutputMarkupId(true);
  if (fileUploadField != null) {
    fileUploadField.setOutputMarkupId(true);
  }
  setRenderBodyOnly(true);
  add(HeaderContributor.forJavaScript(JS));
  ResourceReference css=getCss();
  if (css != null) {
    add(HeaderContributor.forCss(css));
  }
  final WebMarkupContainer barDiv=new WebMarkupContainer("bar");
  barDiv.setOutputMarkupId(true);
  add(barDiv);
  final WebMarkupContainer statusDiv=new WebMarkupContainer("status");
  statusDiv.setOutputMarkupId(true);
  add(statusDiv);
  if (!(RequestCycle.get().getRequest() instanceof UploadWebRequest) && !(RequestCycle.get().getRequest() instanceof MultipartRequest)) {
    log.warn("UploadProgressBar will not work without an UploadWebRequest. See the javadoc for details.");
  }
  final String fileUploadFieldMarkupId=fileUploadField == null ? "" : fileUploadField.getMarkupId();
  form.add(new AttributeModifier("onsubmit",true,new Model<String>(){
    private static final long serialVersionUID=1L;
    @Override public String getObject(){
      ResourceReference ref=new ResourceReference(RESOURCE_NAME);
      return "var def=new Wicket.WUPB.Def('" + form.getMarkupId() + "', '"+ statusDiv.getMarkupId()+ "', '"+ barDiv.getMarkupId()+ "', '"+ getPage().urlFor(ref)+ "','"+ fileUploadFieldMarkupId+ "'); Wicket.WUPB.start(def);";
    }
  }
));
}
