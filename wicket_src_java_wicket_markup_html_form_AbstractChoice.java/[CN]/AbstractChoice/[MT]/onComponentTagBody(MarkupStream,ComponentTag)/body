{
  List choices=getChoices();
  final StringBuffer buffer=new StringBuffer((choices.size() * 50) + 16);
  final Object selected=getModelObject();
  buffer.append(getDefaultChoice(selected));
  for (int index=0; index < choices.size(); index++) {
    final Object choice=choices.get(index);
    final String displayValue=renderer.getDisplayValue(choice);
    buffer.append("\n<option ");
    if (isSelected(choice,index)) {
      buffer.append("selected=\"selected\" ");
    }
    buffer.append("value=\"");
    buffer.append(renderer.getIdValue(choice,index));
    buffer.append("\">");
    String display=getLocalizer().getString(getId() + "." + displayValue,this,displayValue);
    String escaped=Strings.escapeMarkup(display,false,true);
    buffer.append(escaped);
    buffer.append("</option>");
  }
  buffer.append("\n");
  replaceComponentTagBody(markupStream,openTag,buffer.toString());
}
