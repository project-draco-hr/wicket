{
  byte[] bytes=null;
  List list=(List)pagesToBeSerialized.get(currentKey.sessionId);
  if (list == null) {
    SessionPageKey previousPage=(SessionPageKey)pagesToBeSaved.get(currentKey);
    if (previousPage != null) {
      bytes=(byte[])previousPage.data;
    }
  }
 else {
    while (true) {
      SessionPageKey listKey=null;
synchronized (list) {
        if (list.size() > 0) {
          listKey=(SessionPageKey)list.get(list.size() - 1);
          Object object=listKey.data;
          if (object instanceof Page) {
            list.remove(list.size() - 1);
          }
 else           if (object == SERIALIZING) {
            try {
              list.wait();
            }
 catch (            InterruptedException ex) {
              throw new RuntimeException(ex);
            }
          }
        }
 else {
          break;
        }
      }
      if (listKey.data instanceof Page) {
        byte[] ser=serializePage(listKey,(Page)listKey.data);
        if (ser != null) {
          listKey.setObject(ser);
          pagesToBeSaved.put(listKey,listKey);
        }
      }
      if (listKey.equals(currentKey) && listKey.data instanceof byte[]) {
        bytes=(byte[])listKey.data;
      }
    }
  }
  if (bytes == null) {
    SessionPageKey previousPage=(SessionPageKey)pagesToBeSaved.get(currentKey);
    if (previousPage != null) {
      bytes=(byte[])previousPage.data;
    }
  }
  return bytes;
}
