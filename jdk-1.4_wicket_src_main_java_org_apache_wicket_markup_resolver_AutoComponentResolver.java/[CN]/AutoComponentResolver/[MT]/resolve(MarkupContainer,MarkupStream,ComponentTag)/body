{
  if (tag instanceof WicketTag) {
    final WicketTag wicketTag=(WicketTag)tag;
    if (wicketTag.isComponentTag()) {
      final Component component=createComponent(container,wicketTag);
      if (component != null) {
        nestedComponents.put(component,null);
        try {
          container.autoAdd(component,markupStream);
        }
  finally {
          nestedComponents.remove(component);
        }
        return true;
      }
    }
  }
  if ((tag.getId() != null) && nestedComponents.containsKey(container)) {
    MarkupContainer parent=container.getParent();
    while ((parent != null) && nestedComponents.containsKey(parent)) {
      parent=parent.getParent();
    }
    if (parent != null) {
      final Component component=parent.get(tag.getId());
      if (component != null) {
        component.render(markupStream);
        return true;
      }
    }
  }
  return false;
}
