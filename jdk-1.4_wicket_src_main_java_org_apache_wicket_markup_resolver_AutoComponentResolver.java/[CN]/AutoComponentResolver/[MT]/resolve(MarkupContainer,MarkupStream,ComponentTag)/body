{
  if (tag instanceof WicketTag) {
    final WicketTag wicketTag=(WicketTag)tag;
    if (wicketTag.isComponentTag()) {
      final Component component=createComponent(container,wicketTag);
      if (component != null) {
        if (component instanceof Border) {
          nestedComponents.put(((Border)component).getBodyContainer(),container);
        }
 else {
          nestedComponents.put(component,container);
        }
        try {
          container.autoAdd(component,markupStream);
        }
  finally {
          nestedComponents.remove(component);
        }
        return true;
      }
    }
  }
  if ((tag.getId() != null) && nestedComponents.containsKey(container)) {
    MarkupContainer parent=(MarkupContainer)nestedComponents.get(container);
    while (parent != null) {
      Component component=parent.get(tag.getId());
      if (component != null) {
        component.render(markupStream);
        return true;
      }
      parent=parent.getParent();
      if (nestedComponents.containsKey(parent)) {
        parent=(MarkupContainer)nestedComponents.get(parent);
      }
    }
  }
  return false;
}
