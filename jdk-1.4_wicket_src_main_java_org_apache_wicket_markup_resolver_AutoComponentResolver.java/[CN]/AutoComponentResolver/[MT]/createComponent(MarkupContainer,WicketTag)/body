{
  String componentId=tag.getNameAttribute();
  if (componentId == null) {
    componentId="anonymous-" + container.getPage().getAutoIndex();
  }
  final String classname=tag.getAttributes().getString("class");
  if ((classname == null) || (classname.trim().length() == 0)) {
    throw new MarkupException("Tag <wicket:component> must have attribute 'class'");
  }
  final Class componentClass=container.getSession().getClassResolver().resolveClass(classname);
  final Component component;
  try {
    final Constructor constructor=componentClass.getConstructor(new Class[]{String.class});
    component=(Component)constructor.newInstance(new Object[]{componentId});
  }
 catch (  NoSuchMethodException e) {
    throw new MarkupException("Unable to create Component from org.apache.wicket tag: Cause: " + e.getMessage());
  }
catch (  InvocationTargetException e) {
    throw new MarkupException("Unable to create Component from org.apache.wicket tag: Cause: " + e.getMessage());
  }
catch (  IllegalAccessException e) {
    throw new MarkupException("Unable to create Component from org.apache.wicket tag: Cause: " + e.getMessage());
  }
catch (  InstantiationException e) {
    throw new MarkupException("Unable to create Component from org.apache.wicket tag: Cause: " + e.getMessage());
  }
catch (  ClassCastException e) {
    throw new MarkupException("Unable to create Component from org.apache.wicket tag: Cause: " + e.getMessage());
  }
catch (  SecurityException e) {
    throw new MarkupException("Unable to create Component from org.apache.wicket tag: Cause: " + e.getMessage());
  }
  Iterator iter=tag.getAttributes().entrySet().iterator();
  while (iter.hasNext()) {
    final Map.Entry entry=(Map.Entry)iter.next();
    final String key=(String)entry.getKey();
    final String value=(String)entry.getValue();
    if ("name".equalsIgnoreCase(key) || ("class".equalsIgnoreCase(key))) {
      continue;
    }
    Classes.invokeSetter(component,key,value,container.getLocale());
  }
  return component;
}
