{
synchronized (markupCache) {
    final String key=markupKey();
    Markup markup=(Markup)markupCache.get(key);
    if (markup == null) {
      IResourceStream markupResourceStream=null;
      Class containerClass=getClass();
      while ((markupResourceStream == null) && (containerClass != MarkupContainer.class)) {
        markupResourceStream=getApplication().getResourceStreamLocator().locate(containerClass,getStyle(),getLocale(),getMarkupType());
        containerClass=containerClass.getSuperclass();
      }
      if (markupResourceStream != null) {
        markup=loadMarkupAndWatchForChanges(key,markupResourceStream);
      }
 else {
        markup=Markup.NO_MARKUP;
      }
      markupCache.put(key,markup);
    }
    return markup;
  }
}
