{
synchronized (markupCache) {
    final String key=markupKey();
    Markup markup=(Markup)markupCache.get(key);
    if (markup == null) {
      IResourceStream markupResource=null;
      Class containerClass=getClass();
      while ((markupResource == null) && (containerClass != MarkupContainer.class)) {
        markupResource=getApplication().getResourceLocator().locate(containerClass,getStyle(),getLocale(),getMarkupType());
        containerClass=containerClass.getSuperclass();
      }
      if (markupResource != null) {
        markup=loadMarkupAndWatchForChanges(key,markupResource);
      }
 else {
        markup=Markup.NO_MARKUP;
      }
      markupCache.put(key,markup);
    }
    return markup;
  }
}
