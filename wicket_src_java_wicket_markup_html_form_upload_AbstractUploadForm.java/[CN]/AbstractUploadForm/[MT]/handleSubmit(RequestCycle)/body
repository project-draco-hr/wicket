{
  try {
    HttpServletRequest request=((HttpRequest)cycle.getRequest()).getServletRequest();
    boolean isMultipart=FileUpload.isMultipartContent(request);
    if (!isMultipart) {
      throw new IllegalStateException("request is not a multipart request");
    }
    prepareUpload();
    FileUploadBase upload=createUpload();
    List items=parseRequest(request,upload);
    processFileItems(items);
    finishUpload();
  }
 catch (  FileUploadException e) {
    throw new RuntimeException(e);
  }
}
