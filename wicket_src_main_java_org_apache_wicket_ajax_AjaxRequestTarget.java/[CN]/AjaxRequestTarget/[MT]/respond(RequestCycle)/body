{
  final WebResponse response=(WebResponse)requestCycle.getResponse();
  if (markupIdToComponent.values().contains(page)) {
    final String url=requestCycle.urlFor(page).toString();
    response.redirect(url);
    return;
  }
  for (  ITargetRespondListener listener : respondListeners) {
    listener.onTargetRespond(this);
  }
  final Application app=Application.get();
  final String encoding=app.getRequestCycleSettings().getResponseRequestEncoding();
  response.setCharacterEncoding(encoding);
  response.setContentType("text/xml; charset=" + encoding);
  response.setHeader("Expires","Mon, 26 Jul 1997 05:00:00 GMT");
  response.setHeader("Cache-Control","no-cache, must-revalidate");
  response.setHeader("Pragma","no-cache");
  response.write("<?xml version=\"1.0\" encoding=\"");
  response.write(encoding);
  response.write("\"?>");
  response.write("<ajax-response>");
  fireOnBeforeRespondListeners();
  Iterator<CharSequence> it=prependJavascripts.iterator();
  while (it.hasNext()) {
    CharSequence js=it.next();
    respondInvocation(response,js);
  }
  respondComponents(response);
  fireOnAfterRespondListeners(response);
  it=domReadyJavascripts.iterator();
  while (it.hasNext()) {
    CharSequence js=it.next();
    respondInvocation(response,js);
  }
  it=appendJavascripts.iterator();
  while (it.hasNext()) {
    CharSequence js=it.next();
    respondInvocation(response,js);
  }
  response.write("</ajax-response>");
}
