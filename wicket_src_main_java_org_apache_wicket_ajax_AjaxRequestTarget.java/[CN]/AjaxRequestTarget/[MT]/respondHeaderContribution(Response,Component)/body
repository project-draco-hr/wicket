{
  headerRendering=true;
  if (header == null) {
    header=new AjaxHtmlHeaderContainer(HtmlHeaderSectionHandler.HEADER_ID,this);
    final Page page=component.getPage();
    page.addOrReplace(header);
  }
  Response oldResponse=RequestCycle.get().setResponse(encodingHeaderResponse);
  encodingHeaderResponse.reset();
  component.renderHead(header);
  if (component instanceof MarkupContainer) {
    ((MarkupContainer)component).visitChildren(new IVisitor<Component,Void>(){
      public void component(      final Component component,      final IVisit<Void> visit){
        if (component.isVisibleInHierarchy()) {
          component.renderHead(header);
        }
 else {
          visit.dontGoDeeper();
        }
      }
    }
);
  }
  header.getHeaderResponse().close();
  RequestCycle.get().setResponse(oldResponse);
  if (encodingHeaderResponse.getContents().length() != 0) {
    response.write("<header-contribution");
    if (encodingHeaderResponse.isContentsEncoded()) {
      response.write(" encoding=\"");
      response.write(getEncodingName());
      response.write("\" ");
    }
    response.write("><![CDATA[<head xmlns:wicket=\"http://wicket.apache.org\">");
    response.write(encodingHeaderResponse.getContents());
    response.write("</head>]]>");
    response.write("</header-contribution>");
  }
  headerRendering=false;
}
