{
  for (  IRequestTarget target : requestTargets) {
    if (target != null) {
      try {
        target.detach(this);
      }
 catch (      RuntimeException e) {
        log.error("there was an error cleaning up target " + target + ".",e);
      }
    }
  }
  try {
    session.cleanupFeedbackMessages();
  }
 catch (  RuntimeException re) {
    log.error("there was an error cleaning up feedback messages for session " + session + ".",re);
  }
  if (updateSession) {
    try {
      session.update();
    }
 catch (    RuntimeException re) {
      log.error("there was an error updating the session " + session + ".",re);
    }
  }
  try {
    session.requestDetached();
  }
 catch (  RuntimeException re) {
    log.error("there was an error detaching request from session " + session + ".",re);
  }
  if (getResponse() instanceof BufferedWebResponse) {
    try {
      ((BufferedWebResponse)getResponse()).filter();
    }
 catch (    RuntimeException re) {
      log.error("there was an error filtering the response.",re);
    }
  }
  try {
    getApplication().getSessionStore().onEndRequest(request);
    onEndRequest();
  }
 catch (  RuntimeException e) {
    log.error("Exception occurred during request detachement",e);
  }
  IRequestLogger requestLogger=getApplication().getRequestLogger();
  if (requestLogger != null) {
    requestLogger.requestTime((System.currentTimeMillis() - startTime));
  }
  threadDetach();
}
