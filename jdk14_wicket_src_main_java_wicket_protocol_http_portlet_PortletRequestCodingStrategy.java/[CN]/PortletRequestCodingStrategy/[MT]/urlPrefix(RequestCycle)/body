{
  if (urlPrefix == null) {
    final AppendingStringBuffer buffer=new AppendingStringBuffer();
    final WicketPortletRequest request=((PortletRenderRequestCycle)requestCycle).getPortletRequest();
    if (request != null) {
      String contextPath=Application.get().getApplicationSettings().getContextPath();
      if (contextPath == null) {
        contextPath=((PortletRenderRequestCycle)RequestCycle.get()).getPortletRequest().getPortletRequest().getContextPath();
        if (contextPath == null) {
          contextPath="";
        }
      }
      if (!contextPath.equals("/")) {
        buffer.append(contextPath);
      }
    }
    urlPrefix=buffer;
  }
  return urlPrefix;
}
