{
  IResourceStream resourceStream=imageReference.getResource().getCacheableResourceStream();
  InputStream inputStream=resourceStream.getInputStream();
  try {
    byte[] bytes=IOUtils.toByteArray(inputStream);
    String base64EncodedImage=Base64.encodeBase64String(bytes);
    return "data:" + resourceStream.getContentType() + ";base64,"+ (removeWhitespaces ? base64EncodedImage.replaceAll("\\s","") : base64EncodedImage);
  }
  finally {
    IOUtils.closeQuietly(inputStream);
  }
}
