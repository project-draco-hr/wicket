{
  if (Strings.isEmpty(value)) {
    return null;
  }
  DateTimeFormatter format=getFormat();
  if (format == null) {
    throw new IllegalStateException("format must be not null");
  }
  if (applyTimeZoneDifference) {
    TimeZone zone=getClientTimeZone();
    MutableDateTime dt=new MutableDateTime(new DateMidnight());
    if (zone != null) {
      format=format.withZone(DateTimeZone.forTimeZone(zone));
      dt.setZone(DateTimeZone.forTimeZone(zone));
    }
    try {
      int result=format.parseInto(dt,value,0);
      if (result < 0) {
        throw new ConversionException(new ParseException("unable to parse date " + value,~result));
      }
    }
 catch (    RuntimeException e) {
      throw new ConversionException(e);
    }
    dt.setZone(getTimeZone());
    return dt.toDate();
  }
 else {
    try {
      DateTime date=format.parseDateTime(value);
      return date.toDate();
    }
 catch (    RuntimeException e) {
      throw new ConversionException(e);
    }
  }
}
