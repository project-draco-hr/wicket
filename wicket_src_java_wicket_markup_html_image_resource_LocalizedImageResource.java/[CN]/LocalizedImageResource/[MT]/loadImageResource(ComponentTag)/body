{
  if ((locale != null && locale != component.getLocale()) || (style != null && style.equals(component.getStyle()))) {
    if (resource instanceof SharedResource) {
      if (isFactoryResource) {
        this.resource=null;
      }
 else {
        final SharedResource namedResource=(SharedResource)resource;
        namedResource.setLocale(locale);
        namedResource.setStyle(style);
      }
    }
 else {
      this.resource=null;
    }
  }
  if (resource == null) {
    final String modelString=component.getModelObjectAsString();
    final String resourcePath;
    if (Strings.isEmpty(modelString)) {
      resourcePath=tag.getString("src");
    }
 else {
      resourcePath=modelString;
    }
    if (!Strings.isEmpty(resourcePath)) {
      final Package basePackage=component.findParentWithAssociatedMarkup().getClass().getPackage();
      this.resource=StaticImageResource.get(basePackage,resourcePath,component.getLocale(),component.getStyle());
    }
    if (resource == null) {
      this.resource=newImageResource(tag);
      this.isFactoryResource=true;
    }
    this.locale=component.getLocale();
    this.style=component.getStyle();
  }
}
