{
  String value=tag.getString("value");
  if (value == null) {
    throw new WicketRuntimeException("Component was not assigned an ImageResource, and had neither a src " + "attribute referencing a static image nor a value " + "attribute from which to generate an image.");
  }
 else {
    final ImageValueParser valueParser=new ImageValueParser(value);
    if (valueParser.matches()) {
      final ImageResourceFactory factory=component.getApplication().getImageResourceFactory(valueParser.getFactoryName());
      if (factory == null) {
        throw new WicketRuntimeException("Could not find image resource factory named " + valueParser.getFactoryName());
      }
      return factory.imageResource(valueParser.getWidth(),valueParser.getHeight(),valueParser.getLabel());
    }
 else {
      throw new WicketRuntimeException("Could not find or generate image from label \"" + value + "\".  Was expecting either a static image reference or a value attribute of the form \"imageResourceFactoryName:(width,height:)?label\".");
    }
  }
}
