{
  if ((locale != null && locale != component.getLocale()) || (style != null && style.equals(component.getStyle()))) {
    if (resource instanceof SharedResource) {
      if (isFactoryResource) {
        this.resource=null;
      }
 else {
        final SharedResource namedResource=(SharedResource)resource;
        namedResource.setLocale(locale);
        namedResource.setStyle(style);
      }
    }
 else {
      this.resource=null;
    }
  }
  if (resource == null) {
    final String src=tag.getString("src");
    if (src != null) {
      this.resource=loadStaticImage(src);
    }
 else {
      final String value=tag.getString("value");
      if (value != null) {
        this.resource=newImage(value);
        this.isFactoryResource=true;
      }
 else {
        this.resource=loadStaticImage(component.getModelObjectAsString());
      }
    }
  }
  this.locale=component.getLocale();
  this.style=component.getStyle();
  final String url;
  if (this.resource instanceof SharedResource) {
    url=component.getPage().urlFor(((SharedResource)resource).getPath());
  }
 else {
    url=component.urlFor(IResourceListener.class);
  }
  tag.put("src",component.getResponse().encodeURL(url).replaceAll("&","&amp;"));
}
