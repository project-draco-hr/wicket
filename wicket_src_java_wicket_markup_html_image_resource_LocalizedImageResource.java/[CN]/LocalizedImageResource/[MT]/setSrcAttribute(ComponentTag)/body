{
  if ((locale != null && !locale.equals(component.getLocale())) || (style != null && !style.equals(component.getStyle()))) {
    this.locale=component.getLocale();
    this.style=component.getStyle();
    if (resourceReference != null) {
      if (isFactoryResource) {
        this.resourceReference=null;
        this.resource=null;
      }
 else {
        resourceReference.setLocale(locale);
        resourceReference.setStyle(style);
      }
    }
 else {
      this.resource=null;
    }
  }
  if (resource == null && resourceReference == null) {
    final String src=tag.getString("src");
    if (src != null) {
      loadStaticImage(src);
    }
 else {
      final String value=tag.getString("value");
      if (value != null) {
        newImage(value);
        this.isFactoryResource=true;
      }
 else {
        loadStaticImage(component.getModelObjectAsString());
      }
    }
  }
  final String url;
  if (this.resourceReference != null) {
    url=component.getPage().urlFor(resourceReference.getPath());
  }
 else {
    url=component.urlFor(IResourceListener.class);
  }
  tag.put("src",Strings.replaceAll(component.getResponse().encodeURL(url),"&","&amp;"));
}
