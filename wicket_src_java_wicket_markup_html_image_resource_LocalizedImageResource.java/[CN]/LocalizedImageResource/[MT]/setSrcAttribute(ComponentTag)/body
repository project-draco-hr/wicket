{
  if ((locale != null && !locale.equals(component.getLocale())) || (style != null && !style.equals(component.getStyle()))) {
    this.locale=component.getLocale();
    this.style=component.getStyle();
    if (resource instanceof SharedResource) {
      if (isFactoryResource) {
        this.resource=null;
      }
 else {
        final SharedResource sharedResource=(SharedResource)resource;
        sharedResource.setLocale(locale);
        sharedResource.setStyle(style);
      }
    }
 else {
      this.resource=null;
    }
  }
  if (resource == null) {
    final String src=tag.getString("src");
    if (src != null) {
      this.resource=loadStaticImage(src);
    }
 else {
      final String value=tag.getString("value");
      if (value != null) {
        this.resource=newImage(value);
        this.isFactoryResource=true;
      }
 else {
        this.resource=loadStaticImage(component.getModelObjectAsString());
      }
    }
  }
  final String url;
  if (this.resource instanceof SharedResource) {
    url=component.getPage().urlFor(((SharedResource)resource).getPath());
  }
 else {
    url=component.urlFor(IResourceListener.class);
  }
  tag.put("src",Strings.replaceAll(component.getResponse().encodeURL(url),"&","&amp;"));
}
