{
  final ImageValueParser valueParser=new ImageValueParser(value);
  if (valueParser.matches()) {
    final IResourceFactory factory=component.getApplication().getResourceFactory(valueParser.getFactoryName());
    if (factory == null) {
      throw new WicketRuntimeException("Could not find image resource factory named " + valueParser.getFactoryName());
    }
    final ImageResource resource=(ImageResource)factory.newResource(valueParser.getSpecification(),locale,style);
    final String name=valueParser.getImageName();
    if (!Strings.isEmpty(name)) {
      component.getApplication().addResource(Application.class,name,locale,style,resource);
      final SharedResource sharedResource=new SharedResource(Application.class,name);
      sharedResource.setLocale(locale);
      sharedResource.setStyle(style);
      return sharedResource;
    }
    return resource;
  }
 else {
    throw new WicketRuntimeException("Could not generate image for value attribute '" + value + "'.  Was expecting a value attribute of the form \"[resourceFactoryName]:[sharedResourceName]?:[factorySpecification]\".");
  }
}
