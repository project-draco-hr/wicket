{
  if (status != -1) {
    servletResponse.setStatus(status);
  }
  if (headers != null) {
    Iterator<Entry<String,Object>> it=headers.entrySet().iterator();
    while (it.hasNext()) {
      Entry<String,Object> entry=it.next();
      String name=entry.getKey();
      Object value=entry.getValue();
      if (value instanceof List) {
        List<?> lst=(List<?>)value;
        for (int i=0; i < lst.size(); i++) {
          addHeader(name,lst.get(i),servletResponse);
        }
      }
 else {
        setHeader(name,value,servletResponse);
      }
    }
  }
  if (cookies != null) {
    for (int i=0; i < cookies.size(); i++) {
      Cookie cookie=cookies.get(i);
      servletResponse.addCookie(cookie);
    }
  }
  if (locale != null) {
    servletResponse.setLocale(locale);
  }
  servletResponse.setContentLength(byteBuffer.length);
  servletResponse.setContentType(contentType);
  final OutputStream out=servletResponse.getOutputStream();
  out.write(byteBuffer);
  out.close();
}
