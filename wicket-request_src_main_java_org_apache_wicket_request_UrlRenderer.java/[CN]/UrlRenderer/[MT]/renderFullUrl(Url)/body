{
  final String protocol=resolveProtocol(url);
  final String host=resolveHost(url);
  final Integer port=resolvePort(url);
  final String path=url.toString();
  String render=protocol + "://" + host;
  if (port != null && !port.equals(PROTO_TO_PORT.get(protocol))) {
    render+=":" + port;
  }
  render+=request.getContextPath();
  render+=request.getFilterPath();
  render=Strings.join("/",render,path);
  return render.toString();
}
