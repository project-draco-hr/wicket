{
  try {
    ThreadContext.setApplication(application);
    for (    AtmosphereResource resource : broadcaster.getAtmosphereResources()) {
      PageKey key;
      Collection<EventSubscription> subscriptionsForPage;
synchronized (this) {
        key=trackedPages.get(AtmosphereBehavior.getUUID(resource));
        subscriptionsForPage=Collections2.filter(Collections.unmodifiableCollection(subscriptions.get(key)),new EventFilter(event));
      }
      post(resource,key,subscriptionsForPage,event);
    }
  }
  finally {
    ThreadContext.detach();
  }
}
