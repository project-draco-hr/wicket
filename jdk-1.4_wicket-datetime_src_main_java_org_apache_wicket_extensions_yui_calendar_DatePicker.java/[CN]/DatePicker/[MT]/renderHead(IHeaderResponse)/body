{
  response.renderJavascriptReference(new JavascriptResourceReference(YuiLib.class,"yahoo.js"));
  response.renderJavascriptReference(new JavascriptResourceReference(YuiLib.class,"event.js"));
  response.renderJavascriptReference(new JavascriptResourceReference(YuiLib.class,"dom.js"));
  response.renderJavascriptReference(new JavascriptResourceReference(DatePicker.class,"calendar.js"));
  response.renderCSSReference(new CompressedResourceReference(DatePicker.class,"assets/calendar.css"));
  response.renderJavascriptReference(new JavascriptResourceReference(DatePicker.class,"date.js"));
  String markupId=getCalendarMarkupId();
  String javascriptId=getCalendarJavascriptId();
  String javascriptWidgetId="YAHOO.wicket." + getCalendarJavascriptId();
  StringBuffer buffer=new StringBuffer();
  buffer.append("YAHOO.namespace(\"wicket\");\nfunction init");
  buffer.append(javascriptId);
  buffer.append("() {\n");
  buffer.append(" ");
  buffer.append(javascriptWidgetId);
  buffer.append(" = new YAHOO.widget.Calendar(\"");
  buffer.append(javascriptId);
  buffer.append("\",\"");
  buffer.append(markupId);
  String datePattern=getDatePattern();
  Properties p=new Properties();
  configureWidgetProperties(p);
  buffer.append("\", { ");
  for (Iterator i=p.entrySet().iterator(); i.hasNext(); ) {
    Entry entry=(Entry)i.next();
    buffer.append(entry.getKey());
    Object value=entry.getValue();
    if (value instanceof CharSequence) {
      buffer.append(":\"");
      buffer.append(value);
      buffer.append("\"");
    }
 else     if (value instanceof CharSequence[]) {
      buffer.append(":[");
      CharSequence[] valueArray=(CharSequence[])value;
      for (int j=0; j < valueArray.length; j++) {
        CharSequence tmpValue=valueArray[j];
        buffer.append("\"");
        buffer.append(tmpValue);
        buffer.append("\"");
        if (j < valueArray.length - 1) {
          buffer.append(",");
        }
      }
      buffer.append("]");
    }
 else {
      buffer.append(":");
      buffer.append(value);
    }
    if (i.hasNext()) {
      buffer.append(",");
    }
  }
  buffer.append(" });\n");
  buffer.append(" function showCalendar() {\n");
  buffer.append("  var dateValue = YAHOO.util.Dom.get(\"");
  buffer.append(component.getMarkupId());
  buffer.append("\").value;\n");
  buffer.append("  if (dateValue) {\n");
  buffer.append("    dateValue = new Date(getDateFromFormat(dateValue,\'");
  buffer.append(datePattern);
  buffer.append("\'));\n    ");
  buffer.append(javascriptWidgetId);
  buffer.append(".select(dateValue);\n");
  buffer.append("    var firstDate = ");
  buffer.append(javascriptWidgetId);
  buffer.append(".getSelectedDates()[0];\n    ");
  buffer.append(javascriptWidgetId);
  buffer.append(".cfg.setProperty(\"pagedate\", (firstDate.getMonth()+1) + \"/\" + firstDate.getFullYear());");
  buffer.append(javascriptWidgetId);
  buffer.append(".render();\n");
  buffer.append("  }\n");
  buffer.append(javascriptWidgetId);
  buffer.append(".show();\n");
  buffer.append(" }\n");
  buffer.append("  YAHOO.util.Event.addListener(\"");
  String iconId=getIconId();
  buffer.append(iconId);
  buffer.append("\", \"click\", ");
  buffer.append("showCalendar, ");
  buffer.append(javascriptWidgetId);
  buffer.append(", true);\n");
  buffer.append("  function selectHandler(type, args, cal) {\n");
  buffer.append("    var selDateArray = args[0][0];\n");
  buffer.append("    var yr = selDateArray[0];\n");
  buffer.append("    var month = selDateArray[1];\n");
  buffer.append("    var dt = selDateArray[2];\n");
  buffer.append("    var val = '");
  buffer.append(datePattern);
  buffer.append("'.replace(/d+/, dt).replace(/M+/, month)");
  buffer.append(".replace(/y+/, yr);\n    YAHOO.util.Dom.get(\"");
  buffer.append(component.getMarkupId());
  buffer.append("\").value = val;\n");
  buffer.append("    cal.hide();\n  }\n");
  buffer.append("  ");
  buffer.append(javascriptWidgetId);
  buffer.append(".selectEvent.subscribe(selectHandler, ");
  buffer.append(javascriptWidgetId);
  buffer.append(");\n");
  appendToInit(markupId,javascriptId,javascriptWidgetId,buffer);
  buffer.append("  ");
  buffer.append(javascriptWidgetId);
  buffer.append(".render();\n");
  buffer.append("}\n");
  buffer.insert(0,JavascriptUtils.SCRIPT_OPEN_TAG);
  buffer.append(JavascriptUtils.SCRIPT_CLOSE_TAG);
  response.renderString(buffer);
  StringBuffer initBuffer=new StringBuffer();
  initBuffer.append("init");
  initBuffer.append(javascriptId);
  initBuffer.append("();");
  response.renderOnLoadJavascript(initBuffer.toString());
}
