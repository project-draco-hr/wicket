{
  YuiLib.load(response);
  if (enableMonthYearSelection()) {
    response.renderCSSReference(new ResourceReference(YuiLib.class,"calendar/assets/wicket-calendar.css"));
    String idSelector="#" + getEscapedComponentMarkupId() + "DpJs";
    new StringHeaderContributor("<style>" + idSelector + ".yui-calendar .calnavleft, "+ idSelector+ ".yui-calendar .calnavright {display: none;}</style>").renderHead(response);
  }
  Map variables=new HashMap();
  String widgetId=getEscapedComponentMarkupId();
  variables.put("componentId",getComponentMarkupId());
  variables.put("widgetId",widgetId);
  variables.put("datePattern",getDatePattern());
  variables.put("fireChangeEvent",Boolean.valueOf(notifyComponentOnDateSelected()));
  variables.put("alignWithIcon",Boolean.valueOf(alignWithIcon()));
  variables.put("pathToWicketDate",RequestCycle.get().urlFor(new JavascriptResourceReference(DatePicker.class,"wicket-date.js")));
  variables.put("basePath",RequestCycle.get().urlFor(new JavascriptResourceReference(YuiLib.class,"")));
  variables.put("enableMonthYearSelection",Boolean.valueOf(enableMonthYearSelection()));
  variables.put("hideOnSelect",Boolean.valueOf(hideOnSelect()));
  String script=getAdditionalJavascript();
  if (script != null) {
    variables.put("additionalJavascript",script.replaceAll("\\$\\{calendar\\}","YAHOO.wicket." + widgetId + "DpJs"));
  }
  Properties p=new Properties();
  configure(p);
  if (enableMonthYearSelection() && p.containsKey("pages") && Objects.longValue(p.get("pages")) > 1) {
    throw new IllegalStateException("You cannot use a CalendarGroup with month/year selection!");
  }
  StringBuffer calendarInit=new StringBuffer();
  for (Iterator i=p.entrySet().iterator(); i.hasNext(); ) {
    Entry entry=(Entry)i.next();
    calendarInit.append(entry.getKey());
    Object value=entry.getValue();
    if (value instanceof CharSequence) {
      calendarInit.append(":\"");
      calendarInit.append(Strings.toEscapedUnicode(value.toString()));
      calendarInit.append("\"");
    }
 else     if (value instanceof CharSequence[]) {
      calendarInit.append(":[");
      CharSequence[] valueArray=(CharSequence[])value;
      for (int j=0; j < valueArray.length; j++) {
        CharSequence tmpValue=valueArray[j];
        if (j > 0) {
          calendarInit.append(",");
        }
        if (tmpValue != null) {
          calendarInit.append("\"");
          calendarInit.append(Strings.toEscapedUnicode(tmpValue.toString()));
          calendarInit.append("\"");
        }
      }
      calendarInit.append("]");
    }
 else {
      calendarInit.append(":");
      calendarInit.append(Strings.toEscapedUnicode(String.valueOf(value)));
    }
    if (i.hasNext()) {
      calendarInit.append(",");
    }
  }
  variables.put("calendarInit",calendarInit.toString());
  TextTemplate datePickerJs=new PackagedTextTemplate(DatePicker.class,"DatePicker.js");
  datePickerJs.interpolate(variables);
  response.renderOnDomReadyJavascript(datePickerJs.asString());
}
