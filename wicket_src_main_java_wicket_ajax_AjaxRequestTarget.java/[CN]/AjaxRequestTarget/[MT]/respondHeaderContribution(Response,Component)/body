{
  Response encodingResponse=new StringResponse();
  try {
    final IHeaderResponse headerResponse=new HeaderResponse(encodingResponse);
    RequestCycle.get().setResponse(headerResponse.getResponse());
    component.renderHead(headerResponse);
  }
  finally {
    RequestCycle.get().setResponse(response);
  }
  String data=encodingResponse.toString();
  if (data.length() != 0) {
    response.write("<header-contribution");
    if (needsEncoding(encodingResponse.toString())) {
      response.write(" encoding=\"");
      response.write(getEncodingName());
      response.write("\" ");
      data=encode(data);
    }
    response.write("><![CDATA[<head xmlns:wicket=\"http://wicket.sourceforge.net\">");
    response.write(data);
    response.write("</head>]]>");
    response.write("</header-contribution>");
  }
}
