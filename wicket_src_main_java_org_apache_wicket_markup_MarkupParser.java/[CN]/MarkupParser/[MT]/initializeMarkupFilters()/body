{
  markupFilterChain=new RootMarkupFilter(xmlParser);
  MarkupResourceStream markupResourceStream=markup.getMarkupResourceStream();
  appendMarkupFilter(new WicketTagIdentifier(markupResourceStream));
  appendMarkupFilter(new HtmlHandler());
  appendMarkupFilter(new WicketRemoveTagHandler());
  appendMarkupFilter(new WicketLinkTagHandler());
  appendMarkupFilter(new WicketNamespaceHandler(markupResourceStream));
  if ((markupResourceStream != null) && (markupResourceStream.getResource() != null)) {
    final ContainerInfo containerInfo=markupResourceStream.getContainerInfo();
    if (containerInfo != null) {
      appendMarkupFilter(new WicketMessageTagHandler());
      if (Page.class.isAssignableFrom(containerInfo.getContainerClass())) {
        appendMarkupFilter(new HtmlHeaderSectionHandler(markup));
      }
      appendMarkupFilter(new HeadForceTagIdHandler(containerInfo.getContainerClass()));
    }
  }
  appendMarkupFilter(new OpenCloseTagExpander());
  appendMarkupFilter(new RelativePathPrefixHandler());
  appendMarkupFilter(new EnclosureHandler());
}
