{
  CharSequence url=pathForTarget(requestTarget);
  if (url != null) {
  }
 else   if (requestTarget instanceof IBookmarkablePageRequestTarget) {
    url=encode(requestCycle,(IBookmarkablePageRequestTarget)requestTarget);
  }
 else   if (requestTarget instanceof ISharedResourceRequestTarget) {
    url=encode(requestCycle,(ISharedResourceRequestTarget)requestTarget);
  }
 else   if (requestTarget instanceof IListenerInterfaceRequestTarget) {
    url=encode(requestCycle,(IListenerInterfaceRequestTarget)requestTarget);
  }
 else   if (requestTarget instanceof IPageRequestTarget) {
    return encode(requestCycle,(IPageRequestTarget)requestTarget);
  }
 else {
    url=doEncode(requestCycle,requestTarget);
  }
  if (url != null) {
    PrependingStringBuffer prepender=new PrependingStringBuffer(url.toString());
    if (requestCycle.getRequest() instanceof WebRequest && ((WebRequest)requestCycle.getRequest()).isAjax()) {
      for (int i=0; i < requestCycle.getRequest().getRequestParameters().getUrlDepth(); i++) {
        prepender.prepend("../");
      }
    }
 else {
      prepender.prepend(requestCycle.getRequest().getRelativePathPrefixToWicketHandler());
    }
    String result=prepender.toString();
    if (result.length() == 0) {
      result="./";
    }
    return requestCycle.getOriginalResponse().encodeURL(result);
  }
  return null;
}
