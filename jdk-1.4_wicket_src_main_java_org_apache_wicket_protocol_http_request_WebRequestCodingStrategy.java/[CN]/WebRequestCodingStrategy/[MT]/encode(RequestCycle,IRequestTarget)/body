{
  CharSequence url=pathForTarget(requestTarget);
  boolean makePathRelative=false;
  if (url != null) {
    makePathRelative=true;
  }
 else   if (requestTarget instanceof IBookmarkablePageRequestTarget) {
    url=encode(requestCycle,(IBookmarkablePageRequestTarget)requestTarget);
    makePathRelative=true;
  }
 else   if (requestTarget instanceof ISharedResourceRequestTarget) {
    url=encode(requestCycle,(ISharedResourceRequestTarget)requestTarget);
    makePathRelative=true;
  }
 else   if (requestTarget instanceof IListenerInterfaceRequestTarget) {
    url=encode(requestCycle,(IListenerInterfaceRequestTarget)requestTarget);
  }
 else   if (requestTarget instanceof IPageRequestTarget) {
    url=encode(requestCycle,(IPageRequestTarget)requestTarget);
    return url;
  }
 else {
    url=doEncode(requestCycle,requestTarget);
  }
  if (url != null) {
    PrependingStringBuffer prepender=new PrependingStringBuffer(url.toString());
    if (makePathRelative) {
      prepender.prepend(requestCycle.getRequest().getRelativePathPrefixToWicketHandler());
    }
    String result=prepender.toString();
    if (result.length() == 0) {
      result="./";
    }
    return requestCycle.getOriginalResponse().encodeURL(result);
  }
  return null;
}
