{
  final RequestCycle requestCycle=ThreadContext.getRequestCycle();
  Map<ResourceReference,String> cache=null;
  if (requestCycle != null) {
    cache=requestCycle.getMetaData(CACHE_KEY);
    if (cache == null) {
      requestCycle.setMetaData(CACHE_KEY,cache=Generics.newHashMap());
    }
    if (cache.containsKey(resourceReference)) {
      return cache.get(resourceReference);
    }
  }
  final String version=delegate.getVersion(resourceReference);
  if (cache != null) {
    cache.put(resourceReference,version);
  }
  return version;
}
