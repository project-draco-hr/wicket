{
  s.defaultWriteObject();
  if (serializeLastPage) {
    Serializable page=lastPage;
    IPageStore store=getPageStore();
    if (page != null && store instanceof ISerializationAwarePageStore) {
      page=((ISerializationAwarePageStore)store).prepareForSerialization(lastPage);
    }
    try {
      s.writeObject(page);
    }
 catch (    Exception e) {
      throw new WicketRuntimeException("Failed to serialize " + page.toString(),e);
    }
  }
}
