{
  Object storedMarkupId=getMarkupIdImpl();
  if (storedMarkupId instanceof String) {
    return (String)storedMarkupId;
  }
  if (storedMarkupId == null && createIfDoesNotExist == false) {
    return null;
  }
  final int generatedMarkupId=storedMarkupId instanceof Integer ? (Integer)storedMarkupId : getSession().nextSequenceValue();
  if (storedMarkupId == null) {
    setMarkupIdImpl(generatedMarkupId);
  }
  String markupIdPrefix="id";
  if (!getApplication().usesDeploymentConfig()) {
    markupIdPrefix=getId();
  }
  String markupIdPostfix=Integer.toHexString(generatedMarkupId).toLowerCase();
  String markupId=markupIdPrefix + markupIdPostfix;
  char c=markupId.charAt(0);
  if (!Character.isLetter(c)) {
    markupId="id" + markupId;
  }
  markupId=Strings.replaceAll(markupId,"_","__").toString();
  markupId=markupId.replace('.','_');
  markupId=markupId.replace('-','_');
  markupId=markupId.replace(' ','_');
  return markupId;
}
