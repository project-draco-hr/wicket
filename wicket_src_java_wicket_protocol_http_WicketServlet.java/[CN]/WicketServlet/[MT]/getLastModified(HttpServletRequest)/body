{
  final String pathInfo=servletRequest.getPathInfo();
  if ((pathInfo != null) && pathInfo.startsWith(WebRequestCycle.resourceReferencePrefix)) {
    final String resourceReferenceKey=pathInfo.substring(WebRequestCycle.resourceReferencePrefix.length());
    final WebRequest webRequest=webApplication.newWebRequest(servletRequest);
    Resource resource=webApplication.getSharedResources().get(resourceReferenceKey);
    if ((resource != null) && resource.isCacheable()) {
      try {
        Application.set(webApplication);
        resource.setParameters(webRequest.getParameterMap());
        IResourceStream stream=resource.getResourceStream();
        stream.length();
        Time time=stream.lastModifiedTime();
        return time != null ? time.getMilliseconds() : -1;
      }
  finally {
        Application.set(null);
      }
    }
  }
  return -1;
}
