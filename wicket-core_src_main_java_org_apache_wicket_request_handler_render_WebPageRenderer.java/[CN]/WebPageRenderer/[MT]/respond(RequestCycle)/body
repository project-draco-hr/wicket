{
  Url currentUrl=requestCycle.getUrlRenderer().getBaseUrl();
  Url targetUrl=requestCycle.mapUrlFor(getRenderPageRequestHandler());
  BufferedWebResponse bufferedResponse=getAndRemoveBufferedResponse(currentUrl);
  boolean isAjax=isAjax(requestCycle);
  boolean shouldPreserveClientUrl=((WebRequest)requestCycle.getRequest()).shouldPreserveClientUrl();
  if (bufferedResponse != null) {
    logger.warn("The Buffered response should be handled by BufferedResponseRequestHandler");
    bufferedResponse.writeTo((WebResponse)requestCycle.getResponse());
  }
 else   if (getRedirectPolicy() == RedirectPolicy.NEVER_REDIRECT || (isOnePassRender() && isAjax == false && getRedirectPolicy() != RedirectPolicy.ALWAYS_REDIRECT) || (!isAjax && (targetUrl.equals(currentUrl) && !getPageProvider().isNewPageInstance() && !getPage().isPageStateless()) || (targetUrl.equals(currentUrl) && isRedirectToRender())) || shouldPreserveClientUrl) {
    BufferedWebResponse response=renderPage(currentUrl,requestCycle);
    if (response != null) {
      response.writeTo((WebResponse)requestCycle.getResponse());
    }
  }
 else   if (getRedirectPolicy() == RedirectPolicy.ALWAYS_REDIRECT || isRedirectToRender() || (isAjax && targetUrl.equals(currentUrl))) {
    redirectTo(targetUrl,requestCycle);
  }
 else   if (!targetUrl.equals(currentUrl) && (getPageProvider().isNewPageInstance() || (isSessionTemporary() && getPage().isPageStateless()))) {
    redirectTo(targetUrl,requestCycle);
  }
 else {
    if (isRedirectToBuffer() == false && logger.isDebugEnabled()) {
      String details=String.format("redirect strategy: '%s', isAjax: '%s', redirect policy: '%s', " + "current url: '%s', target url: '%s', is new: '%s', is stateless: '%s', is temporary: '%s'",Application.get().getRequestCycleSettings().getRenderStrategy(),isAjax,getRedirectPolicy(),currentUrl,targetUrl,getPageProvider().isNewPageInstance(),getPage().isPageStateless(),isSessionTemporary());
      logger.debug("Falling back to Redirect_To_Buffer render strategy because none of the conditions " + "matched. Details: " + details);
    }
    getPage();
    Url renderTargetUrl=requestCycle.mapUrlFor(getRenderPageRequestHandler());
    BufferedWebResponse response=renderPage(renderTargetUrl,requestCycle);
    if (response == null) {
      return;
    }
    if (currentUrl.equals(renderTargetUrl)) {
      response.writeTo((WebResponse)requestCycle.getResponse());
    }
 else     if (getPage().isPageStateless() && !enableRedirectForStatelessPage()) {
      response.writeTo((WebResponse)requestCycle.getResponse());
    }
 else {
      storeBufferedResponse(renderTargetUrl,response);
      redirectTo(renderTargetUrl,requestCycle);
    }
  }
}
