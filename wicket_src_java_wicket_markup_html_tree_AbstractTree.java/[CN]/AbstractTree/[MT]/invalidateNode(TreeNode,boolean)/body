{
  if (dirtyAll == false) {
    TreeItem item=nodeToItemMap.get(node);
    if (forceRebuld && item != null) {
      int level=item.getLevel();
      List<TreeItem> children=item.getChildren();
      String id=item.getId();
      TreeItem parent=item.getParentItem();
      int index=parent != null ? parent.getChildren().indexOf(item) : -1;
      item.remove();
      item=newTreeItem(node,level,id);
      if (level == -1) {
        item.setVisible(false);
      }
      item.setChildren(children);
      if (parent == null) {
        rootItem=item;
      }
 else {
        parent.getChildren().set(index,item);
      }
    }
    if (item != null) {
      dirtyItems.add(item);
    }
  }
}
