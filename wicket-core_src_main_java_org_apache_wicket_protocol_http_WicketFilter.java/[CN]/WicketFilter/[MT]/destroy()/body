{
  if (application != null) {
    try {
      ThreadContext.setApplication(application);
      application.internalDestroy();
    }
  finally {
      ThreadContext.detach();
      application=null;
    }
  }
  if (applicationFactory != null) {
    if (applicationFactory instanceof IDestroyableWebApplicationFactory) {
      ((IDestroyableWebApplicationFactory)applicationFactory).destroy();
    }
  }
}
