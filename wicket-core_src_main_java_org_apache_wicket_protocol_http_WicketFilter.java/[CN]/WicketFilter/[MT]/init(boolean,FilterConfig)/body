{
  this.filterConfig=filterConfig;
  this.isServlet=isServlet;
  initIgnorePaths(filterConfig);
  applicationFactory=getApplicationFactory();
  application=applicationFactory.createApplication(this);
  application.setName(filterConfig.getFilterName());
  application.setWicketFilter(this);
  if (filterPath == null) {
    filterPath=getFilterPathFromConfig(filterConfig);
  }
  if (filterPath == null) {
    filterPath=getFilterPathFromWebXml(isServlet,filterConfig);
  }
  if (filterPath == null) {
    filterPath=getFilterPathFromAnnotation(isServlet);
  }
  if (filterPath == null) {
    log.warn("Unable to determine filter path from filter init-parm, web.xml, " + "or servlet 3.0 annotations. Assuming user will set filter path " + "manually by calling setFilterPath(String)");
  }
  final ClassLoader previousClassLoader=Thread.currentThread().getContextClassLoader();
  final ClassLoader newClassLoader=getClassLoader();
  ThreadContext.setApplication(application);
  try {
    if (previousClassLoader != newClassLoader) {
      Thread.currentThread().setContextClassLoader(newClassLoader);
    }
    application.initApplication();
    application.logStarted();
  }
  finally {
    ThreadContext.detach();
    if (newClassLoader != previousClassLoader) {
      Thread.currentThread().setContextClassLoader(previousClassLoader);
    }
  }
}
