{
  Args.notNull(url,"url");
  UrlRenderer urlRenderer=RequestCycle.get().getUrlRenderer();
  Url relativeUrl=Url.parse(url);
  String fullUrl=urlRenderer.renderFullUrl(relativeUrl);
  String encodedFullUrl=httpServletResponse.encodeURL(fullUrl);
  final String encodedRelativeUrl;
  if (fullUrl.equals(encodedFullUrl)) {
    encodedRelativeUrl=url.toString();
  }
 else {
    Url _encoded=Url.parse(encodedFullUrl);
    encodedRelativeUrl=urlRenderer.renderRelativeUrl(_encoded);
  }
  return encodedRelativeUrl;
}
