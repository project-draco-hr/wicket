{
  if (!listenerInterface.isAssignableFrom(component.getClass())) {
    throw new WicketRuntimeException("The component " + component + " of class "+ component.getClass()+ " does not implement "+ listenerInterface);
  }
  final WebRequestCycle cycle=getWebRequestCycle();
  final StringBuffer buffer=urlPrefix(cycle);
  appendPageMapName(buffer);
  buffer.append("path=");
  buffer.append(component.getPath());
  int versionNumber=component.getPage().getCurrentVersionNumber();
  if (versionNumber > 0) {
    buffer.append("&version=");
    buffer.append(versionNumber);
  }
  String listenerName=Classes.name(listenerInterface);
  if (!"IRedirectListener".equals(listenerName)) {
    buffer.append("&interface=");
    buffer.append(listenerName);
  }
  if (IBehaviourListener.class.isAssignableFrom(listenerInterface)) {
    buffer.append("&dispatched=true");
  }
  return cycle.getResponse().encodeURL(buffer.toString());
}
