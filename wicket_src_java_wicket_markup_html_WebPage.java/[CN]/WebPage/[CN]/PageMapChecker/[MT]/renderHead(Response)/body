{
  final WebRequestCycle cycle=(WebRequestCycle)getRequestCycle();
  final IRequestTarget target=cycle.getRequestTarget();
  int initialAccessStackSize=0;
  if (getApplication().getRequestCycleSettings().getRenderStrategy() == IRequestCycleSettings.REDIRECT_TO_RENDER && target instanceof RedirectPageRequestTarget) {
    initialAccessStackSize=1;
  }
  String name=getPageMap().getName();
  if (name == null) {
    name="wicket:default";
  }
 else {
    name=name.replace('"','_');
  }
  CharSequence url=null;
  if (target instanceof IBookmarkablePageRequestTarget) {
    IBookmarkablePageRequestTarget current=(IBookmarkablePageRequestTarget)target;
    BookmarkablePageRequestTarget redirect=new BookmarkablePageRequestTarget(getSession().createAutoPageMapName(),current.getPageClass(),current.getPageParameters());
    url=cycle.urlFor(redirect);
  }
 else {
    url=urlFor(INewBrowserWindowListener.INTERFACE);
  }
  final ArrayListStack accessStack=getPageMap().getAccessStack();
  if (accessStack.size() == initialAccessStackSize) {
    JavascriptUtils.writeOpenTag(response);
    response.write("window.name=\"");
    response.write(name);
    response.write("\";");
    JavascriptUtils.writeCloseTag(response);
  }
 else {
    JavascriptUtils.writeOpenTag(response);
    response.write("if (window.name=='' || window.name !='");
    response.write(name);
    response.write("') window.location=\"");
    response.write(url);
    response.write("\";");
    JavascriptUtils.writeCloseTag(response);
  }
}
