{
  if (clazz == null) {
    return null;
  }
  IPropertiesFactory propertiesFactory=Application.get().getResourceSettings().getPropertiesFactory();
  while (true) {
    Package pkg=clazz.getPackage();
    String packageName=(pkg == null) ? "" : pkg.getName();
    packageName=packageName.replace('.','/');
    do {
      String path=filename;
      if (packageName.length() > 0) {
        path=packageName + "/" + path;
      }
      ResourceNameIterator iter=new ResourceNameIterator(path,style,variation,locale,null,false);
      while (iter.hasNext()) {
        String newPath=iter.next();
        final Properties props=propertiesFactory.load(clazz,newPath);
        if (props != null) {
          String value=props.getString(key);
          if (value != null) {
            if (log.isDebugEnabled()) {
              log.debug("Found resource from: " + props + "; key: "+ key);
            }
            return value;
          }
        }
      }
      packageName=Strings.beforeLast(packageName,'/');
    }
 while (packageName.length() > 0);
    clazz=clazz.getSuperclass();
    if (clazz == null) {
      break;
    }
  }
  return null;
}
