{
  final Page page=application.getLastRenderedPage();
  final TestForm form=(TestForm)page.get("form");
  final TextField textField=(TextField)form.get("input");
  final WebRequestCycle cycle=application.createRequestCycle();
  assertNull(getRequestCookies(cycle));
  assertEquals(0,getResponseCookies(cycle).size());
  final CookieValuePersister persister=new CookieValuePersister();
  persister.clear(textField);
  assertNull(getRequestCookies(cycle));
  assertEquals(0,getResponseCookies(cycle).size());
  persister.save(textField);
  assertNull(getRequestCookies(cycle));
  assertEquals(1,getResponseCookies(cycle).size());
  assertEquals("test",((Cookie)getResponseCookies(cycle).get(0)).getValue());
  assertEquals("form:input",((Cookie)getResponseCookies(cycle).get(0)).getName());
  assertEquals("/WicketTester$DummyWebApplication",((Cookie)getResponseCookies(cycle).get(0)).getPath());
  persister.clear(textField);
  assertNull(getRequestCookies(cycle));
  assertEquals(1,getResponseCookies(cycle).size());
  assertEquals("test",((Cookie)getResponseCookies(cycle).get(0)).getValue());
  assertEquals("form:input",((Cookie)getResponseCookies(cycle).get(0)).getName());
  assertEquals("/WicketTester$DummyWebApplication",((Cookie)getResponseCookies(cycle).get(0)).getPath());
  persister.load(textField);
  assertEquals("test",textField.getModelObjectAsString());
  assertEquals("test",textField.getModelObjectAsString());
  textField.setModelObject("new text");
  assertEquals("new text",textField.getModelObjectAsString());
  copyCookieFromResponseToRequest(cycle);
  assertEquals(1,getRequestCookies(cycle).length);
  assertEquals(1,getResponseCookies(cycle).size());
  persister.load(textField);
  assertEquals("test",textField.getModelObjectAsString());
  assertEquals(1,getRequestCookies(cycle).length);
  assertEquals(1,getResponseCookies(cycle).size());
  persister.clear(textField);
  assertEquals(1,getRequestCookies(cycle).length);
  assertEquals(2,getResponseCookies(cycle).size());
  assertEquals("form:input",((Cookie)getResponseCookies(cycle).get(1)).getName());
  assertEquals(0,((Cookie)getResponseCookies(cycle).get(1)).getMaxAge());
}
