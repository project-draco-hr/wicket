{
  Args.notNull(component,"component");
  Page page=createPage();
  if (page == null) {
    fail("The automatically created page should not be null.");
  }
  if (pageMarkup == null) {
    String markup=createPageMarkup(component.getId());
    if (markup == null) {
      fail("The markup for the automatically created page should not be null.");
    }
    try {
      ContainerInfo containerInfo=new ContainerInfo(page);
      MarkupResourceStream markupResourceStream=new MarkupResourceStream(new StringResourceStream(markup),containerInfo,page.getClass());
      MarkupParser markupParser=getApplication().getMarkupSettings().getMarkupFactory().newMarkupParser(markupResourceStream);
      pageMarkup=markupParser.parse();
    }
 catch (    Exception e) {
      fail("Error while parsing the markup for the autogenerated page: " + e.getMessage());
    }
  }
  page.setMarkup(pageMarkup);
  page.add(component);
  ComponentInPage oldComponentInPage=componentInPage;
  startPage(page);
  if (oldComponentInPage != null) {
    componentInPage=oldComponentInPage;
  }
 else {
    componentInPage=new ComponentInPage();
    componentInPage.component=component;
  }
  return component;
}
