{
  List<Cookie> lastRequestCookies=new ArrayList<Cookie>();
  if (lastRequest != null && lastRequest.getCookies() != null) {
    for (    Cookie lastRequestCookie : lastRequest.getCookies()) {
      lastRequestCookies.add(lastRequestCookie);
    }
  }
  if (lastResponse != null) {
    List<Cookie> cookies=lastResponse.getCookies();
    if (cookies != null) {
      for (      Cookie cookie : cookies) {
        if (cookie.getMaxAge() == 0) {
          Iterator<Cookie> cookieIterator=lastRequestCookies.iterator();
          while (cookieIterator.hasNext()) {
            Cookie lastRequestCookie=cookieIterator.next();
            if (Cookies.isEqual(lastRequestCookie,cookie)) {
              cookieIterator.remove();
            }
          }
        }
 else {
          Iterator<Cookie> cookieIterator=lastRequestCookies.iterator();
          while (cookieIterator.hasNext()) {
            Cookie oldCookie=cookieIterator.next();
            if (Cookies.isEqual(cookie,oldCookie)) {
              cookieIterator.remove();
            }
          }
          lastRequestCookies.add(cookie);
        }
      }
    }
  }
  request.addCookies(lastRequestCookies);
}
