{
  WebRequestCycle cycle=new WebRequestCycle(wicketSession,wicketRequest,wicketResponse);
  cycle.request();
  final MockHttpServletResponse httpResponse=(MockHttpServletResponse)cycle.getWebResponse().getHttpServletResponse();
  if (httpResponse.isRedirect()) {
    lastRenderedPage=cycle.getResponsePage();
    final MockHttpServletRequest httpRequest=(MockHttpServletRequest)((ServletWebRequest)cycle.getWebRequest()).getHttpServletRequest();
    httpRequest.setRequestToRedirectString(httpResponse.getRedirectLocation());
    wicketSession=getSession(wicketRequest,true);
    new WebRequestCycle(wicketSession,wicketRequest,wicketResponse).request();
  }
  lastRenderedPage=cycle.getResponsePage();
}
