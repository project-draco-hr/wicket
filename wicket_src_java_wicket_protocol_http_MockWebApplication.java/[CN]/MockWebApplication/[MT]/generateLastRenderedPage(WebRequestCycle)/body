{
  lastRenderedPage=cycle.getResponsePage();
  if (lastRenderedPage == null) {
    Class responseClass=cycle.getResponsePageClass();
    if (responseClass != null) {
      Session.set(cycle.getSession());
      IRequestTarget target=cycle.getRequestTarget();
      if (target instanceof IPageRequestTarget) {
        lastRenderedPage=((IPageRequestTarget)target).getPage();
      }
 else       if (target instanceof IBookmarkablePageRequestTarget) {
        IBookmarkablePageRequestTarget pageClassRequestTarget=(IBookmarkablePageRequestTarget)target;
        Class pageClass=pageClassRequestTarget.getPageClass();
        PageParameters parameters=pageClassRequestTarget.getPageParameters();
        lastRenderedPage=new DefaultPageFactory().newPage(pageClass,parameters);
      }
    }
  }
}
