{
  ThreadContext context=ThreadContext.detach();
  MockApplication app=new MockApplication();
  app.setName("TestApplication1");
  app.set();
  app.initApplication();
  app.getRequestCycleSettings().setRenderStrategy(RenderStrategy.ONE_PASS_RENDER);
  app.registerEncoder(new MountedMapper("first-test-page",Page1.class));
  Request request=new MockWebRequest(Url.parse("first-test-page"));
  MockWebResponse response=new MockWebResponse();
  MockRequestCycle cycle=(MockRequestCycle)app.createRequestCycle(request,response);
  cycle.processRequestAndDetach();
  System.out.println("Rendered:");
  System.out.println(response.getTextResponse());
  request=new MockWebRequest(Url.parse("wicket/page?0-1.ILinkListener-link"));
  response=new MockWebResponse();
  cycle=(MockRequestCycle)app.createRequestCycle(request,response);
  cycle.processRequestAndDetach();
  cycle=(MockRequestCycle)app.createRequestCycle(request,response);
  cycle.forceRequestHandler(new ListenerInterfaceRequestHandler(new PageAndComponentProvider(0,null,"link"),ILinkListener.INTERFACE));
  cycle.processRequestAndDetach();
  app.destroy();
  ThreadContext.restore(context);
}
