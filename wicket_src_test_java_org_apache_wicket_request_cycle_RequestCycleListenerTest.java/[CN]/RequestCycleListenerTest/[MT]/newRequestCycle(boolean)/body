{
  final Response originalResponse=newResponse();
  Request request=new MockWebRequest(Url.parse("http://wicket.apache.org"));
  handler=new IRequestHandler(){
    public void respond(    IRequestCycle requestCycle){
      if (throwExceptionInRespond) {
        throw new RuntimeException("testing purposes only");
      }
      responses++;
    }
    public void detach(    IRequestCycle requestCycle){
      detaches++;
    }
  }
;
  IRequestMapper requestMapper=new IRequestMapper(){
    public IRequestHandler mapRequest(    Request request){
      return handler;
    }
    public Url mapHandler(    IRequestHandler requestHandler){
      throw new UnsupportedOperationException();
    }
    public int getCompatibilityScore(    Request request){
      throw new UnsupportedOperationException();
    }
  }
;
  IExceptionMapper exceptionMapper=new IExceptionMapper(){
    public IRequestHandler map(    Exception e){
      exceptionsMapped++;
      return null;
    }
  }
;
  RequestCycleContext context=new RequestCycleContext(request,originalResponse,requestMapper,exceptionMapper);
  RequestCycle cycle=new RequestCycle(context);
  if (Application.exists()) {
    cycle.getListeners().add(Application.get().getRequestCycleListeners());
  }
  return cycle;
}
