{
  final FeedbackMessages currentMessages=(FeedbackMessages)current.get();
  if (currentMessages != null) {
    if (log.isDebugEnabled()) {
      log.debug("FeedbackMessages " + currentMessages + " released for thread "+ Thread.currentThread());
    }
    final Set components=currentMessages.getErrorReporters();
    for (final Iterator i=components.iterator(); i.hasNext(); ) {
      Component component=(Component)i.next();
      IModel currentModel=component.getModel();
      if (currentModel instanceof ValidationErrorModelDecorator) {
        ValidationErrorModelDecorator decorator=((ValidationErrorModelDecorator)currentModel);
        IModel originalModel=decorator.getOriginalModel();
        component.setModel(originalModel);
      }
    }
    current.set(null);
  }
 else {
    if (log.isDebugEnabled()) {
      log.debug("No FeedbackMessages to release for thread " + Thread.currentThread());
    }
  }
}
