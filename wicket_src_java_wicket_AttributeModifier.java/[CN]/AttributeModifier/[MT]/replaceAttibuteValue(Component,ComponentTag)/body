{
  if (isEnabled()) {
    final ValueMap attributes=tag.getAttributes();
    final Object replacementValue=getReplacementOrNull(component);
    if (attributes.containsKey(attribute)) {
      final String value=attributes.get(attribute).toString();
      if (pattern == null || value.matches(pattern)) {
        final String newValue=newValue(value,toStringOrNull(replacementValue));
        if (newValue != null) {
          attributes.put(attribute,newValue);
        }
      }
    }
 else     if (addAttributeIfNotPresent) {
      final String newValue=newValue(null,toStringOrNull(replacementValue));
      if (newValue != null) {
        attributes.put(attribute,newValue);
      }
    }
  }
}
