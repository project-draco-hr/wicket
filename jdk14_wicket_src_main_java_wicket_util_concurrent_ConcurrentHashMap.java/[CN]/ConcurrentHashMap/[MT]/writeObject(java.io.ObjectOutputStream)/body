{
  s.defaultWriteObject();
  int cap;
synchronized (segments[0]) {
    cap=table.length;
  }
  s.writeInt(cap);
  for (int k=0; k < segments.length; ++k) {
    Segment seg=segments[k];
    Entry[] tab;
synchronized (seg) {
      tab=table;
    }
    for (int i=k; i < tab.length; i+=segments.length) {
      for (Entry e=tab[i]; e != null; e=e.next) {
        s.writeObject(e.key);
        s.writeObject(e.value);
      }
    }
  }
  s.writeObject(null);
  s.writeObject(null);
}
