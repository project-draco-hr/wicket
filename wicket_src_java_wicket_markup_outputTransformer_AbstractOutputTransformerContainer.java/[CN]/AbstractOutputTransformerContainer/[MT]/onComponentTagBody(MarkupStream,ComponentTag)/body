{
  final Response webResponse=this.getResponse();
  try {
    final Response response=newResponse();
    if (response == null) {
      throw new IllegalStateException("newResponse() must not return null");
    }
    this.getRequestCycle().setResponse(response);
    super.onComponentTagBody(markupStream,openTag);
    try {
      CharSequence output=transform(response.toString());
      webResponse.write(output.toString());
    }
 catch (    Exception ex) {
      throw new WicketRuntimeException("Error while transforming the output: " + this,ex);
    }
  }
  finally {
    this.getRequestCycle().setResponse(webResponse);
  }
}
