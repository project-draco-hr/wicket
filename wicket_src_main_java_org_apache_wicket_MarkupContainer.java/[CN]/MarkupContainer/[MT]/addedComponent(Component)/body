{
  if (child == this) {
    throw new IllegalArgumentException("Component can't be added to itself");
  }
  MarkupContainer parent=child.getParent();
  if (parent != null) {
    parent.remove(child);
  }
  child.setParent(this);
  final Page page=findPage();
  final IDebugSettings debugSettings=Application.get().getDebugSettings();
  if (debugSettings.isLinePreciseReportingOnAddComponentEnabled()) {
    child.setMetaData(ADDED_AT_KEY,ComponentStrings.toString(child,new MarkupException("added")));
  }
  if (page != null) {
    child.onConnectedToPage();
    if (child instanceof MarkupContainer) {
      MarkupContainer container=(MarkupContainer)child;
      container.visitChildren(new IVisitor<Component>(){
        public Object component(        final Component component){
          component.onConnectedToPage();
          return CONTINUE_TRAVERSAL;
        }
      }
);
    }
    page.componentAdded(child);
  }
  if (isPreparedForRender()) {
    child.beforeRender();
  }
}
