{
  final String applicationClassName=portlet.getInitParameter(APP_CLASS_PARAM);
  if (applicationClassName == null) {
    throw new WicketRuntimeException("portlet init param [" + APP_CLASS_PARAM + "] is missing. If you are trying to use your own implementation of IPortletApplicationFactory and get this message then the portlet init param ["+ WicketPortlet.APP_FACT_PARAM+ "] is missing");
  }
  try {
    final Class applicationClass=getClass().getClassLoader().loadClass(applicationClassName);
    if (PortletApplication.class.isAssignableFrom(applicationClass)) {
      return (PortletApplication)applicationClass.newInstance();
    }
 else {
      throw new WicketRuntimeException("Application class " + applicationClassName + " must be a subclass of WebApplication");
    }
  }
 catch (  ClassNotFoundException e) {
    throw new WicketRuntimeException("Unable to create application of class " + applicationClassName,e);
  }
catch (  InstantiationException e) {
    throw new WicketRuntimeException("Unable to create application of class " + applicationClassName,e);
  }
catch (  IllegalAccessException e) {
    throw new WicketRuntimeException("Unable to create application of class " + applicationClassName,e);
  }
catch (  SecurityException e) {
    throw new WicketRuntimeException("Unable to create application of class " + applicationClassName,e);
  }
}
