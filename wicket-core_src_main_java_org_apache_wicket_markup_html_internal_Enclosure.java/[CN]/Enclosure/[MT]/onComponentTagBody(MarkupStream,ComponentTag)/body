{
  boolean visible=childComponent.determineVisibility();
  final IComponentOnAfterRenderListener listener=new EnclosureListener(this);
  try {
    getApplication().getComponentOnAfterRenderListeners().add(listener);
    if (visible) {
      super.onComponentTagBody(markupStream,openTag);
    }
 else {
      RequestCycle cycle=getRequestCycle();
      Response response=cycle.getResponse();
      try {
        cycle.setResponse(NullResponse.getInstance());
        super.onComponentTagBody(markupStream,openTag);
      }
  finally {
        cycle.setResponse(response);
      }
    }
  }
  finally {
    getApplication().getComponentOnAfterRenderListeners().remove(listener);
  }
}
