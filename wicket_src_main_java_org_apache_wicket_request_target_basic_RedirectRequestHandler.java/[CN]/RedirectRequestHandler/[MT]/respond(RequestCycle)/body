{
  WebResponse response=(WebResponse)requestCycle.getResponse();
  if (redirectUrl.startsWith("/")) {
    RequestContext rc=RequestContext.get();
    if (rc.isPortletRequest() && ((PortletRequestContext)rc).isEmbedded()) {
      response.sendRedirect(redirectUrl);
    }
 else {
      String location=UrlUtils.rewriteToContextRelative(redirectUrl.substring(1),requestCycle.getRequest());
      if (location.startsWith("./")) {
        location=location.length() == 2 ? "." : location.substring(2);
      }
      response.sendRedirect(location);
    }
  }
 else   if (redirectUrl.contains("://")) {
    response.sendRedirect(redirectUrl);
  }
 else {
    response.sendRedirect(redirectUrl);
  }
}
