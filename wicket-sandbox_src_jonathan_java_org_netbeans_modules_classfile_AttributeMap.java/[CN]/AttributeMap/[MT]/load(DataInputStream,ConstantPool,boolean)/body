{
  int count=in.readUnsignedShort();
  Map map=new HashMap(count + 1,(float)1.0);
  for (int i=0; i < count; i++) {
    Object o=pool.get(in.readUnsignedShort());
    if (!(o instanceof CPUTF8Info))     throw new InvalidClassFormatException();
    CPUTF8Info entry=(CPUTF8Info)o;
    String name=entry.getName();
    int len=in.readInt();
    if (!includeCode && name.equals("Code")) {
      int n;
      while ((n=(int)in.skip(len)) > 0 && n < len)       len-=n;
    }
 else {
      byte[] attr=new byte[len];
      in.readFully(attr);
      map.put(name,attr);
    }
  }
  return new AttributeMap(map);
}
