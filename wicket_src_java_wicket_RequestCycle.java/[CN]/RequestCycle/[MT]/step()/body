{
  try {
switch (currentStep) {
case PREPARE_REQUEST:
{
        prepare();
        break;
      }
case RESOLVE_TARGET:
{
      final IRequestTarget target=processor.resolve(this,request.getRequestParameters());
      if (target == null) {
        throw new WicketRuntimeException("the processor did not resolve to any request target");
      }
      requestTargets.push(target);
      break;
    }
case PROCESS_EVENTS:
{
    processEventsAndRespond();
    break;
  }
case RESPOND:
{
  respond();
  break;
}
default :
{
}
}
}
 catch (AbstractRestartResponseException e) {
throw e;
}
catch (RuntimeException e) {
currentStep=HANDLE_EXCEPTION;
log.error(e.getMessage(),e);
if (processor != null) {
processor.respond(e,this);
}
}
}
