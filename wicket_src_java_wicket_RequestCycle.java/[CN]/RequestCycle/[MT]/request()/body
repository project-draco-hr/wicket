{
synchronized (session) {
    try {
      threadAttach();
      internalOnBeginRequest();
      onBeginRequest();
      if (parseRequest()) {
        respond();
      }
      internalOnEndRequest();
      onEndRequest();
    }
  finally {
      threadDetach();
    }
  }
}
