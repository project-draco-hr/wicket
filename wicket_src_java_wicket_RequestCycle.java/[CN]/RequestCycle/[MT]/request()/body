{
synchronized (session) {
    threadAttach();
    Page page=null;
    internalOnBeginRequest();
    onBeginRequest();
    try {
      if (onRespond()) {
        page=getResponsePage();
        if (page != null) {
          try {
            if (getRedirect()) {
              redirectTo(page);
            }
 else {
              page.render();
            }
          }
  finally {
            internalOnEndRequest();
            onEndRequest();
            page.internalOnEndRequest();
            page.onEndRequest();
          }
        }
      }
 else {
        internalOnEndRequest();
        onEndRequest();
      }
    }
 catch (    RuntimeException e) {
      onRuntimeException(page,e);
    }
 finally {
      threadDetach();
    }
  }
}
