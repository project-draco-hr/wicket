{
  try {
switch (currentStep) {
case PREPARE_REQUEST:
{
        prepare();
        break;
      }
case DECODE_PARAMETERS:
{
      requestParameters=getRequestParameters(processor);
      break;
    }
case RESOLVE_TARGET:
{
    final IRequestTarget target=processor.resolve(this,requestParameters);
    if (target == null) {
      throw new WicketRuntimeException("the processor did not resolve to any request target");
    }
    requestTargets.push(target);
    break;
  }
case CHECK_ACCESS:
{
  IRequestTarget target=getRequestTarget();
  if (target instanceof IAccessCheck) {
    ((IAccessCheck)target).checkAccess(this);
  }
  IRequestTarget otherTarget=getRequestTarget();
  if (otherTarget != target) {
    currentStep=CHECK_ACCESS - 1;
    requestTargets.pop();
    requestTargets.push(target);
    requestTargets.push(otherTarget);
  }
  break;
}
case PROCESS_EVENTS:
{
processEventsAndRespond(processor);
break;
}
case RESPOND:
{
processor.respond(this);
break;
}
default :
{
}
}
}
 catch (RuntimeException e) {
currentStep=HANDLE_EXCEPTION;
log.error(e.getMessage(),e);
if (processor != null) {
processor.respond(e,this);
}
}
}
