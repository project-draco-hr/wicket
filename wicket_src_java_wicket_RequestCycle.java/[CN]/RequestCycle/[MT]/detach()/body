{
  for (Iterator iter=requestTargets.iterator(); iter.hasNext(); ) {
    IRequestTarget target=(IRequestTarget)iter.next();
    if (target != null) {
      try {
        target.detach(this);
      }
 catch (      RuntimeException e) {
        log.error("there was an error cleaning up target " + target + ".",e);
      }
    }
  }
  session.cleanupFeedbackMessages();
  if (updateSession) {
    session.update();
  }
  session.requestDetached();
  if (getResponse() instanceof BufferedWebResponse) {
    ((BufferedWebResponse)getResponse()).filter();
  }
  try {
    onEndRequest();
  }
 catch (  RuntimeException e) {
    log.error("Exception occurred during onEndRequest",e);
  }
  threadDetach();
}
