{
  for (  IRequestTarget target : requestTargets) {
    if (target != null) {
      try {
        target.detach(this);
      }
 catch (      RuntimeException e) {
        log.error("there was an error cleaning up target " + target + ".",e);
      }
    }
  }
  session.cleanupFeedbackMessages();
  if (updateSession) {
    session.update();
  }
  session.requestDetached();
  if (getResponse() instanceof BufferedWebResponse) {
    ((BufferedWebResponse)getResponse()).filter();
  }
  try {
    getApplication().getSessionStore().onEndRequest(request);
    onEndRequest();
  }
 catch (  RuntimeException e) {
    log.error("Exception occurred during request detachement",e);
  }
  IRequestLogger requestLogger=getApplication().getRequestLogger();
  if (requestLogger != null) {
    requestLogger.requestTime((System.currentTimeMillis() - startTime));
  }
  threadDetach();
}
