{
  MockWebApplication mockApp=new MockWebApplication(new WebApplication(){
    @Override protected void outputDevelopmentModeWarning(){
    }
    @Override public Class<WebPage> getHomePage(){
      return null;
    }
    protected ISessionStore newSessionStore(){
      return new HttpSessionStore(this);
    }
  }
,null);
  Application app=mockApp.getApplication();
  try {
    Application.set(app);
    GuiceComponentInjector injector=new GuiceComponentInjector(app,new Module(){
      public void configure(      Binder binder){
        binder.bind(ITestService.class).to(TestService.class);
        binder.bind(ITestService.class).annotatedWith(Red.class).to(TestServiceRed.class);
        binder.bind(ITestService.class).annotatedWith(Blue.class).to(TestServiceBlue.class);
      }
    }
);
    app.addComponentInstantiationListener(injector);
    TestComponent testComponent=new TestComponent("id");
    doChecksForComponent(testComponent);
    TestComponent clonedComponent=(TestComponent)Objects.cloneObject(testComponent);
    doChecksForComponent(clonedComponent);
  }
  finally {
    Application.unset();
  }
}
