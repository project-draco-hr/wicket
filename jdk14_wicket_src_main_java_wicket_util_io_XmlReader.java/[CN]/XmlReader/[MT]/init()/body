{
  if (!this.inputStream.markSupported()) {
    throw new IOException("The InputStream must support mark/reset");
  }
  final int readAheadSize=80;
  this.inputStream.mark(readAheadSize);
  if (getXmlDeclaration(this.inputStream,readAheadSize)) {
    this.encoding=determineEncoding(this.xmlDeclarationString);
  }
 else {
    this.inputStream.reset();
  }
  if (this.encoding == null) {
    this.reader=new BufferedReader(new InputStreamReader(this.inputStream));
  }
 else {
    this.reader=new BufferedReader(new InputStreamReader(this.inputStream,this.encoding));
  }
}
