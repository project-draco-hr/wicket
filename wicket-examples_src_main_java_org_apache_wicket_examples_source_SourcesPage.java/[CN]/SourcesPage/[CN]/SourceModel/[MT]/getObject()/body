{
  if (Strings.isEmpty(name) && Strings.isEmpty(getPage().getRequest().getRequestParameters().getParameterValue(SOURCE).toOptionalString())) {
    return "";
  }
  BufferedReader br=null;
  String source=null;
  try {
    StringBuilder sb=new StringBuilder();
    source=(name != null) ? name : getPage().getRequest().getRequestParameters().getParameterValue(SOURCE).toOptionalString();
    InputStream resourceAsStream=getPageTargetClass().getResourceAsStream(source);
    if (resourceAsStream == null) {
      return "Unable to read the source for " + source;
    }
    br=new BufferedReader(new InputStreamReader(resourceAsStream));
    while (br.ready()) {
      sb.append(br.readLine());
      sb.append("\n");
    }
    int lastDot=source.lastIndexOf('.');
    if (lastDot != -1) {
      String type=source.substring(lastDot + 1);
      Renderer renderer=XhtmlRendererFactory.getRenderer(type);
      if (renderer != null) {
        return renderer.highlight(source,sb.toString(),"UTF-8",true);
      }
    }
    return Strings.escapeMarkup(sb.toString(),false,true).toString().replaceAll("\n","<br />");
  }
 catch (  IOException e) {
    log.error("Unable to read resource stream for: " + source + "; Page="+ page.toString(),e);
    return "";
  }
 finally {
    IOUtils.closeQuietly(br);
  }
}
