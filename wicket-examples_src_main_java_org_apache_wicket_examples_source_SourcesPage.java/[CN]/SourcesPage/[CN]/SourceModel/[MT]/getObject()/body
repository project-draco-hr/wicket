{
  if (Strings.isEmpty(name)) {
    return "";
  }
  BufferedReader br=null;
  try {
    StringBuffer sb=new StringBuffer();
    InputStream resourceAsStream=page.getResourceAsStream(name);
    if (resourceAsStream == null) {
      return "Unable to read the source for " + name;
    }
    br=new BufferedReader(new InputStreamReader(resourceAsStream));
    while (br.ready()) {
      sb.append(br.readLine());
      sb.append("\n");
    }
    int lastDot=name.lastIndexOf('.');
    if (lastDot != -1) {
      String type=name.substring(lastDot + 1);
      Renderer renderer=XhtmlRendererFactory.getRenderer(type);
      if (renderer != null) {
        return renderer.highlight(name,sb.toString(),"UTF-8",true);
      }
    }
    return Strings.escapeMarkup(sb.toString(),false,true).toString().replaceAll("\n","<br />");
  }
 catch (  IOException e) {
    log.error("Unable to read resource stream for: " + name + "; Page="+ page.toString(),e);
    return "";
  }
 finally {
    IOUtils.closeQuietly(br);
  }
}
