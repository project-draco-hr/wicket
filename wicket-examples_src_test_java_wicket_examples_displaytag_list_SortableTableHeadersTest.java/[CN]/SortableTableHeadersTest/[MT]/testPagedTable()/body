{
  WicketTester application=new WicketTester();
  application.getApplication().getRequestCycleSettings().setRenderStrategy(IRequestCycleSettings.REDIRECT_TO_BUFFER);
  application.startPage(SortableTableHeadersPage.class);
  SortableTableHeadersPage page=(SortableTableHeadersPage)application.getLastRenderedPage();
  String document=application.getServletResponse().getDocument();
  DiffUtil.validatePage(document,this.getClass(),"SortableTableHeadersExpectedResult_1.html",true);
  Link link=(Link)page.get("header:id:actionLink");
  assertTrue(link.isEnabled());
  link=(Link)page.get("header:name:actionLink");
  assertTrue(link.isEnabled());
  link=(Link)page.get("header:email:actionLink");
  assertNull(link);
  link=(Link)page.get("header:name:actionLink");
  application.setupRequestAndResponse();
  application.getServletRequest().setRequestToComponent(link);
  application.processRequestCycle();
  MockHttpServletResponse redirectResponse=application.getServletResponse();
  assertTrue("Response should be a redirect",redirectResponse.isRedirect());
  String redirect=application.getServletResponse().getRedirectLocation();
  application.setupRequestAndResponse();
  application.getServletRequest().setRequestToRedirectString(redirect);
  application.processRequestCycle();
  document=application.getServletResponse().getDocument();
  assertTrue(DiffUtil.validatePage(document,this.getClass(),"SortableTableHeadersExpectedResult_2.html",false));
  link=(Link)page.get("header:name:actionLink");
  application.setupRequestAndResponse();
  application.getServletRequest().setRequestToComponent(link);
  application.processRequestCycle();
  assertTrue("Response should be a redirect",application.getServletResponse().isRedirect());
  application.getApplication().getMarkupSettings().setStripWicketTags(true);
  redirect=application.getServletResponse().getRedirectLocation();
  application.setupRequestAndResponse();
  application.getServletRequest().setRequestToRedirectString(redirect);
  application.processRequestCycle();
  document=application.getServletResponse().getDocument();
  assertTrue(DiffUtil.validatePage(document,this.getClass(),"SortableTableHeadersExpectedResult_3.html",false));
  application.destroy();
}
