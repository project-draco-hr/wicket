{
  if ((tag.isOpen() || tag.isOpenClose()) && tag.getAttributes().containsKey(markupResourceStream.getWicketId())) {
    if (tag.isOpenClose() || tag.hasNoCloseTag()) {
      if ((currentPath != null) && (currentPath.length() > 0)) {
        tag.setPath(currentPath.toString());
      }
    }
 else {
      if (currentPath == null) {
        currentPath=new StringBuffer(100);
      }
 else       if (currentPath.length() > 0) {
        tag.setPath(currentPath.toString());
        currentPath.append(':');
      }
      currentPath.append(tag.getId());
    }
  }
 else   if (tag.isClose() && (currentPath != null)) {
    if ((tag.getOpenTag() == null) || tag.getOpenTag().getAttributes().containsKey(markupResourceStream.getWicketId())) {
      int index=currentPath.lastIndexOf(":");
      if (index != -1) {
        currentPath.setLength(index);
      }
 else {
        currentPath.setLength(0);
      }
    }
  }
  return currentPath;
}
