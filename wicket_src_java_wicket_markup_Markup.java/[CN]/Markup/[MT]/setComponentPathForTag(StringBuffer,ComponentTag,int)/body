{
  if ((tag.isOpen() || tag.isOpenClose()) && tag.getAttributes().containsKey(wicketId)) {
    int size=tagPath.length();
    if (size > 0) {
      tagPath.append(Component.PATH_SEPARATOR);
    }
    tagPath.append(tag.getId());
    this.componentMap.put(tagPath.toString(),Integer.valueOf(tagIndex));
    if (tag.isOpenClose() || tag.hasNoCloseTag()) {
      tagPath.setLength(size);
    }
  }
 else   if (tag.isClose() && (tagPath != null)) {
    if ((tag.getOpenTag() == null) || tag.getOpenTag().getAttributes().containsKey(wicketId)) {
      final int index=tagPath.lastIndexOf(String.valueOf(Component.PATH_SEPARATOR));
      if (index != -1) {
        tagPath.setLength(index);
      }
 else {
        tagPath.setLength(0);
      }
    }
  }
  return tagPath;
}
