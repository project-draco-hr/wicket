{
  this.filterConfig=filterConfig;
  IWebApplicationFactory factory=getApplicationFactory();
  webApplication=factory.createApplication(this);
  webApplication.setName(filterConfig.getFilterName());
  webApplication.setWicketFilter(this);
  initFilterPath();
  final ClassLoader previousClassLoader=Thread.currentThread().getContextClassLoader();
  final ClassLoader newClassLoader=getClassLoader();
  webApplication.set();
  try {
    if (previousClassLoader != newClassLoader) {
      Thread.currentThread().setContextClassLoader(newClassLoader);
    }
    webApplication.initApplication();
  }
  finally {
    ThreadContext.detach();
    if (newClassLoader != previousClassLoader) {
      Thread.currentThread().setContextClassLoader(previousClassLoader);
    }
  }
}
