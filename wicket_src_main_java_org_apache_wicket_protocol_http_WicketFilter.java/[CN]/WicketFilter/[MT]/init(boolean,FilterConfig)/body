{
  this.filterConfig=filterConfig;
  IWebApplicationFactory factory=getApplicationFactory();
  application=factory.createApplication(this);
  application.setName(filterConfig.getFilterName());
  application.setWicketFilter(this);
  if (filterPath == null) {
    filterPath=new WebXmlFile().getFilterPath(isServlet,filterConfig);
    if ((filterPath == null) && log.isInfoEnabled()) {
      log.info("Unable to parse filter mapping web.xml for " + filterConfig.getFilterName() + ". "+ "Configure with init-param "+ FILTER_MAPPING_PARAM+ " if it is not \"/*\".");
    }
  }
  final ClassLoader previousClassLoader=Thread.currentThread().getContextClassLoader();
  final ClassLoader newClassLoader=getClassLoader();
  ThreadContext.setApplication(application);
  try {
    if (previousClassLoader != newClassLoader) {
      Thread.currentThread().setContextClassLoader(newClassLoader);
    }
    application.initApplication();
    application.logStarted();
  }
  finally {
    ThreadContext.detach();
    if (newClassLoader != previousClassLoader) {
      Thread.currentThread().setContextClassLoader(previousClassLoader);
    }
  }
}
