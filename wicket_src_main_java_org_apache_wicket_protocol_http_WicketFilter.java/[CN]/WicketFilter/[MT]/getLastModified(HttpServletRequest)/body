{
  final String pathInfo=getRelativePath(servletRequest);
  if (pathInfo.startsWith(WebRequestCodingStrategy.RESOURCES_PATH_PREFIX)) {
    final String resourceReferenceKey=pathInfo.substring(WebRequestCodingStrategy.RESOURCES_PATH_PREFIX.length());
    Resource resource=null;
    WebRequestCycle requestCycle=null;
    boolean externalCall=!Application.exists();
    try {
      if (externalCall) {
        Application.set(webApplication);
      }
      resource=webApplication.getSharedResources().get(resourceReferenceKey);
      if ((resource != null) && resource.isCacheable()) {
        checkCharacterEncoding(servletRequest);
        final WebRequest request=webApplication.newWebRequest(servletRequest);
        WebResponse response=new WebResponse();
        if (RequestCycle.get() == null) {
          requestCycle=(WebRequestCycle)webApplication.newRequestCycle(request,response);
        }
        Session.findOrCreate(request,response);
        ObsoleteRequestParameters rp=RequestCycle.get().getProcessor().getRequestCodingStrategy().decode(request);
        resource.setParameters(rp.getParameters());
        IResourceStream stream=resource.getResourceStream();
        Time time=stream.lastModifiedTime();
        try {
          stream.close();
        }
 catch (        IOException e) {
        }
        return time != null ? time.getMilliseconds() : -1;
      }
    }
 catch (    AbortException e) {
      return -1;
    }
 finally {
      if (resource != null) {
        resource.setParameters(null);
      }
      if (externalCall) {
        Application.unset();
        RequestContext.unset();
      }
      if (Session.exists()) {
        Session.unset();
      }
      if (requestCycle != null) {
        requestCycle.unset();
      }
    }
  }
  return -1;
}
