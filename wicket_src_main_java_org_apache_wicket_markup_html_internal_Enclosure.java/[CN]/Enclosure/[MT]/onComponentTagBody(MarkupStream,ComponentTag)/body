{
  MarkupContainer container=getEnclosureParent();
  Component controller=container.get(childId.toString());
  checkChildComponent(controller);
  boolean visible=controller.determineVisibility();
  final IComponentOnAfterRenderListener listener=new EnclosureListener(this);
  try {
    getApplication().addComponentOnAfterRenderListener(listener);
    if (visible) {
      super.onComponentTagBody(markupStream,openTag);
    }
 else {
      RequestCycle cycle=getRequestCycle();
      Response response=cycle.getResponse();
      try {
        cycle.setResponse(NullResponse.getInstance());
        super.onComponentTagBody(markupStream,openTag);
      }
  finally {
        cycle.setResponse(response);
      }
    }
  }
  finally {
    getApplication().removeComponentOnAfterRenderListener(listener);
  }
}
