{
  while (stack.size() > 0) {
    final ComponentTag top=stack.pop();
    return top;
  }
  final ComponentTag tag=(ComponentTag)getParent().nextTag();
  if (tag == null) {
    return tag;
  }
  if (tag.isOpenClose()) {
    String name=tag.getName();
    if (tag.getNamespace() != null) {
      name=tag.getNamespace() + ":" + tag.getName();
    }
    if (requiresOpenBodyCloseTag(name)) {
      tag.setType(XmlTag.Type.OPEN);
      XmlTag closeTag=new XmlTag();
      closeTag.setType(XmlTag.Type.CLOSE);
      closeTag.setName(tag.getName());
      closeTag.setNamespace(tag.getNamespace());
      closeTag.closes(tag);
      stack.push(new ComponentTag(closeTag));
    }
  }
  return tag;
}
