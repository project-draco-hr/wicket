{
  PortletRequestDispatcher rd=null;
  String previousURL=null;
  while (true) {
    rd=getPortletContext().getRequestDispatcher(wicketURL);
    if (rd != null) {
      rd.include(request,response);
      String redirectLocation=responseState.getRedirectLocation();
      if (log.isDebugEnabled()) {
        log.debug("redirect url after inclusion:" + redirectLocation);
      }
      if (redirectLocation != null) {
        redirectLocation=fixWicketUrl(redirectLocation,wicketFilterPath,wicketFilterQuery);
        boolean validWicketUrl=redirectLocation.startsWith(wicketFilterPath);
        if (validWicketUrl) {
          if (previousURL == null || previousURL != redirectLocation) {
            previousURL=wicketURL;
            wicketURL=redirectLocation;
            ((RenderResponse)response).reset();
            responseState.clear();
            continue;
          }
 else {
            responseState.clear();
            break;
          }
        }
 else {
          responseState.clear();
          if (responseState.isResourceResponse()) {
            response.setProperty(ResourceResponse.HTTP_STATUS_CODE,Integer.toString(302));
            response.setProperty("Location",redirectLocation);
          }
 else {
            log.error("Wicket redirecting outside of its own application during Render which is unsupported. Target url: " + redirectLocation);
          }
          break;
        }
      }
 else {
        responseState.flush();
      }
    }
    break;
  }
}
