{
  final RequestListenerInterface rli=requestTarget.getRequestListenerInterface();
  final AppendingStringBuffer url=new AppendingStringBuffer(64);
  url.append(urlPrefix(requestCycle));
  url.append('?');
  url.append(INTERFACE_PARAMETER_NAME);
  url.append('=');
  final Component component=requestTarget.getTarget();
  final Page page=component.getPage();
  final PageMap pageMap=page.getPageMap();
  if (!pageMap.isDefault()) {
    url.append(pageMap.getName());
  }
  url.append(Component.PATH_SEPARATOR);
  String listenerName=rli.getName();
  if (page instanceof WebPage && !"IResourceListener".equals(listenerName)) {
    url.append(page.getId());
    url.append(Component.PATH_SEPARATOR);
    url.append(((WebPage)page).getUrlCompressor().getUIDForComponentAndInterface(component,listenerName));
    listenerName=null;
  }
 else {
    url.append(component.getPath());
  }
  url.append(Component.PATH_SEPARATOR);
  final int versionNumber=component.getPage().getCurrentVersionNumber();
  if (!rli.getRecordsPageVersion()) {
    url.append(Page.LATEST_VERSION);
  }
 else   if (versionNumber > 0) {
    url.append(versionNumber);
  }
  url.append(Component.PATH_SEPARATOR);
  if (listenerName != null && !IRedirectListener.INTERFACE.getName().equals(listenerName)) {
    url.append(listenerName);
  }
  return requestCycle.getResponse().encodeURL(url.toString());
}
