{
  Set parameterNamesToAdd=new HashSet(parameters.keySet());
  boolean foundParameter=false;
  int lastSpecifiedParameter=parameterNames.length;
  while (lastSpecifiedParameter != 0 && !foundParameter) {
    foundParameter=parameters.containsKey(parameterNames[--lastSpecifiedParameter]);
  }
  if (foundParameter) {
    for (int i=0; i <= lastSpecifiedParameter; i++) {
      String parameterName=parameterNames[i];
      String value=(String)parameters.get(parameterName);
      if (value == null) {
        value="";
      }
      url.append("/").append(urlEncode(value));
      parameterNamesToAdd.remove(parameterName);
    }
  }
  if (!parameterNamesToAdd.isEmpty()) {
    boolean first=true;
    for (Iterator iter=parameterNamesToAdd.iterator(); iter.hasNext(); ) {
      url.append(first ? '?' : '&');
      String parameterName=(String)iter.next();
      String value=(String)parameters.get(parameterName);
      url.append(urlEncode(parameterName)).append("=").append(urlEncode(value));
      first=false;
    }
  }
}
