{
  if (url.startsWith("http://") || url.startsWith("https://")) {
    return url;
  }
 else   if (url.startsWith("/")) {
    return getAbsolutePrefix() + url;
  }
 else {
    HttpServletRequest httpServletRequest=webRequest.getHttpServletRequest();
    Charset charset=RequestUtils.getCharset(httpServletRequest);
    final Url current;
    current=webRequest.getBaseUrl();
    Url append=Url.parse(url,charset);
    current.concatSegments(append.getSegments());
    Url result=new Url(current.getSegments(),append.getQueryParameters());
    return Strings.join("/",getAbsolutePrefix(),httpServletRequest.getContextPath(),webRequest.getFilterPrefix(),result.toString());
  }
}
