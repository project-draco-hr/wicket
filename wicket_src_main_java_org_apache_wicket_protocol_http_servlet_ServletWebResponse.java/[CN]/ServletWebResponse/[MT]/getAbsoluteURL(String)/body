{
  if (url.startsWith("http://") || url.startsWith("https://")) {
    return url;
  }
 else   if (url.startsWith("/")) {
    return getAbsolutePrefix() + url;
  }
 else {
    Charset charset=RequestUtils.getCharset(httpServletRequest);
    Url current=Url.parse(httpServletRequest.getRequestURI(),charset);
    Url append=Url.parse(url,charset);
    current.concatSegments(append.getSegments());
    Url result=new Url(current.getSegments(),append.getQueryParameters());
    return getAbsolutePrefix() + result.toString();
  }
}
